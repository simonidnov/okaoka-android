var okaoka_api={position:null,_user:null,_release_version:"0.0.6",init:function(){},generate_uid:function(){if(typeof require==="undefined"){return false}function a(){return Math.floor((1+Math.random())*65536).toString(16).substring(1)}return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()},create_user:function(){if(typeof require==="undefined"){return false}var a={uid:this.generate_uid(),name:"",ip:"",mac:"",hostname:_node.os.hostname(),architecture:_node.os.arch(),total_memory:_node.os.totalmem(),free_memory:_node.os.freemem(),processors:_node.os.cpus().length,processor_model:_node.os.cpus()[0].model,processor_speed:_node.os.cpus()[0].speed,release_version:okaoka_api._release_version,uptime:_node.os.uptime(),platform:_node.os.platform(),location:""};a.location=okaoka_api.position.coords.latitude+":"+okaoka_api.position.coords.longitude;_node.get_user_ip(function(b){a.ip=b[0].iface.address});ajax_request.post("users",a,function(b){a.user_id=b.user_id;okaoka_api._user=a;var c={};$.each(_.keys(a),function(d,f){c[f]={type:"TEXT",value:a[f]}});setTimeout(function(){_node.insert_datas("oka_user",c,function(d){})},100)})},update_user:function(){if(typeof require==="undefined"){return false}if(okaoka_api._user===null){okaoka_api.set_user()}if(typeof _node==="undefined"){_node=new node_utilities();_node.init_device()}var a={hostname:_node.os.hostname(),architecture:_node.os.arch(),total_memory:_node.os.totalmem(),free_memory:_node.os.freemem(),processors:_node.os.cpus().length,processor_model:_node.os.cpus()[0].model,processor_speed:_node.os.cpus()[0].speed,release_version:okaoka_api._release_version,uptime:_node.os.uptime(),platform:_node.os.platform(),};a.location=okaoka_api.position.coords.latitude+":"+okaoka_api.position.coords.longitude;_node.get_user_ip(function(b){a.ip=b[0].iface.address});a.user_id=okaoka_api._user.user_id;ajax_request.put("users",a,function(b){})},save_scoring:function(){if(typeof require==="undefined"){return false}$.ajax({dataType:"json",url:"./pages/menu/pages_menu.json",data:{},success:function(a){var c={pages:[]};$.each(_.keys(a),function(d,f){$.each(_.keys(a[f]),function(h,g){c.pages.push(a[f][g]["name"])})});for(var b=0;b<c.pages.length;b++){okaoka_api.save_game_score(c.pages[b])}}})},save_game_score:function(a){ajax_request.post("score",{user_id:okaoka_api._user.user_id,game_name:a,datas:e.datas},function(b){})},set_user:function(){okaoka_api._user="SIMON_TESTER_0";return true},post_pictures:function(){if(typeof require==="undefined"){return false}if(okaoka_api._user===null){okaoka_api.set_user()}_node.get_datas("pictures",{where:{saved:"false"}},function(a){if(a.code!==200){_node.execute("ALTER TABLE pictures ADD COLUMN saved TEXT DEFAULT 'false'",function(){})}else{$.each(a.datas,function(c,g){if(typeof _node.fs==="undefined"){_node.init_fileSystem()}var f=_node.fs.readFileSync(_node.get_user_home()+"/okaoka/pictures/"+g.filename);var b=new Buffer(f).toString("base64");var h=new FormData();h.append("bitmap",b);h.append("user_id",okaoka_api._user.user_id);var d=new XMLHttpRequest();d.open("POST",ajax_request._base_url+"picture");d.send(h);setTimeout(function(){_node.delete_picture(g.filename,function(){console.log("file deleted from local")})})});_node.update_saved_datas("pictures",function(b){})}})},get_location:function(c){if(typeof require==="undefined"){return false}var b=this,a=false;$.get("https://maps.googleapis.com/maps/api/browserlocation/json?browser=chromium&sensor=true",function(f){console.log("get location");var d={coords:{latitude:f.location.lat,longitude:f.location.lng}};okaoka_api.position=d;c(d);a=true});setTimeout(function(){if(!a){c({})}},5000)}};