var navigation={router:null,page_properties:null,_current_page_name:null,_page_script:null,_last_page_menu:0,_switcher_last_date:null,_current_interface_color:colors.blue,_last_event:new Date().getTime(),_nav_sounds:[{label:"global_hit",file:"./sounds/global_hit.mp3"}],settings:{time_off:60000,audio:{effects:{state:"on",volume:100},music:{state:"on",volume:100},video:{state:"on",volume:100},pages:{screensaver:true,switcher:true,menu:true,drawing:true,dots:true,simplediscs:true,run:true,basketball:true,build_2:true,where:true,code2:true}}},init:function(){audio_manager.init();window.localStorage.setItem("okaoka_settings",JSON.stringify(navigation.settings));this.set_update_events();this.create_routes();this.create_back_button();okaoka_api.init()},create_back_button:function(){var a=new createjs.LoadQueue();a.on("complete",function(){this.destroy();var c,b,d;c=document.getElementById("exit_button_canvas");d=new lib.exit_button();b=new createjs.Stage(c);b.addChild(d);b.update();createjs.Ticker.setFPS(lib.properties.fps);createjs.Ticker.addEventListener("tick",b)});a.loadManifest(["images/assets/exit_button/exit_button.js"],true);a.load()},set_update_events:function(){if(utilities.is_touch_screen()){$("body").off("touchstart").on("touchstart",navigation.update_event)}else{$("body").off("mousedown").on("mousedown",navigation.update_event)}},update_event:function(){navigation._last_event=new Date().getTime();window.clearTimeout(this.refreshTimeOut);window.clearTimeout(this.activityTimeout);this.refreshTimeOut=setTimeout(function(){if(typeof gui!=="undefined"){gui.Window.get().reload(3)}else{window.location.reload(true)}},3600000);this.activityTimeout=setTimeout(function(){navigation.check_activity()},60000)},check_activity:function(){if(navigation._current_page_name!=="screensaver"&&navigation._current_page_name!=="video"&&navigation._current_page_name!=="switcher"&&navigation._current_page_name!=="settings"&&navigation._current_page_name!=="basketball"&&navigation._current_page_name!=="drop_circle"&&navigation._current_page_name!=="code2"&&navigation._current_page_name!=="number"&&navigation._current_page_name!=="character_frame"){if(new Date().getTime()-navigation._last_event>60000){navigation.router.navigate("page/screensaver",{trigger:true,replace:true});setTimeout(function(){if(typeof gui!=="undefined"){gui.Window.get().reload(3)}else{window.location.reload(true)}},500)}}setTimeout(function(){navigation.check_activity()},60000)},create_routes:function(){var a=Backbone.Router.extend({routes:{"":"changepage","page/:name":"changepage","page/:name/intro/:data":"changepage","page/:name/intro/:data/date/:d":"changepage"},changepage:function(c,d){if(typeof app!=="undefined"){app.navigate()}if(c=="menu"&&navigation.last_page!="menu"&&typeof navigation.last_page!="undefined"){window.location.reload()}navigation.last_page=c;utilities.destroy_over_motion();navigation.intro=true;if(typeof d==="string"){if(d==="false"){navigation.intro=false}}navigation.set_update_events();navigation.update_event();if(typeof c!=="undefined"){lib=null;if(typeof gui!=="undefined"){if(typeof gui!=="undefined"){gui.App.clearCache()}window.localStorage.setItem("okaoka_settings",JSON.stringify(navigation.settings))}navigation.create_back_button();if(navigation._page_script===null||typeof navigation._page_script=="undefined"){navigation.load_page(c)}else{if(typeof self._music_ambiance!=="undefined"){audio_manager.destroy_ambiance(navigation._page_script._music_ambiance,function(){audio_manager.destroy_all_sounds()})}else{audio_manager.destroy_all_sounds()}navigation._page_script.destroy(function(){if(typeof _okg==="undefined"){navigation.remove_dependencies();navigation.load_page(c)}else{navigation.clear_page_memory(_okg,function(){_okg=null;navigation.remove_dependencies();navigation.load_page(c)})}})}}else{}}});Backbone.emulateHTTP=true;this.router=new a();Backbone.history.start({pushState:false});var b=window.location.hash;if(b==""){utilities.save_page_stat("start_up",new Date().getTime());b="page/screensaver"}else{b.replace("#","")}this.router.navigate(b,{trigger:true,replace:true});delete b;$("#backbutton").off("tap, click").on("tap, click",function(){utilities.show_popup({color:navigation._current_interface_color,motion:"exit_game",buttons:["no","yes"]},function(c){if(c==1){navigation.router.navigate("page/menu",{trigger:true,replace:true})}})});if(utilities.is_touch_screen()){$("#switchbutton").off("touchstart").off("touchend").on("touchstart",function(){navigation.switch_timeout=window.setTimeout(function(){navigation.router.navigate("page/switcher",{trigger:true,replace:true})},5000);navigation._switcher_last_date=new Date().getTime()}).on("touchend",function(){var c=new Date().getTime();if(c-navigation._switcher_last_date>=3000){navigation.router.navigate("page/switcher",{trigger:true,replace:true})}window.clearTimeout(navigation.switch_timeout)})}else{$("#switchbutton").off("mousedown").off("mouseup").on("mousedown",function(){navigation.switch_timeout=window.setTimeout(function(){navigation.router.navigate("page/switcher",{trigger:true,replace:true})},5000);navigation._switcher_last_date=new Date().getTime()}).on("mouseup",function(){var c=new Date().getTime();if(c-navigation._switcher_last_date>=3000){navigation.router.navigate("page/switcher",{trigger:true,replace:true})}window.clearTimeout(navigation.switch_timeout)})}},clear_page_memory:function(a,b){$.each(_.keys(a),function(c,d){a[d]=null});if(typeof b!=="undefined"){a=null;b()}},remove_dependencies:function(){$.each(_.keys(lib),function(b,c){lib[c]=null;delete lib[c]});var a=navigation;delete a._page_script;a._page_script=null;$.each(a.page_properties.dependencies,function(b,c){delete c.replace(".js","");$('script[src="'+c+'"]').remove()});$.each(a.page_properties.styles,function(b,c){$('link[href="pages/'+a._current_page_name+"/"+c+'"]').remove()});$(".app_content").html("");$("head script").remove();$("head style").remove();a.page_properties=null},load_page:function(b){utilities.save_page_stat(b,new Date().getTime());if(b===null){return false}TweenMax.to($(".app_content"),0.5,{backgroundColor:navigation._current_interface_color});TweenMax.to($("#backbutton"),0.5,{backgroundColor:navigation._current_interface_color});var a=this;a._current_page_name=b;$.ajax({dataType:"json",url:"pages/"+b+"/descriptor.json",data:{},success:function(c){if(typeof c.color!=="undefined"){a._current_interface_color=colors[c.color];TweenMax.to($(".app_content"),0.5,{backgroundColor:navigation._current_interface_color});TweenMax.to($("#backbutton"),0.5,{backgroundColor:navigation._current_interface_color})}a.page_properties=c;a.load_styles(function(){a.load_dependencies(function(){a.load_content(function(){a.load_sounds(function(){a.init_current_page(function(){})})})})})}})},load_sounds:function(b){var a=this;if(typeof a.page_properties.sounds!=="undefined"){$.each(a.page_properties.sounds,function(c,d){audio_manager.load_sound(d.file,d.label,function(){if(c==a.page_properties.sounds.length-1){}})})}setTimeout(function(){b()},1500)},load_styles:function(c){var b=this;$.each(b.page_properties.styles,function(d,e){b.page_properties.styles[d]="pages/"+b._current_page_name+"/"+e});var a=new createjs.LoadQueue();a.on("complete",function(){this.destroy();c()});a.loadManifest(b.page_properties.styles,false);a.load()},load_dependencies:function(b){var a=this;$.each(a.page_properties.dependencies,function(c,d){a.page_properties.dependencies[c]="pages/"+a._current_page_name+"/"+d;$("head").append('<script src="'+a.page_properties.dependencies[c]+'"><\/script>')});b()},load_content:function(b){var a=this;$(".app_content").load("pages/"+a._current_page_name+"/"+a.page_properties.content,function(){b()})},init_current_page:function(b){if(typeof this.page_properties.motion!=="undefined"&&navigation.intro){$(".app_content").append('<div class="intro_motion" id="motion_draw" style="width:'+window.innerWidth+"px; height:"+window.innerHeight+'px;"><canvas id="motion_canvas" width="'+window.innerWidth+'" height="'+window.innerHeight+'" style="background-color:rgba(0,0,0,0);"></canvas></div>');var a=this;$("#backbutton").css("display","none");TweenMax.set($(".intro_motion"),{scaleX:0,scaleY:0});TweenMax.to($(".intro_motion"),0.5,{scaleX:1,scaleY:1,onComplete:function(){},ease:Back.easeOut});if(typeof a.page_properties.motion_sound!=="undefined"){audio_manager.play_sound(a.page_properties.motion_sound,0,function(c){})}canvas=document.getElementById("motion_canvas");if(typeof lib[a.page_properties.motion]!=="undefined"){a.exportRoot=new lib[a.page_properties.motion]();a.stage=new createjs.Stage(canvas);a.exportRoot.regX=450;a.exportRoot.regY=200;a.exportRoot.x=window.innerWidth/2;a.exportRoot.y=window.innerHeight/2;a.stage.addChild(a.exportRoot);a.stage.update();createjs.Ticker.setFPS(40);createjs.Ticker.addEventListener("tick",a.stage)}else{navigation.intro=false}}else{}this._page_script=new window[this.page_properties.script_name];b();if(!navigation.intro){if(typeof window.navigation._page_script.create_interface!=="undefined"){window.navigation._page_script.create_interface()}$(".intro_motion").remove();TweenMax.set($("#backbutton"),{scaleX:0,scaleY:0});$("#backbutton").css("display","block");TweenMax.to($("#backbutton"),0.5,{scaleX:1,scaleY:1})}},intro_motion_stopped:function(){delete navigation.stage;delete navigation.exportRoot;TweenMax.to($(".intro_motion"),0.8,{opacity:0,onComplete:function(){createjs.Ticker.removeEventListener("tick",navigation.stage);if(typeof window.navigation._page_script.create_interface!=="undefined"){window.navigation._page_script.create_interface()}$(".intro_motion").remove();TweenMax.set($("#backbutton"),{scaleX:0,scaleY:0});$("#backbutton").css("display","block");TweenMax.to($("#backbutton"),0.5,{scaleX:1,scaleY:1})},ease:Back.easeIn})},refresh:function(){},destroy:function(){},kill:function(){}};