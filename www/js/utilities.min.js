var utilities={popstage:null,pop_callBack:null,pop_option:null,countCallBack:null,show_popup:function(e,d){$("#backbutton").css("display","none");if(typeof utilities._open_popup_sound==="undefined"){audio_manager.play_sound("popup_open",0,function(f){utilities._open_popup_sound=f})}else{utilities._open_popup_sound.play()}utilities.pop_callBack=d;navigation._page_script.pause();if($(".app_popup").length==0){$("body").append('<div class="app_popup"></div>')}else{$(".app_popup").html("")}TweenMax.to($(".app_popup"),0.5,{opacity:1});var c=_.template($("#app_popup_template").html());if(typeof e.buttons==="undefined"){e.buttons=["no","yes"]}$(".app_popup").append(c(e));if(typeof e.motion!=="undefined"){$(".app_popup .motion").css("display","block");if(typeof lib[e.motion+"_motion"]==="undefined"){var a=new createjs.LoadQueue();a.on("complete",function(){this.destroy();utilities.play_motion(e,"popup_motion_canvas")});a.loadManifest(["./motions/"+e.motion+"/"+e.motion+"_motion.js"],false);a.load()}else{utilities.play_motion(e,"popup_motion_canvas")}}for(var b=0;b<e.buttons.length;b++){$("#btn_"+e.buttons[b]).load("./images/assets/btn_"+e.buttons[b]+".svg",function(f){$(this).find("svg *").attr("stroke","#FFFFFF")})}if(e.buttons.length===1){$(".app_popup").off("click").on("click",function(){utilities.current_pop_root.gotoAndPlay("choice_0");utilities.pop_option=$(".popup_btn").eq(0)})}$(".popup_btn").off("click").on("click",function(){$(this).css({left:$(this).position().left,display:"block"});$(".popup_btn").css("display","none");$(this).css({position:"absolute",display:"block"});TweenMax.to($(this),0.2,{css:{width:"100%",left:"0",right:"0"}});utilities.current_pop_root.gotoAndPlay("choice_"+$(this).attr("data-value"));utilities.pop_option=$(this)});TweenMax.to($(".content_popup"),0.5,{css:{top:0},ease:Back.easeOut})},play_motion:function(c,b){var a;createjs.MotionGuidePlugin.install();a=document.getElementById(b);console.log("CREATE NEW MOTION ? ",this.current_pop_root);this.current_pop_root=new lib[c.motion+"_motion"]();console.log("CREATE NEW MOTION ? ",c.motion,"_motion");this.popstage=new createjs.Stage(a);this.popstage.addChild(this.current_pop_root);this.popstage.update();createjs.Ticker.setFPS(lib.properties.fps);createjs.Ticker.addEventListener("tick",this.popstage)},create_over_motion:function(b,a){if(typeof b.motion==="undefined"){a({message:"uknow motion"});return false}if(typeof lib[b.motion]==="undefined"){a({message:"uknow motion"});return false}if(typeof b.position==="undefined"){b.position={x:0,y:0}}if(typeof b.size==="undefined"){b.size={width:window.innerWidth,y:window.innerHeight}}if($("#"+b.motion).length===0){$("body").append('<canvas id="'+b.motion+'" class="over_motion" width="'+b.size.width+'" height="'+b.size.height+'" style="position:absolute; z-index:999999; left:'+b.position.x+"px; top:"+b.position.y+'px;"></canvas>')}canvas=document.getElementById(b.motion);this.current_over_motion=new lib[b.motion]();this.overstage=new createjs.Stage(canvas);this.overstage.addChild(this.current_over_motion);this.overstage.update();createjs.Ticker.setFPS(60);createjs.Ticker.addEventListener("tick",this.overstage)},destroy_over_motion:function(){$.each($(".over_motion"),function(b,a){$(this).remove();createjs.Ticker.removeEventListener("tick",utilities.overstage);delete utilities.overstage;utilities.current_over_motion=null})},select_pop_option:function(){var d=this.pop_option.position();var c=this.pop_option.attr("id");var a=navigation._current_interface_color;var b=this.pop_option.attr("data-value");utilities.pop_callBack(b);utilities.hide_popup()},select_pop_option_old:function(){var d=this.pop_option.position();var c=this.pop_option.attr("id");var a=navigation._current_interface_color;this.pop_option.css({position:"absolute",left:d.left+"px",top:d.top+"px"});if(this.pop_option.attr("id")=="btn_yes"){a=colors.green}else{if(this.pop_option.attr("id")=="btn_no"){a=colors.red}}$.each($(".popup_btn"),function(){if($(this).attr("id")!==c){$(this).remove()}});$(".popup_motion").remove();var b=this.pop_option.attr("data-value");TweenMax.to(this.pop_option,0.2,{css:{top:0,left:0,width:"100%",height:"100%"}});TweenMax.to($(".content_popup"),0.4,{css:{width:"220px",height:"220px",backgroundColor:a}});TweenMax.to(this.pop_option.find("svg"),0.4,{width:180,height:180,onComplete:function(){utilities.pop_callBack(b);utilities.hide_popup()},ease:Power4.easeOut})},pop_up_motion_callback:function(a){switch(a){case"pause":break;case"end":utilities.select_pop_option();createjs.Ticker.removeEventListener("tick",this.popstage);break;default:utilities.select_pop_option();createjs.Ticker.removeEventListener("tick",this.popstage);break}},hide_popup:function(a){if($(".content_popup").length===0){return false}$("#backbutton").css("display","block");if(a==0){}else{}TweenMax.to($(".content_popup"),0.5,{css:{scaleX:0,scaleY:0},ease:Back.easeIn,onComplete:function(){TweenMax.to($(".app_popup"),0.5,{opacity:0,onComplete:function(){$(".app_popup").remove();if(typeof navigation._page_script!=="undefined"&&navigation._page_script!==null){navigation._page_script.play()}}})}});if(typeof utilities._close_popup_sound==="undefined"){audio_manager.play_sound("popup_close",0,function(b){utilities._close_popup_sound=b})}else{utilities._close_popup_sound.play()}},colorLuminance:function(e,a){e=String(e).replace(/[^0-9a-f]/gi,"");if(e.length<6){e=e[0]+e[0]+e[1]+e[1]+e[2]+e[2]}a=a||0;var b="#",f,d;for(d=0;d<3;d++){f=parseInt(e.substr(d*2,2),16);f=Math.round(Math.min(Math.max(0,f+(f*a)),255)).toString(16);b+=("00"+f).substr(f.length)}return b},is_touch_screen:function(){if("ontouchstart" in document.documentElement||(window.navigator.maxTouchPoints&&window.navigator.maxTouchPoints>=1)){return true}else{return false}},save_page_stat:function(b,a){if(typeof _node==="undefined"){_node=new node_utilities()}_node.insert_datas("stats",{page:{type:"TEXT",value:b},date:{type:"TEXT",value:a},saved:{type:"TEXT",value:"false"}},function(c){console.log("back from sqlite :::: ",c)})},save_score_game:function(b,a){if(typeof _node==="undefined"){_node=new node_utilities()}_node.insert_datas(b,{name:{type:"TEXT",value:b},score:{type:"TEXT",value:a},saved:{type:"TEXT",value:"false"}},function(c){})},show_score_game:function(e,d){$("#backbutton").css("display","none");if(typeof utilities._open_popup_sound==="undefined"){audio_manager.play_sound("popup_open",0,function(f){utilities._open_popup_sound=f})}else{utilities._open_popup_sound.play()}if($(".app_popup").length==0){$("body").append('<div class="app_popup"></div>')}else{$(".app_popup").html("")}var a="";if(typeof require==="undefined"){a="no_require";TweenMax.to($(".app_popup"),0.5,{opacity:1});var b=_.template($("#score_popup_template").html());var c={color:navigation._current_interface_color,list:[],score:d,error:a};$(".app_popup").append(b(c));TweenMax.to($(".content_popup"),0.5,{css:{top:0},ease:Back.easeOut});$(".right_icon").on("click",function(){$(".right_icon").off("click");utilities.hide_popup()})}else{if(typeof _node==="undefined"){_node=new node_utilities()}_node.get_datas(e,{score:d,limit:1000},function(f){$.each(f.datas,function(g,h){f.datas[g].scoring=Math.round(parseInt(f.datas[g].score))});setTimeout(function(){var i=_.sortBy(f.datas,"scoring").reverse();TweenMax.to($(".app_popup"),0.5,{opacity:1});var g=_.template($("#score_popup_template").html());var h={color:navigation._current_interface_color,list:i,score:d,error:a};$(".app_popup").append(g(h));TweenMax.to($(".content_popup"),0.5,{css:{top:0},ease:Back.easeOut});$(".right_icon").on("click",function(){utilities.scrore_scroll.destroy();utilities.scrore_scroll=null;$(".right_icon").off("click");utilities.hide_popup()});utilities.scrore_scroll=new IScroll("#score_wrapper");setTimeout(function(){utilities.scrore_scroll.refresh();utilities.scrore_scroll.scrollToElement(document.querySelector("#my_score"),null,null,true)},1000)},1000)})}}};function rgb2hex(a){a=a.match(/^rgba?[\s+]?\([\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?/i);return(a&&a.length===4)?"#"+("0"+parseInt(a[1],10).toString(16)).slice(-2)+("0"+parseInt(a[2],10).toString(16)).slice(-2)+("0"+parseInt(a[3],10).toString(16)).slice(-2):""}var colors={purple:"#612B9B",green:"#44AC34",orange:"#FF821D",lighblue:"#33CAD2",pink:"#E41694",maroon:"#784217",grey:"#7D868B",red:"#DA0036",fblue:"#0095A7",yellow:"#FFCF00",dgreen:"#008274",sblue:"#465FC4",blue:"#042367",black:"#000000"};