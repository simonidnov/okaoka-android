function number(){this.circle_base=50,this.max_try=150,this._time_lap=6e4,this.check_num=0,this.game_infos={great:0,wrong:0},this.colors=_.clone(colors),delete this.colors.dgreen,delete this.colors.black,delete this.colors.maroon,this.level=1,this.circles=[],this.base="pages/number/",_okg=this}var _okg=null;number.prototype.init=function(){this.create_interface()},number.prototype.replay_game=function(){window.location.href=window.location.href+"/intro/false",gui.Window.get().reload(3)},number.prototype.create_interface=function(){$("#number_canvas").css({width:window.innerWidth,height:window.innerHeight}),$("#number_canvas").attr({width:window.innerWidth,height:window.innerHeight}),this.stage=new createjs.Stage("number_canvas"),this.stage.autoClear=!0,this.stage.update(),this.build_chronos_line(),this.create_taskbar(),createjs.Touch.enable(this.stage),createjs.Ticker.addEventListener("tick",this.tick),createjs.Ticker.setFPS(60),utilities.show_popup({color:navigation._current_interface_color,motion:"number_tuto_popup",buttons:["play"]},function(e){_okg.count_start_chronos(function(){_okg.create_level(),_okg.start_date=(new Date).getTime(),_okg.okaokasprite.gotoAndPlay("run"),_okg.started=!0})})},number.prototype.create_circle=function(){for(var e=window.innerWidth-400,t=window.innerHeight-200,o=0;;){for(var i=_okg.circle_base+Math.random()*_okg.circle_base,s=Math.random()*(e-2*i)+i,n=Math.random()*(t-2*i)+i,a=0,r=0;r<_okg.circles.length;r++){var c=_okg.circles[r],h=s-c.x,l=n-c.y,_=i+c.radius;_*_>h*h+l*l&&a++}if(0==a)break;var s=Math.random()*(e-2*i)+i,n=Math.random()*(t-2*i)+i;if(o++,o===_okg.max_try)break}o<_okg.max_try&&_okg.circles.push({x:s,y:n,radius:i,color:"#FFFFFF",countdown:500+1e3*Math.random()})},number.prototype.create_level=function(){var e=new createjs.Text;e.font="700 50px Roboto",e.color="#FFFFFF",e.text=this.level,e.textAlign="center",e.x=window.innerWidth/2-e.getBounds().width,e.y=window.innerHeight/2-e.getBounds().height,e.regY=e.getBounds().height/2,this.stage.addChild(e),TweenMax.to(e,1.4,{scaleX:13,scaleY:13,alpha:0,onComplete:function(){_okg.started&&(_okg.stage.removeChild(e),_okg.add_circles())},ease:Quart.easeOut}),"undefined"==typeof _okg._number_level_sound?audio_manager.play_sound("number_level",0,function(e){_okg._number_level_sound=e}):_okg._number_level_sound.play()},number.prototype.add_circles=function(){this.circles=[];var e=Math.floor(Math.random()*_.keys(this.colors).length),t=this.colors[_.keys(this.colors)[e]];navigation._current_interface_color=t,this.colors=_.clone(colors),delete this.colors[_.keys(this.colors)[e]],delete this.colors.black,delete this.colors.maroon,TweenMax.to($(".app_content"),.5,{css:{backgroundColor:t}}),TweenMax.to($("#backbutton"),.5,{css:{backgroundColor:t}});for(var o=0;o<this.level+1;o++)this.create_circle(),o===this.level&&this.draw_circles()},number.prototype.difficulty=function(){this.pause(),utilities.show_popup({color:colors.yellow,motion:"number_difficulty_popup",buttons:["play"]},function(e){_okg.play()})},number.prototype.draw_circles=function(){if(!_okg.started)return!1;lastcount=1,54===this.game_infos.great&&this.difficulty();for(var e=0;e<_okg.circles.length;e++){var t=_okg.circles[e],o=_okg.stage.addChild(new createjs.Container),i=new createjs.Shape;color="#FFFFFF",i.graphics.beginFill(color).drawCircle(0,0,t.radius);var s=new createjs.Text;s.font="700 50px Roboto",s.color=navigation._current_interface_color,this.game_infos.great>54?s.text=lastcount+Math.round(3*Math.random()):this.game_infos.great>74?s.text=lastcount+Math.round(5*Math.random()):s.text=lastcount,lastcount=parseInt(s.text)+1,s.textAlign="center",s.y=-30,o.identifier=e+1,o.name="circle_"+e,o.addChild(i),o.addChild(s),o.x=t.x+200,o.y=t.y+100,o.mouseChildren=!1,o.addEventListener("click",function(e){"undefined"==typeof _okg._number_hit_sound?audio_manager.play_sound("number_hit",0,function(e){_okg._number_hit_sound=e}):_okg._number_hit_sound.play(),_okg.check_blob(e.target.identifier,e.target)}),TweenMax.set(o,{scaleX:0,scaleY:0}),TweenMax.to(o,.5,{scaleX:1,scaleY:1,delay:.1*e})}},number.prototype.check_blob=function(e,t){this.check_num+1===e?(this.game_infos.great++,this.check_num=e,TweenMax.to(t,.5,{scaleX:0,scaleY:0,ease:Back.easeIn,onComplete:function(){_okg.stage.removeChild(t)}}),e===this.circles.length&&(this.level++,this.check_num=0,this.create_level()),"undefined"==typeof _okg._number_win_sound?audio_manager.play_sound("number_win",0,function(e){_okg._number_win_sound=e}):_okg._number_win_sound.play()):(this.game_infos.wrong++,TweenMax.to(t,.1,{bezier:[{x:t.x-10}],x:t.x+10,yoyo:!0,repeat:5,onComplete:function(){}}),"undefined"==typeof _okg._number_fail_sound?audio_manager.play_sound("number_fail",0,function(e){_okg._number_fail_sound=e}):_okg._number_fail_sound.play())},number.prototype.tick=function(){_okg.started&&_okg.update_chronos(),_okg.stage.update()},number.prototype.pause=function(){_okg._pause_date=(new Date).getTime(),_okg.started=!1},number.prototype.play=function(){"undefined"!=typeof _okg.start_date&&(_okg._pause_end_date=(new Date).getTime(),console.log("_okg._pause_date ",_okg._pause_date),console.log("_okg.start_date ",_okg.start_date),_okg.start_date=(new Date).getTime()),_okg.started=!0},number.prototype.destroy=function(e){this.tick&&createjs.Ticker.removeEventListener("tick",this.tick),e()},number.prototype.update_chronos=function(){if(!_okg.started)return console.log("_okg.started ",_okg.started),!1;var e=(new Date).getTime(),t=e-this.start_date,o=this._time_lap-t;Math.ceil(o/1e3)&&(this.chronostext.text=Math.ceil(o/1e3)),this.greattext.text=this.game_infos.great,this.wrongtext.text=this.game_infos.wrong;var i=100-100*o/this._time_lap;this.chronos_line_progress.scaleX=i/100,this.okaokasprite.x=window.innerWidth*(i/100)-50,0>=o&&(console.log("le jeu est fini chronos"),this.started=!1,this.okaokasprite.gotoAndStop("stand"),this.end_game())},number.prototype.create_taskbar=function(){this.score_infos=this.stage.addChild(new createjs.Container),this.score_infos_ground=new createjs.Shape,this.score_infos.addChild(this.score_infos_ground),this.greatsprite=new createjs.Bitmap("pages/simplediscs/images/great.png"),this.wrongsprite=new createjs.Bitmap("pages/simplediscs/images/wrong.png"),this.chronosprite=new createjs.Bitmap("pages/simplediscs/images/chronos.png"),this.greattext=new createjs.Text,this.greattext.font="100 35px Roboto",this.greattext.color="#FFFFFF",this.greattext.text="0",this.wrongtext=new createjs.Text,this.wrongtext.font="100 35px Roboto",this.wrongtext.color="#FFFFFF",this.wrongtext.text="0",this.chronostext=new createjs.Text,this.chronostext.font="100 35px Roboto",this.chronostext.color="#FFFFFF",this.chronostext.text="60",this.greatsprite.regX=this.greatsprite.regY=this.wrongsprite.regX=this.wrongsprite.regY=this.chronosprite.regX=this.chronosprite.regY=20,this.greattext.textAlign="center",this.wrongtext.textAlign="center",this.chronostext.textAlign="center",this.greatsprite.y=this.wrongsprite.y=this.chronosprite.y=20,this.chronosprite.x=20,this.chronostext.x=20,this.chronostext.y=50,this.greatsprite.x=110,this.greattext.x=110,this.greattext.y=50,this.wrongsprite.x=200,this.wrongtext.x=200,this.wrongtext.y=50;var e={images:["./pages/dots/images/five_hits_sprite.png"],frames:{width:100,height:100},animations:{hit:[0,15,!0],stop:16}},t=new createjs.SpriteSheet(e);e=null,delete e,this.fivehits=new createjs.Sprite(t,"stop"),this.fivehits.regX=this.fivehits.regY=25,this.fivehits.x=-3,this.fivehits.y=45,this.score_infos.addChild(this.fivehits),this.score_infos.addChild(this.greatsprite),this.score_infos.addChild(this.wrongsprite),this.score_infos.addChild(this.chronosprite),this.score_infos.addChild(this.greattext),this.score_infos.addChild(this.wrongtext),this.score_infos.addChild(this.chronostext),this.score_infos.x=window.innerWidth/2-this.score_infos.getBounds().width/2,this.score_infos.y=20},number.prototype.destroy_circles=function(){for(var e=0;e<this.stage.getNumChildren();e++)null!==this.stage.getChildAt(e).name&&(console.log(this.stage.getChildAt(e).name.indexOf("circle")),-1!==this.stage.getChildAt(e).name.indexOf("circle")&&TweenMax.to(this.stage.getChildAt(e),.2,{scaleX:0,scaleY:0,onComplete:function(){_okg.stage.removeChild($(this))}}))},number.prototype.end_game=function(){this.destroy_circles(),TweenMax.to(_okg.score_infos,.5,{y:window.innerHeight/2-_okg.score_infos.getBounds().height/2,x:window.innerWidth/2-_okg.score_infos.getBounds().width/2,ease:Power4.easeInOut,delay:.5,onComplete:function(){_okg.destroy_circles(),utilities.create_over_motion({size:{width:400,height:200},position:{x:window.innerWidth/2-200,y:window.innerHeight/2-265},motion:"winning_dance_top_motion"},function(){}),createjs.Ticker.setFPS(30),_okg.total_score_text=new createjs.Text,_okg.total_score_text.font="700 100px Roboto",_okg.total_score_text.color="#FFFFFF",_okg.total_score_text.text="00000",_okg.total_score_text.textAlign="center",_okg.total_score_text.x=window.innerWidth/2,_okg.total_score_text.y=_okg.score_infos.y+_okg.score_infos.getBounds().height,_okg.stage.addChild(_okg.total_score_text);var e=(_okg.game_infos.great-_okg.game_infos.wrong)*_okg.level;0>e&&(e=0);var t={total:0};audio_manager.play_sound("total_count",0,function(e){}),TweenMax.to(t,2.5,{total:e,delay:.6,onUpdate:function(){var e="",o=Math.ceil(t.total);if(o.toString().length<5)for(var i=5-o.toString().length,s=0;i>s;s++)e+="0";e+=o.toString(),_okg.total_score_text.text=e},ease:Power4.easeOut,onComplete:function(){_okg.replay_button=new createjs.Bitmap("./images/assets/btn_replay.png"),_okg.replay_button.x=window.innerWidth/2+70,_okg.replay_button.y=_okg.total_score_text.y+_okg.total_score_text.getBounds().height+70,_okg.replay_button.regX=_okg.replay_button.regY=50,_okg.replay_button.scaleX=_okg.replay_button.scaleY=0,_okg.stats_button=new createjs.Bitmap("./images/assets/btn_podium.png"),_okg.stats_button.x=window.innerWidth/2-70,_okg.stats_button.y=_okg.total_score_text.y+_okg.total_score_text.getBounds().height+70,_okg.stats_button.regX=_okg.stats_button.regY=50,_okg.stats_button.scaleX=_okg.stats_button.scaleY=0;var t=new createjs.Graphics;t.beginFill(navigation._current_interface_color),t.drawCircle(50,50,50),t.endFill(),_okg.replay_button.hitArea=new createjs.Shape(t),_okg.stats_button.hitArea=new createjs.Shape(t),utilities.save_score_game("number",e),_okg.replay_button.addEventListener("click",function(e){window.location.href="#page/"+navigation._current_page_name+"/intro/false/date/"+(new Date).getTime()}),_okg.stats_button.addEventListener("click",function(t){utilities.show_score_game("number",e)}),TweenMax.to(_okg.replay_button,.5,{scaleX:1,scaleY:1}),TweenMax.to(_okg.stats_button,.5,{scaleX:1,scaleY:1,delay:.2}),_okg.stage.addChild(_okg.replay_button),_okg.stage.addChild(_okg.stats_button)}})}})},number.prototype.count_start_chronos=function(e){this.countGround=new createjs.Shape,this.countGround.graphics.beginFill(navigation._current_interface_color),this.countGround.graphics.drawCircle(0,0,70),this.countGround.scaleX=this.countGround.scaleY=0,this.countGround.x=window.innerWidth/2,this.countGround.y=window.innerHeight/2,TweenMax.to(this.countGround,.5,{scaleX:1,scaleY:1}),this.stage.addChild(this.countGround),this.countMotion=new lib.count_3,this.countMotion.regX=275,this.countMotion.regY=200,this.countMotion.x=window.innerWidth/2,this.countMotion.y=window.innerHeight/2,this.stage.addChild(this.countMotion),utilities.countCallBack=function(){TweenMax.to(_okg.countGround,.5,{scaleX:0,scaleY:0}),_okg.stage.removeChild(_okg.countMotion),_okg.stage.removeChild(_okg.countGround),e()}},number.prototype.build_chronos_line=function(){this.okaokarun=new Image,this.okaokarun.src="pages/simplediscs/images/simple_run.png",this.chronos_line=this.stage.addChild(new createjs.Container),this.chronos_line.regY=25,this.chronos_line.y=window.innerHeight,this.chronos_line_ground=new createjs.Shape,this.chronos_line_ground.graphics.beginFill("rgba(0,0,0,.3)"),this.chronos_line_ground.graphics.drawRect(0,0,window.innerWidth,25),this.chronos_line.addChild(this.chronos_line_ground),this.chronos_line_progress=new createjs.Shape,this.chronos_line_progress.graphics.beginFill("#FFFFFF"),this.chronos_line_progress.graphics.drawRect(0,0,window.innerWidth,25),this.chronos_line_progress.scaleX=0,this.chronos_line.addChild(this.chronos_line_progress);var e={images:[this.okaokarun],frames:{width:80,height:80},animations:{stand:{frames:[0]},run:{frames:[0,0,1,1,2,2,3,3,4,4,5,5,6,6],frequency:50},great:{frames:[7,7,8,8,9,9,10,10,11,11,12,12,13,13,14,14,15,15,16],next:"run"},wrong:{frames:[17,17,18,18,19,19,20,20,21,21,22,22,23,23,24],next:"wrongslide"},wrongslide:{frames:[21,21,22,22,23,23,21,21,22,22,23,23,21,21,22,22,23,23,21,21,22,22,23,23],next:"run"}},framerate:5},t=new createjs.SpriteSheet(e);this.okaokasprite=new createjs.Sprite(t,"run"),this.okaokasprite.scaleX=this.okaokasprite.scaleY=.7,this.okaokasprite.y=-55,this.okaokasprite.gotoAndStop("stand"),this.chronos_line.addChild(this.okaokasprite)};