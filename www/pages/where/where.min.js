function where(){this.circle_base=50,this.max_try=150,this._time_lap=12e4,this.check_num=0,this.balls=1,this.game_infos={great:0,wrong:0},this.colors=_.clone(colors),delete this.colors.dgreen,delete this.colors.black,delete this.colors.maroon,this.level=1,this.circles=[],this.base="pages/where/",_okg=this,this._current_response=0}var _okg=null;where.prototype.init=function(){this.create_interface()},where.prototype.replay_game=function(){window.location.href=window.location.href+"/intro/false",gui.Window.get().reload(3)},where.prototype.create_interface=function(){$("#where_canvas").css({width:window.innerWidth,height:window.innerHeight}),$("#where_canvas").attr({width:window.innerWidth,height:window.innerHeight}),this.stage=new createjs.Stage("where_canvas"),this.stage.autoClear=!0,this.stage.update(),this.build_chronos_line(),this.create_taskbar(),createjs.Touch.enable(this.stage),createjs.Ticker.addEventListener("tick",this.tick),createjs.Ticker.setFPS(60),utilities.show_popup({color:navigation._current_interface_color,motion:"where_tuto_popup",buttons:["play"]},function(e){_okg.count_start_chronos(function(){_okg.create_level(),_okg.start_date=(new Date).getTime(),_okg.okaokasprite.gotoAndPlay("run"),_okg.started=!0})})},where.prototype.create_level=function(){var e=new createjs.Text;e.font="700 50px Roboto",e.color="#FFFFFF",e.text=this.level,e.textAlign="center",e.x=window.innerWidth/2-e.getBounds().width,e.y=window.innerHeight/2-e.getBounds().height,e.regY=e.getBounds().height/2,this.stage.addChild(e),TweenMax.to(e,1.4,{scaleX:13,scaleY:13,alpha:0,onComplete:function(){_okg.started&&(_okg.stage.removeChild(e),_okg.create_choices())},ease:Quart.easeOut})},where.prototype.create_choices=function(){for(var e=Math.floor(4*Math.random()),t=0;4>t;t++){var a=_okg.stage.addChild(new createjs.Container);if(t===e){var o=new createjs.Shape;o.graphics.beginFill("#FFF000").drawCircle(55,104,16),a.addChild(o),a.is_great=!0}else a.is_great=!1;var s=_okg.stage.addChild(new createjs.Container),i=new createjs.Shape;i.graphics.beginFill("#FFFFFF").drawRoundRectComplex(5,0,100,81,50,50,0,0),s.addChild(i);var n=new createjs.Shape;n.graphics.beginFill("#FFFFFF").drawRoundRect(0,120,110,14,7),a.addChild(n),s.name="capsule",a.addChild(s),a.name="choice_"+t,a.mouseChildren=!1,a.y=window.innerHeight/2-50,a.x=window.innerWidth/2-300+180*t,this.stage.addChild(a)}setTimeout(function(){for(var e=0;4>e;e++)TweenMax.to(_okg.stage.getChildByName("choice_"+e).getChildByName("capsule"),.5,{y:42,delay:.1*e});setTimeout(function(){null!==_okg&&_okg.mix_positions(0)},1200)},2e3)},where.prototype.add_ball=function(e){var t=this.stage.getChildByName("choice_"+e),a=new createjs.Shape;this.balls++,a.graphics.beginFill("#FFF000").drawCircle(55,104,16),a.name="dot",t.addChildAt(a,0),t.is_great=!0;for(var o=0;4>o;o++)TweenMax.to(_okg.stage.getChildByName("choice_"+o).getChildByName("capsule"),.5,{y:0,delay:.1*o}),TweenMax.to(_okg.stage.getChildByName("choice_"+o).getChildByName("capsule"),.5,{y:42,delay:2+.1*o});setTimeout(function(){_okg.mix_positions(0)},2500)},where.prototype.mix_positions=function(e){if(this._current_response=0,!_okg.started)return!1;var t=[0,1,2,3],a=this.level;if(a>3&&(a=3),e===a+2){for(var o=0;4>o;o++)this.stage.getChildByName("choice_"+o).addEventListener("click",function(e){_okg.response(e.target.is_great,e.target.name)});return!1}var s=t[Math.floor(Math.random()*t.length)];t.splice(s,1);var i=t[Math.floor(Math.random()*t.length)];this.move_capsule(s,i,function(){e++,_okg.mix_positions(e)})},where.prototype.move_capsule=function(e,t,a){if(!_okg.started)return!1;if(e===t)return a(),!1;var o=this.stage.getChildByName("choice_"+e),s=this.stage.getChildByName("choice_"+t),i={0:{y:o.y,x:o.x},1:{y:s.y,x:s.x}},n=.5-_okg.level/10;console.log("speed >>>> ",n),.15>n&&(n=.15);o.x-(i[0].x+i[1].x)/2;TweenMax.to(o,n,{x:(i[0].x+i[1].x)/2,y:i[1].y,ease:Power4.easeIn,bezier:[{y:i[1].y-100}],onComplete:function(){TweenMax.to(o,n+.2,{y:i[1].y,x:i[1].x,ease:Power4.easeOut})}}),TweenMax.to(s,n,{x:(i[0].x+i[1].x)/2,y:i[0].y,ease:Power4.easeIn,bezier:[{y:i[0].y+100}],onComplete:function(){TweenMax.to(s,n+.2,{y:i[0].y,x:i[0].x,ease:Power4.easeOut,onComplete:function(){a()}})}}),"undefined"==typeof _okg._where_move_sound?(console.log("set sound"),audio_manager.play_sound("where_move",0,function(e){console.log("_where_move_sound ",e),_okg._where_move_sound=e})):(console.log("play sound"),_okg._where_move_sound.play())},where.prototype.response=function(e,t){if("undefined"==typeof _okg._where_hit_sound?audio_manager.play_sound("where_hit",0,function(e){_okg._where_hit_sound=e}):_okg._where_hit_sound.play(),e){if(_okg.game_infos.great++,TweenMax.to(_okg.stage.getChildByName(t).getChildByName("capsule"),.5,{y:0,delay:.1*a}),this._current_response++,this._current_response<this.balls)return!1;"undefined"==typeof _okg._where_win_sound?audio_manager.play_sound("where_win",0,function(e){_okg._where_win_sound=e}):_okg._where_win_sound.play()}else _okg.game_infos.wrong++,"undefined"==typeof _okg._where_fail_sound?audio_manager.play_sound("where_fail",0,function(e){_okg._where_fail_sound=e}):_okg._where_fail_sound.play();for(var a=0;4>a;a++){var o=this.stage.getChildByName("choice_"+a);o.removeAllEventListeners(),TweenMax.to(_okg.stage.getChildByName("choice_"+a).getChildByName("capsule"),.5,{y:0,delay:.1*a})}setTimeout(function(){_okg.destroy_level()},1e3)},where.prototype.destroy_level=function(){this.colors=_.clone(colors),delete this.colors.yellow,delete this.colors.black,delete this.colors.maroon;var e=Math.floor(Math.random()*_.keys(this.colors).length),t=this.colors[_.keys(this.colors)[e]];TweenMax.to($(".app_content"),.5,{css:{backgroundColor:t}}),TweenMax.to($("#backbutton"),.5,{css:{backgroundColor:t}});for(var a=0;4>a;a++){var o=this.stage.getChildByName("choice_"+a);TweenMax.to(o.getChildByName("capsule"),.5,{y:42,delay:.1*a})}return setTimeout(function(){if(_okg.level++,5===_okg.level)for(var e=!1,t=0;4>t;t++)_okg.stage.getChildByName("choice_"+t).is_great||e!==!1||(e=!0,_okg.add_ball(t));else _okg.mix_positions(0)},2e3),!1},where.prototype.tick=function(){_okg.started&&_okg.update_chronos(),_okg.stage.update()},where.prototype.pause=function(){},where.prototype.play=function(){},where.prototype.destroy=function(e){this.tick&&createjs.Ticker.removeEventListener("tick",this.tick),e()},where.prototype.update_chronos=function(){var e=(new Date).getTime(),t=e-this.start_date,a=this._time_lap-t;this.chronostext.text=Math.ceil(a/1e3),this.greattext.text=this.game_infos.great,this.wrongtext.text=this.game_infos.wrong;var o=100-100*a/this._time_lap;this.chronos_line_progress.scaleX=o/100,this.okaokasprite.x=window.innerWidth*(o/100)-50,0>=a&&(console.log("le jeu est fini chronos"),this.started=!1,this.okaokasprite.gotoAndStop("stand"),this.end_game())},where.prototype.create_taskbar=function(){this.score_infos=this.stage.addChild(new createjs.Container),this.score_infos_ground=new createjs.Shape,this.score_infos.addChild(this.score_infos_ground),this.greatsprite=new createjs.Bitmap("pages/simplediscs/images/great.png"),this.wrongsprite=new createjs.Bitmap("pages/simplediscs/images/wrong.png"),this.chronosprite=new createjs.Bitmap("pages/simplediscs/images/chronos.png"),this.greattext=new createjs.Text,this.greattext.font="100 35px Roboto",this.greattext.color="#FFFFFF",this.greattext.text="0",this.wrongtext=new createjs.Text,this.wrongtext.font="100 35px Roboto",this.wrongtext.color="#FFFFFF",this.wrongtext.text="0",this.chronostext=new createjs.Text,this.chronostext.font="100 35px Roboto",this.chronostext.color="#FFFFFF",this.chronostext.text="60",this.greatsprite.regX=this.greatsprite.regY=this.wrongsprite.regX=this.wrongsprite.regY=this.chronosprite.regX=this.chronosprite.regY=20,this.greattext.textAlign="center",this.wrongtext.textAlign="center",this.chronostext.textAlign="center",this.greatsprite.y=this.wrongsprite.y=this.chronosprite.y=20,this.chronosprite.x=20,this.chronostext.x=20,this.chronostext.y=50,this.greatsprite.x=110,this.greattext.x=110,this.greattext.y=50,this.wrongsprite.x=200,this.wrongtext.x=200,this.wrongtext.y=50;var e={images:["./pages/dots/images/five_hits_sprite.png"],frames:{width:100,height:100},animations:{hit:[0,15,!0],stop:16}},t=new createjs.SpriteSheet(e);e=null,delete e,this.fivehits=new createjs.Sprite(t,"stop"),this.fivehits.regX=this.fivehits.regY=25,this.fivehits.x=-3,this.fivehits.y=45,this.score_infos.addChild(this.fivehits),this.score_infos.addChild(this.greatsprite),this.score_infos.addChild(this.wrongsprite),this.score_infos.addChild(this.chronosprite),this.score_infos.addChild(this.greattext),this.score_infos.addChild(this.wrongtext),this.score_infos.addChild(this.chronostext),this.score_infos.x=window.innerWidth/2-this.score_infos.getBounds().width/2,this.score_infos.y=20},where.prototype.destroy_circles=function(){for(var e=0;e<this.stage.getNumChildren();e++)null!==this.stage.getChildAt(e).name&&(console.log(this.stage.getChildAt(e).name.indexOf("circle")),-1!==this.stage.getChildAt(e).name.indexOf("circle")&&TweenMax.to(this.stage.getChildAt(e),.2,{scaleX:0,scaleY:0,onComplete:function(){_okg.stage.removeChild($(this))}}))},where.prototype.end_game=function(){for(var e=0;4>e;e++){var t=_okg.stage.getChildByName("choice_"+e);null!==t&&(t.removeAllEventListeners(),_okg.stage.removeChild(t))}this.destroy_circles(),TweenMax.to(_okg.score_infos,.5,{y:window.innerHeight/2-_okg.score_infos.getBounds().height/2,x:window.innerWidth/2-_okg.score_infos.getBounds().width/2,ease:Power4.easeInOut,delay:.5,onComplete:function(){_okg.destroy_circles(),utilities.create_over_motion({size:{width:400,height:200},position:{x:window.innerWidth/2-200,y:window.innerHeight/2-265},motion:"winning_dance_top_motion"},function(){}),createjs.Ticker.setFPS(30),_okg.total_score_text=new createjs.Text,_okg.total_score_text.font="700 100px Roboto",_okg.total_score_text.color="#FFFFFF",_okg.total_score_text.text="00000",_okg.total_score_text.textAlign="center",_okg.total_score_text.x=window.innerWidth/2,_okg.total_score_text.y=_okg.score_infos.y+_okg.score_infos.getBounds().height,_okg.stage.addChild(_okg.total_score_text);var e=(_okg.game_infos.great-_okg.game_infos.wrong)*_okg.level;0>e&&(e=0);var t={total:0};audio_manager.play_sound("total_count",0,function(e){}),TweenMax.to(t,2.5,{total:e,delay:.6,onUpdate:function(){var e="",a=Math.ceil(t.total);if(a.toString().length<5)for(var o=5-a.toString().length,s=0;o>s;s++)e+="0";e+=a.toString(),_okg.total_score_text.text=e},ease:Power4.easeOut,onComplete:function(){_okg.replay_button=new createjs.Bitmap("./images/assets/btn_replay.png"),_okg.replay_button.x=window.innerWidth/2+70,_okg.replay_button.y=_okg.total_score_text.y+_okg.total_score_text.getBounds().height+70,_okg.replay_button.regX=_okg.replay_button.regY=50,_okg.replay_button.scaleX=_okg.replay_button.scaleY=0,_okg.stats_button=new createjs.Bitmap("./images/assets/btn_podium.png"),_okg.stats_button.x=window.innerWidth/2-70,_okg.stats_button.y=_okg.total_score_text.y+_okg.total_score_text.getBounds().height+70,_okg.stats_button.regX=_okg.stats_button.regY=50,_okg.stats_button.scaleX=_okg.stats_button.scaleY=0;var t=new createjs.Graphics;t.beginFill(navigation._current_interface_color),t.drawCircle(50,50,50),t.endFill(),_okg.replay_button.hitArea=new createjs.Shape(t),_okg.stats_button.hitArea=new createjs.Shape(t),utilities.save_score_game("where",e),_okg.replay_button.addEventListener("click",function(e){window.location.href="#page/"+navigation._current_page_name+"/intro/false/date/"+(new Date).getTime()}),_okg.stats_button.addEventListener("click",function(t){utilities.show_score_game("where",e)}),TweenMax.to(_okg.replay_button,.5,{scaleX:1,scaleY:1}),TweenMax.to(_okg.stats_button,.5,{scaleX:1,scaleY:1,delay:.2}),_okg.stage.addChild(_okg.replay_button),_okg.stage.addChild(_okg.stats_button)}})}})},where.prototype.count_start_chronos=function(e){this.countGround=new createjs.Shape,this.countGround.graphics.beginFill(navigation._current_interface_color),this.countGround.graphics.drawCircle(0,0,70),this.countGround.scaleX=this.countGround.scaleY=0,this.countGround.x=window.innerWidth/2,this.countGround.y=window.innerHeight/2,TweenMax.to(this.countGround,.5,{scaleX:1,scaleY:1}),this.stage.addChild(this.countGround),this.countMotion=new lib.count_3,this.countMotion.regX=275,this.countMotion.regY=200,this.countMotion.x=window.innerWidth/2,this.countMotion.y=window.innerHeight/2,this.stage.addChild(this.countMotion),utilities.countCallBack=function(){TweenMax.to(_okg.countGround,.5,{scaleX:0,scaleY:0}),_okg.stage.removeChild(_okg.countMotion),_okg.stage.removeChild(_okg.countGround),e()}},where.prototype.build_chronos_line=function(){console.log("chronos line"),this.okaokarun=new Image,this.okaokarun.src="pages/simplediscs/images/simple_run.png",this.chronos_line=this.stage.addChild(new createjs.Container),this.chronos_line.regY=25,this.chronos_line.y=window.innerHeight,this.chronos_line_ground=new createjs.Shape,this.chronos_line_ground.graphics.beginFill("rgba(0,0,0,.3)"),this.chronos_line_ground.graphics.drawRect(0,0,window.innerWidth,25),this.chronos_line.addChild(this.chronos_line_ground),this.chronos_line_progress=new createjs.Shape,this.chronos_line_progress.graphics.beginFill("#FFFFFF"),this.chronos_line_progress.graphics.drawRect(0,0,window.innerWidth,25),this.chronos_line_progress.scaleX=0,this.chronos_line.addChild(this.chronos_line_progress);var e={images:[this.okaokarun],frames:{width:80,height:80},animations:{stand:{frames:[0]},run:{frames:[0,0,1,1,2,2,3,3,4,4,5,5,6,6],frequency:50},great:{frames:[7,7,8,8,9,9,10,10,11,11,12,12,13,13,14,14,15,15,16],next:"run"},wrong:{frames:[17,17,18,18,19,19,20,20,21,21,22,22,23,23,24],next:"wrongslide"},wrongslide:{frames:[21,21,22,22,23,23,21,21,22,22,23,23,21,21,22,22,23,23,21,21,22,22,23,23],next:"run"}},framerate:5},t=new createjs.SpriteSheet(e);this.okaokasprite=new createjs.Sprite(t,"run"),this.okaokasprite.scaleX=this.okaokasprite.scaleY=.7,this.okaokasprite.y=-55,this.okaokasprite.gotoAndStop("stand"),this.chronos_line.addChild(this.okaokasprite)};