function guess_game_page(){this.infos=null,this._user_datas=null,this._openent_datas=null,this._user_questions=_.map(lang[app.language].questions,_.clone),this._openent_questions=_.map(lang[app.language].questions_openent,_.clone),this.question_scroll=null}guess_game_page.prototype.init=function(){$(".game_screen, .transition_screen").css("width",window.innerWidth),$(".guess_game .guess_game_container .game_screen .cards_items").css("height",window.innerHeight-145+"px"),$("#user_game_screen .button_propose, #user_game_screen .button_question").css("display","block"),$("#user_game_screen .button_valid").css("display","none"),this.infos=JSON.parse(window.localStorage.getItem("game_settings")),this._user_datas=_.where(this.infos.characters,{id:this.infos.character_id})[0],this._openent_datas=this.infos.characters[Math.floor(16*Math.random())],this.infos.openent_id=this._openent_datas.id,window.localStorage.setItem("game_settings",JSON.stringify(this.infos)),this.display_cards()},guess_game_page.prototype.display_cards=function(){var e=this;this.infos.characters=app.shuffle(this.infos.characters);for(var t=_.template($("#player_card_template").html()),s=0;s<this.infos.characters.length;s++)$("#user_game_screen .cards_items").append(t(this.infos.characters[s])),$("#opponent_game_screen .cards_items").append(t(this.infos.characters[s]));$("#user_game_screen .game_menu").css({"background-color":this._user_datas.parsed_datas.bkcolor}),$("#user_game_screen .avatar").css({"background-image":"url("+encodeURI(app.pix_to_uri(this._user_datas.base64,"thumb"))+")","background-color":this._user_datas.parsed_datas.bkcolor});for(var i=_.template($("#question_template").html()),n=0;n<this._user_questions.length;n++)this._user_questions[n].question_id=n,$(".guess_questions .question_scroller").append(i(this._user_questions[n]));this.question_scroll=new IScroll("#user_question_wrapper",{disableMouse:!1,probeType:1,scrollbars:!1,interactiveScrollbars:!1,fadeScrollbars:!1,mouseWheel:!0,click:!0,tap:!0,keyBindings:!0,deceleration:.001}),$("[data-question]").off("click").on("click",function(){console.log($(this).attr("data-question")),app.play_sound("small_hit"),e.play_question($(this).attr("data-question"),"user")}),$("#user_game_screen .button_question").off("click").on("click",function(t){app.play_sound("hit"),e.show_questions()}),$("#user_game_screen .button_propose").off("click").on("click",function(t){app.play_sound("hit"),e.propose("user")}),$("#user_game_screen .button_valid").off("click").on("click",function(t){app.play_sound("hit"),e.set_player("openent")}),e.set_player("user")},guess_game_page.prototype.set_player=function(e){var t=this;app.play_sound("switch_player"),"user"===e?($("#user_game_screen .button_propose, #user_game_screen .button_question").css("display","block"),$("#user_game_screen .button_valid").css("display","none"),$(".transition_screen .center_avatar").css("background-image","url("+encodeURI(app.pix_to_uri(this._user_datas.base64,"thumb"))+")"),$(".transition_screen .text_infos").html(app.text("YOUR_TURN")),TweenLite.set($(".transition_screen .text_infos"),{y:window.innerHeight+100}),TweenLite.to($(".transition_screen .text_infos"),1.2,{y:window.innerHeight/2+100,ease:Power4.easeOut}),TweenLite.set($(".transition_screen .center_avatar"),{x:window.innerWidth}),TweenLite.to($(".transition_screen .center_avatar"),1.2,{x:0,ease:Power4.easeOut,onComplete:function(){app.say(app.text("YOUR_TURN"),app.locale,1.6,function(){})}}),TweenLite.to($(".guess_game_container"),.5,{x:-window.innerWidth,ease:Power4.easeIn,onComplete:function(){$(".transition_screen").off("click").on("click",function(){app.play_sound("switch_player_end"),TweenLite.to($(".transition_screen .text_infos"),.6,{y:window.innerHeight+100,delay:.5,ease:Power4.easeIn}),TweenLite.to($(".transition_screen .center_avatar"),1.2,{x:-window.innerWidth,ease:Power4.easeIn}),TweenLite.to($(".guess_game_container"),.5,{x:0,delay:1,ease:Power4.easeInOut,onComplete:function(){$("#user_game_screen .eliminated").length>=14?TweenMax.to($("#user_game_screen .button_propose"),.5,{scaleX:1.2,scaleY:1.2,yoyo:!0,repeat:11}):TweenMax.to($("#user_game_screen .button_question"),.5,{scaleX:1.2,scaleY:1.2,yoyo:!0,repeat:11})}})})}})):($(".transition_screen .center_avatar").css("background-image","url(images/assets/nav/nav_buttons_rules_slide_02.svg)"),$(".transition_screen .text_infos").html(app.text("OPENENT_TURN")),TweenLite.set($(".transition_screen .text_infos"),{y:window.innerHeight+100}),TweenLite.to($(".transition_screen .text_infos"),1.2,{y:window.innerHeight/2+100,ease:Power4.easeOut}),TweenLite.set($(".transition_screen .center_avatar"),{x:-window.innerWidth}),TweenLite.to($(".transition_screen .center_avatar"),1.2,{x:0,ease:Power4.easeOut,onComplete:function(){app.say(app.text("OPENENT_TURN"),app.locale,1.6,function(){})}}),TweenLite.to($(".guess_game_container"),.5,{x:-window.innerWidth,ease:Power4.easeOut,onComplete:function(){$(".transition_screen").off("click").on("click",function(){app.play_sound("switch_player_end"),TweenLite.to($(".transition_screen .text_infos"),.6,{y:window.innerHeight+100,delay:.5,ease:Power4.easeIn}),TweenLite.to($(".transition_screen .center_avatar"),1.2,{x:window.innerWidth,ease:Power4.easeIn}),TweenLite.to($(".guess_game_container"),.5,{x:-(2*window.innerWidth),ease:Power4.easeInOut,delay:1,onComplete:function(){setTimeout(function(){t.openent_play()},500)}})})}}))},guess_game_page.prototype.openent_play=function(){var e=this;if($("#user_game_screen .eliminated").length>=14||$("#opponent_game_screen .eliminated").length>=14)return e.propose("openent"),!1;var t=Math.floor(Math.random()*e._openent_questions.length);this.play_question(t,"openent")},guess_game_page.prototype.propose_card_open=function(e,t,s){function o(){TweenLite.to($("#play_card .front"),1,{rotationY:360,delay:.5,ease:Back.easeIn}),TweenMax.to($("#play_card .back"),1,{rotationY:-180,delay:.5,ease:Back.easeIn,onStart:function(){$("#play_card .nav").css("display","none")},onComplete:function(){TweenMax.to($("#play_card_container"),.2,{scaleX:1.2,scaleY:1.2,yoyo:!0,repeat:1});r?($("#play_card .question_icon").css("display","none"),$("#play_card .true_icon").css("display","block"),$("#play_card .false_icon").css("display","none"),app.play_sound("card_win"),"user"===t?($("#play_card .front .label").html(app.text_template("PROPOSE_TRUE",{name:n.label})),app.say(app.text_template("PROPOSE_TRUE",{name:n.label}),app.locale,1.6,function(){TweenLite.to($("#play_card"),.5,{y:window.innerHeight,onComplete:function(){TweenLite.to($("#play_card_container"),.5,{opacity:0,onComplete:function(){$("#play_card_container").css("display","none"),s(r)}})}})})):($("#play_card .front .label").html(app.text_template("PROPOSE_OPENENT_TRUE",{name:n.label})),app.say(app.text_template("PROPOSE_OPENENT_TRUE",{name:n.label}),app.locale,1.6,function(){TweenLite.to($("#play_card"),.5,{y:window.innerHeight,onComplete:function(){TweenLite.to($("#play_card_container"),.5,{opacity:0,onComplete:function(){$("#play_card_container").css("display","none"),s(r)}})}})}))):(app.play_sound("card_fail"),$("#play_card .question_icon").css("display","none"),$("#play_card .true_icon").css("display","none"),$("#play_card .false_icon").css("display","block"),$("#play_card .front .label").html(app.text_template("PROPOSE_FALSE",{name:n.label})),app.say(app.text_template("PROPOSE_FALSE",{name:n.label}),app.locale,1.6,function(){TweenLite.to($("#play_card"),.5,{y:window.innerHeight,onComplete:function(){TweenLite.to($("#play_card_container"),.5,{opacity:0,onComplete:function(){$("#play_card_container").css("display","none"),s(r)}})}})}))}})}var i=this,n=_.where(i.infos.characters,{id:e})[0],a=app.text_template("PROPOSE_USER",{name:n.label}),r=!1;"user"===t?(e===i._openent_datas.id&&(r=!0),$("#play_card .nav").css("display","none"),$("#play_card #show_response").css("display","block")):(e===i._user_datas.id&&(r=!0),$("#play_card .nav").css("display","none"),$("#play_card #select_response").css("display","block")),$("#play_card .question_icon").css("display","block"),$("#play_card .true_icon").css("display","none"),$("#play_card .false_icon").css("display","none"),$("#play_card .front .icon").css("background-image","url("+encodeURI(app.pix_to_uri(n.base64,"thumb"))+")"),$("#play_card .front .label").html(a),$("#play_card_container").css("display","block"),TweenLite.set($("#play_card"),{y:window.innerHeight+200}),TweenLite.set($("#play_card .front"),{rotationY:-180}),TweenLite.set($("#play_card .back"),{rotationY:0}),TweenLite.to($("#play_card_container"),.5,{opacity:1,onComplete:function(){TweenLite.to($("#play_card"),.5,{y:window.innerHeight/2-$("#play_card").height()/2})}}),TweenLite.to($("#play_card .front"),.8,{rotationY:0,ease:Back.easeOut,delay:1.2}),app.play_sound("display_card"),TweenLite.to($("#play_card .back"),.8,{rotationY:180,ease:Back.easeOut,delay:1.2,onComplete:function(){app.say(a,app.locale,1.6,function(){}),"user"===t?$("#play_card").off("click").on("click",function(e){o()}):($("#play_card").off("click"),$("#its_true").off("click").on("click",function(e){r?o():(app.play_sound("fail"),TweenMax.to($("#play_card"),.1,{left:$("#play_card_container").position().left+20,rotation:4,yoyo:!0,repeat:5}),app.say(app.text("MISTAKE"),app.locale,1.6,function(){}))}),$("#its_false").off("click").on("click",function(e){r?(app.play_sound("fail"),TweenMax.to($("#play_card"),.1,{left:$("#play_card_container").position().left+20,rotation:4,yoyo:!0,repeat:5}),app.say(app.text("MISTAKE"),app.locale,1.6,function(){})):o()}))}})},guess_game_page.prototype.propose=function(e){var t=this;if("openent"===e){var s=$("#opponent_game_screen .card").not(document.getElementsByClassName("eliminated")).eq(0).attr("data-id");return t.propose_card_open(s,e,function(e){e===!0?app._router.navigate("page/guess_game_end/status/lose",{trigger:!0,replace:!1}):($('#opponent_game_screen [data-id="'+s+'"]').addClass("eliminated"),t.set_player("user"))}),!1}app.say(app.text("PROPOSE_CANDIDATE"),app.locale,1.6,function(){}),TweenMax.to($("li.card .front_card"),.3,{opacity:.4,yoyo:!0,repeat:5}),$(".title_infos").css("visibility","hidden"),$("#user_game_screen .button_propose, #user_game_screen .button_question").css("display","none"),$("#user_game_screen .button_valid").css("display","none"),$(".card").off("click").on("click",function(){if(!$(this).hasClass("eliminated")){app.play_sound("return_card"),$(".game_menu").css("visibility","visible"),$(".title_infos").css("visibility","visible");var s=$(this).attr("data-id"),i=$(this);t.propose_card_open(s,e,function(e){e===!0?app._router.navigate("page/guess_game_end/status/win",{trigger:!0,replace:!1}):($("#user_game_screen .button_propose, #user_game_screen .button_question").css("display","none"),$("#user_game_screen .button_valid").css("display","block"),$(".card").off("click"),0===i.find("cross_card").length&&(i.addClass("to_eliminate"),i.find(".front_card").append('<div class="cross_card"></div>')),setTimeout(function(){i.addClass("eliminated"),t.set_player("openent")},2e3),TweenMax.to($("#user_game_screen .button_valid"),.5,{scaleX:1.2,scaleY:1.2,yoyo:!0,repeat:11}))})}}),$("#global_close_button").css("display","block"),$("#global_close_button").off("click").on("click",function(e){_UI.displayTouch($(this)),$("#global_close_button").css("display","none"),$(".game_menu").css("visibility","visible"),$(".title_infos").css("visibility","visible"),$("#user_game_screen .button_propose, #user_game_screen .button_question").css("display","block"),$("#user_game_screen .button_valid").css("display","none")})},guess_game_page.prototype.play_question=function(e,t){var i,n,a,r,o,s=this;if(s.hide_questions(),$("#user_game_screen .button_propose, #user_game_screen .button_question").css("display","none"),$("#user_game_screen .button_valid").css("display","block"),"user"===t){s._user_questions[e].played=!0,n=s._user_questions[e].icon,i=s._user_questions[e].label,a=s._user_questions[e].check,r=s._user_questions[e].value,o=!1,this.get_condition(s._openent_datas.id,a,r,function(e){o=e.status});for(var h=0;h<$("#user_game_screen .card").length;h++){var A=$("#user_game_screen .card").eq(h).attr("data-id");$("#user_game_screen .card").eq(h).hasClass("eliminated")||this.get_condition(A,a,r,function(e){e.status!==!0||o?e.status===!1&&o&&($('#user_game_screen [data-id="'+e.id+'"]').addClass("to_eliminate"),$('#user_game_screen [data-id="'+e.id+'"]').off("touchstart").on("touchstart",function(e){app.play_sound("return_card"),$(this).addClass("eliminated")})):($('#user_game_screen [data-id="'+e.id+'"]').addClass("to_eliminate"),$('#user_game_screen [data-id="'+e.id+'"]').off("touchstart").on("touchstart",function(e){app.play_sound("return_card"),$(this).addClass("eliminated")}))})}$("#play_card .front .icon").css("background-image","url("+n+")"),$("#play_card .nav").css("display","none"),$("#play_card #show_response").css("display","block")}else{s._openent_questions[e].played=!0,n=s._openent_questions[e].icon,i=s._openent_questions[e].label,a=s._openent_questions[e].check,r=s._openent_questions[e].value,o=!1,this.get_condition(this._user_datas.id,a,r,function(e){o=e.status});for(var h=0;h<$("#opponent_game_screen .card").length;h++){var A=$("#user_game_screen .card").eq(h).attr("data-id");$("#opponent_game_screen .card").eq(h).hasClass("eliminated")||this.get_condition(A,a,r,function(e){e.status!==!0||o?e.status===!1&&o&&($('#opponent_game_screen [data-id="'+e.id+'"]').addClass("to_eliminate"),$('#opponent_game_screen [data-id="'+e.id+'"]').off("touchstart").on("touchstart",function(e){$(this).addClass("eliminated")})):($('#opponent_game_screen [data-id="'+e.id+'"]').addClass("to_eliminate"),$('#opponent_game_screen [data-id="'+e.id+'"]').off("click").on("click",function(e){$(this).addClass("eliminated")}))})}$("#play_card .front .icon").css("background-image","url("+encodeURI(app.pix_to_uri(s._user_datas.base64,"thumb"))+")"),$("#play_card .nav").css("display","none"),$("#play_card #select_response").css("display","block")}$("#play_card .question_icon").css("display","block"),$("#play_card .true_icon").css("display","none"),$("#play_card .false_icon").css("display","none"),$("#play_card .front .label").html(i),$("#play_card_container").css("display","block"),TweenLite.set($("#play_card"),{y:window.innerHeight+200}),TweenLite.set($("#play_card .front"),{rotationY:-180}),TweenLite.set($("#play_card .back"),{rotationY:0}),app.play_sound("display_card"),TweenLite.to($("#play_card_container"),.5,{opacity:1,onComplete:function(){TweenLite.to($("#play_card"),.5,{y:window.innerHeight/2-$("#play_card").height()/2})}}),TweenLite.to($("#play_card .front"),.8,{rotationY:0,ease:Back.easeOut,delay:1.2}),TweenLite.to($("#play_card .back"),.8,{rotationY:180,ease:Back.easeOut,delay:1.2,onComplete:function(){function n(){TweenMax.killAll(),TweenLite.to($("#play_card .front"),1,{rotationY:360,delay:.5,ease:Back.easeIn}),TweenLite.to($("#play_card .back"),1,{rotationY:-180,delay:.5,ease:Back.easeIn,onComplete:function(){TweenMax.to($("#play_card_container"),.2,{scaleX:1.2,scaleY:1.2,yoyo:!0,repeat:1}),$("#play_card .nav").css("display","none"),$("#play_card #continue_response").css("display","block"),o?($("#play_card .question_icon").css("display","none"),$("#play_card .true_icon").css("display","block"),$("#play_card .false_icon").css("display","none"),$("#play_card .front .label").html(s._user_questions[e].ok),app.play_sound("card_win"),"user"===t?app.say(s._user_questions[e].ok,app.locale,1.6,function(){}):app.say(s._openent_questions[e].ok,app.locale,1.6,function(){})):($("#play_card .question_icon").css("display","none"),$("#play_card .true_icon").css("display","none"),$("#play_card .false_icon").css("display","block"),$("#play_card .front .label").html(s._user_questions[e].nok),app.play_sound("card_fail"),"user"===t?app.say(s._user_questions[e].nok,app.locale,1.6,function(){}):app.say(s._openent_questions[e].nok,app.locale,1.6,function(){})),$("#play_card").off("click").on("click",function(e){app.play_sound("small_hit"),TweenMax.killAll(),s.close_play_card(t)})}})}console.log("have to say ",i),app.say(i,app.locale,1.6,function(){}),"user"===t?$("#play_card").off("click").on("click",function(e){app.play_sound("small_hit"),n()}):($("#play_card").off("click"),$("#its_true").off("click").on("click",function(){app.play_sound("small_hit"),o?n():(app.play_sound("fail"),TweenMax.to($("#play_card"),.1,{left:$("#play_card_container").position().left+20,rotation:4,yoyo:!0,repeat:5}),app.say(app.text("MISTAKE"),app.locale,1.6,function(){}))}),$("#its_false").off("click").on("click",function(){app.play_sound("small_hit"),o?(app.play_sound("fail"),TweenMax.to($("#play_card"),.1,{left:$("#play_card_container").position().left+20,rotation:4,yoyo:!0,repeat:5}),app.say(app.text("MISTAKE"),app.locale,1.6,function(){})):n()}))}})},guess_game_page.prototype.close_play_card=function(e){var t=this;app.play_sound("close_card"),TweenLite.to($("#play_card"),.5,{y:window.innerHeight+150,delay:.3,onComplete:function(){$.each($(".to_eliminate"),function(e,t){0===$(this).find(".cross_card").length&&$(this).find(".front_card").append('<div class="cross_card"></div>')}),TweenLite.to($("#play_card_container"),.5,{opacity:0,onComplete:function(){$("#play_card_container").css("display","none"),"openent"===e?($("#opponent_game_screen .to_eliminate").addClass("eliminated"),setTimeout(function(){t.set_player("user")},500)):TweenMax.to($("#user_game_screen .button_valid"),.5,{scaleX:1.2,scaleY:1.2,yoyo:!0,repeat:11})}})}})},guess_game_page.prototype.get_condition=function(e,t,s,i){var n=_.where(this.infos.characters,{id:e})[0],a=!1;switch(t){case"type":parseInt(n.type)===parseInt(s)&&(a=!0);break;case"skin_color":-1!==s.indexOf(n.parsed_datas.skin_color)&&(a=!0);break;case"glasses":">0"===s&&parseInt(n.parsed_datas.containers.faces_container.assets.glasses.status)>0?a=!0:"===0"===s&&0===parseInt(n.parsed_datas.containers.faces_container.assets.glasses.status)&&(a=!0);break;case"mustach":">0"===s&&parseInt(n.parsed_datas.containers.faces_container.assets.mustach.status)>0?a=!0:"===0"===s&&0===parseInt(n.parsed_datas.containers.faces_container.assets.mustach.status)&&(a=!0);break;case"hats":">0"===s&&parseInt(n.parsed_datas.containers.accessories_container.assets.hats.status)>0?a=!0:"===0"===s&&0===parseInt(n.parsed_datas.containers.accessories_container.assets.hats.status)&&(a=!0);break;case"hairs_color":-1!==s.indexOf(n.parsed_datas.hair_color)&&(a=!0);break;case"eyes":-1!==s.indexOf(n.parsed_datas.containers.faces_container.assets.eyes.status.toString())&&(a=!0);break;case"hairs":-1!==s.indexOf(n.parsed_datas.containers.hairs_container.assets.hairs.status.toString())&&(a=!0);break;case"tshirt":">0"===s&&parseInt(n.parsed_datas.containers.tops_container.assets.tshirt.status)>0?a=!0:"===0"===s&&0===parseInt(n.parsed_datas.containers.tops_container.assets.tshirt.status)&&(a=!0);break;case"mouth":-1!==s.indexOf(n.parsed_datas.containers.faces_container.assets.mouths.status.toString())&&(a=!0);break;case"barbe":">0"===s&&parseInt(n.parsed_datas.containers.barbes_container.assets.barbes.status)>0?a=!0:"===0"===s&&0===parseInt(n.parsed_datas.containers.barbes_container.assets.barbes.status)&&(a=!0)}i({status:a,id:e})},guess_game_page.prototype.show_questions=function(){var e=this;$("#global_close_button").css("display","block"),$("#global_close_button").off("click").on("click",function(t){_UI.displayTouch($(this)),e.hide_questions()}),TweenLite.to($(".guess_game_container"),.7,{y:-window.innerHeight,ease:Power4.easeOut}),TweenLite.to($(".guess_questions"),.7,{y:0,top:0,ease:Power4.easeOut})},guess_game_page.prototype.hide_questions=function(){$("#global_close_button").off("click").css("display","none"),TweenLite.to($(".guess_game_container"),.7,{y:0,ease:Power4.easeOut}),TweenLite.to($(".guess_questions"),.7,{y:window.innerHeight,ease:Power4.easeOut})},guess_game_page.prototype.play=function(){},guess_game_page.prototype.pause=function(){},guess_game_page.prototype.update=function(){},guess_game_page.prototype.refresh=function(e){},guess_game_page.prototype.destroy=function(e){$("#global_close_button").css("display","none");e()};