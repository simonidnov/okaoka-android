function user_gallery_page(){this._characters=[],this.swiper=null,this.scroll=null,this._datas=null,this._page=1,this.current_motion="hello",this.limit=15,this._page=1,this._is_last=!1}user_gallery_page.prototype.init=function(){this.display_list()},user_gallery_page.prototype.display_list=function(){var e=this;if(!auth_helper.is_logged())return!1;$("article").css("height",window.innerHeight+"px"),$("#scroll_scroller").css("height",$("article").length*window.innerHeight+"px"),$("#gallery_container").css({width:300*Math.floor(window.innerWidth/300)+"px"});var t=!1;"undefined"!=typeof app._page_request.id&&(t=!0),setTimeout(function(){characters_helper.get_user_characters(function(t){e._datas=t,e.create_grid()},t)},2500)},user_gallery_page.prototype.scroll_to=function(e){app.page_properties._page_script.scroll.scrollToElement(document.querySelector("#scroll_scroller article:nth-child("+e+")"),700,null,null,IScroll.utils.ease.quadratic)},user_gallery_page.prototype.create_grid=function(){for(var e=_.template($("#user_gallery_template").html()),t=0;t<this._datas.length;++t)this._datas[t].datas=JSON.parse(this._datas[t].datas),$("#user_gallery_container").append(e(this._datas[t])),TweenLite.set($("#character_"+this._datas[t].id),{scaleX:0,scaleY:0}),TweenLite.to($("#character_"+this._datas[t].id),.5,{scaleX:1,scaleY:1,delay:1+.1*t,ease:Back.easeOut});this.set_listeners();var s=this;this.scroll=new IScroll("#user_gallery_scroll_wrapper",{disableMouse:!1,probeType:1,scrollbars:!1,interactiveScrollbars:!1,fadeScrollbars:!1,mouseWheel:!0,click:!0,tap:!0,keyBindings:!0,deceleration:.001}),this.scroll.on("scrollEnd",function(){s.scroll.y!==s.scroll.maxScrollY||s._is_last||s.load_next_characters()}),"undefined"!=typeof app._page_request.id&&setTimeout(function(){s.open_character_details(app._page_request.id)},2500)},user_gallery_page.prototype.load_next_characters=function(){var e=this;characters_helper.get_characters_with_params({start:this.limit*this._page,limit:this.limit,user_id:auth_helper.user_infos.user.id},function(t){0===t.length&&(e._is_last=!0);for(var s=_.template($("#user_gallery_template").html()),i=0;i<t.length;i++)t[i].parsed_datas=JSON.parse(t[i].datas),t[i].datas=JSON.parse(t[i].datas),e._datas.push(t[i]),$("#user_gallery_container").append(s(t[i]));e.set_listeners(),e.scroll.refresh(),e.scroll.y=this.scroll.y-20,e._page++})},user_gallery_page.prototype.animate=function(e,t){var s=this,i=_.where(s._datas,{id:s.params.id})[0].datas.name+"_"+s.current_motion;stickers_helper.file_exist(i,function(e){e?t(cordova.file.dataDirectory+"pictures/"+i+".gif"):s._characters[0].motions[s.current_motion](s._characters[0],!0,function(e){t(cordova.file.dataDirectory+"pictures/"+i+".gif")})})},user_gallery_page.prototype.set_listeners=function(){var e=this;$(".avatar_list").off("click").on("click",function(){e.open_character_details($(this).attr("data-id"))})},user_gallery_page.prototype.open_character_details=function(e){var t=this,s=$('[data-id="'+e+'"]').eq(0),i=s.html(),n=s.position().left,a=s.position().top,r=s.width(),o=s.height(),A=s.attr("data-pix");t.params={x:n,y:a,h:o,w:r,target:s,pix:A,id:s.attr("data-id")},s.css("visibility","hidden"),t.scroll.disable(),$(".user_gallery").prepend('<div class="avatar_list show_template" data-id="'+s.attr("data-id")+'" data-pix="'+s.attr("data-pix")+'" style="top:'+a+"px; left:"+n+"px; width:"+r+"px; height:"+o+'px">'+i+"</div>"),TweenLite.to($(".show_template"),.5,{top:0,left:0,width:"100%",height:"100%",margin:"0px",padding:"0px",ease:Power4.easeIn}),TweenLite.to($(".show_template .user_gallery_avatar"),.5,{top:0,left:0,width:"100%",height:"50%",ease:Power4.easeIn}),TweenLite.to($(".show_template .avatar_ground"),.5,{top:0,left:0,width:"100%",height:"100%","border-radius":"0",ease:Power4.easeIn}),app.play_sound("display_card"),TweenLite.to($(".show_template .avatar_pix"),.5,{top:0,left:0,width:"100%",height:"100%","border-radius":"0px","border-bottom-left-radius":"0px","border-bottom-right-radius":"0px","background-position":"50% 0px","background-size":"contain",ease:Power4.easeOut,onComplete:function(){TweenLite.to($(".show_template .avatar_pix"),.5,{"background-position-y":$(".show_template .avatar_pix").height()+"px",delay:.4,ease:Power4.easeIn,onComplete:function(){$(".show_template .avatar_pix").append('<canvas id="show_preview_canvas" width="'+$(".show_template .avatar_pix").width()+'" height="'+$(".show_template .avatar_pix").height()+'"></canvas>'),t._characters[0]=new character({touch_enabled:!1,canvas:"show_preview_canvas",width:$("#show_preview_canvas").width(),height:$("#show_preview_canvas").height(),datas:_.where(t._datas,{id:t.params.id})[0].datas}),t._characters[0].init()}}),$(".show_template").append('<div class="small_avatar"><div class="circle_ground" style="background-color:'+$(".show_template .avatar_ground").css("background-color")+';"></div><div class="small_avatar_pix" style="background-image:url(./images/assets/nav/nav_buttons_share_white.svg);"></div></div>'),$(".small_avatar").off("click").on("click",function(){app.share({files:[A]})}),$(".small_avatar").css("top",window.innerHeight/2-75+"px"),TweenLite.to($(".show_template .small_avatar"),.5,{right:"10px",ease:Back.easeOut,delay:.4}),$(".show_template").append('<div class="close_button"><img src="images/assets/nav/nav_buttons_close_button_white.svg"/></div>');var e=_.template($("#motions_tab_template").html());$(".show_template").append(e({}));var e=_.template($("#options_tab_template").html());$(".show_template").append(e({}));var s=window.innerHeight/2-$(".show_template .label").height();$(".show_tab").css({height:s+"px",width:"100%"}),$(".tab.forty").css({height:"50%"}),setTimeout(function(){for(var e=0;e<$("object").length;e++){var s=$("object")[e].contentDocument,i=s.createElementNS("http://www.w3.org/2000/svg","style");i.textContent=".cls-1, g, circle, rect, path { fill: "+$(".show_template .avatar_ground").css("background-color")+"; pointer-events:none; } svg { pointer-events:none; } * { pointer-events:none; }";var n=s.getElementsByTagName("svg");"undefined"!=typeof n[0]&&n[0].appendChild(i)}$("[data-motion] .hitzone").off("click").on("click",function(){_UI.displayTouch($(this).parent()),t.current_motion=$(this).parent().attr("data-motion"),t._characters[0].motions[$(this).parent().attr("data-motion")](t._characters[0],!1)}),$("#edit_button .hitzone").off("click").on("click",function(){_UI.displayTouch($(this).parent())}),$("#share_button .hitzone").off("click").on("click",function(){t._characters[0].motions[$(this).parent().attr("data-motion")](t._characters[0],!1,function(){}),_UI.displayTouch($(this).parent());var e={message:"Retrouvez mon personnage "+$(".show_template .label").html()+" sur idkids-emoji",subject:"Créez votre avatar !",files:[t.params.pix],url:"http://idkids.landscape-viewer.com/#page/character/id/"+t.params.id,chooserTitle:"Mon Nouvel Avatar"},s=function(e){console.log("Share completed? "+e.completed),console.log("Shared to app: "+e.app)},i=function(e){console.log("Sharing failed with message: "+e)};window.plugins.socialsharing.shareWithOptions(e,s,i)}),$("#shop_button .hitzone").off("click").on("click",function(){_UI.displayTouch($(this).parent()),app._router.navigate("page/product/id/"+t.params.id,{trigger:!0,replace:!1})}),TweenLite.to($(".show_template .show_tab"),.5,{"margin-top":"0%",delay:.8,ease:Power4.easeOut})},1200),$(".show_template .tab .label").css("color",$(".show_template .avatar_ground").css("background-color")),$(".show_template .close_button, .show_template .close_button img").off("click").on("click",function(){TweenLite.to($(".show_template .small_avatar"),.5,{scaleY:0,scaleX:0,ease:Back.easeIn,onComplete:function(){$(".show_template .small_avatar").remove()}}),TweenLite.to($(".show_template .close_button"),.5,{scaleY:0,scaleX:0,ease:Back.easeOut,onComplete:function(){$(".show_template .close_button").remove()}}),TweenLite.to($(".show_template .show_tab"),.5,{opacity:0,onComplete:function(){$(".show_template .show_tab").remove(),app.play_sound("display_card")}}),TweenLite.to($(".show_template"),.8,{top:t.params.y,left:t.params.x,width:t.params.w+"px",height:t.params.h+"px",margin:"5px",padding:"0px","background-color":"rgba(255,255,255,0)",ease:Power4.easeInOut,delay:.5}),TweenLite.to($(".show_template .user_gallery_avatar"),.8,{top:0,left:0,width:"150px",height:"150px",ease:Power4.easeInOut,delay:.5}),TweenLite.to($(".show_template .avatar_ground"),.8,{top:"50px",left:0,width:"100px",height:"100px","border-radius":"100%",ease:Power4.easeInOut,delay:.5}),TweenLite.to($(".show_template .avatar_pix"),.8,{top:0,left:0,width:"100px",height:"100%","background-position":"50% 0px","border-bottom-left-radius":"75px","border-bottom-right-radius":"75px",delay:.5,ease:Power4.easeInOut,onComplete:function(){$(".show_template").remove(),console.log(t.params.target),console.log(t.params),t.params.target.css("visibility","visible"),t.scroll.enable()}}),TweenLite.to(t._characters[0].container,.5,{scaleY:0,scaleX:0,ease:Power4.easeIn,onComplete:function(){$(".show_template .avatar_pix #show_preview_canvas").remove(),t._characters[0].destroy(function(e){})}})})}})},user_gallery_page.prototype.load_character=function(e){setTimeout(function(){app._router.navigate("page/character/id/"+e,{trigger:!0,replace:!1})},30)},user_gallery_page.prototype.download_character=function(e){var t=new PopUp;t.open_popup({illus:{color:"white",picture:$('[data-id="'+e+'"]').attr("data-pix")},title:"Télécharger : "+$('[data-id="'+e+'"]').find(".label").html(),message:"Quel format souhaitez-vous télécharger ?",buttons:[{label:"SVG"},{label:"PNG"},{label:"Annuler"}]},function(s,i){0===parseInt(s)?window.open($('[data-id="'+e+'"]').attr("data-pix").replace(".png",".svg").replace("_thumb",""),"_blank"):1===parseInt(s)&&window.open($('[data-id="'+e+'"]').attr("data-pix").replace("_thumb",""),"_blank"),delete t})},user_gallery_page.prototype.add_grid=function(){for(var e=_.template($("#gallery_template").html()),t=0;t<this._datas.length;++t)$("#gallery_container").append(e(this._datas[t]));this.set_listeners(),this.scroll.refresh(),this.scroll.y=this.scroll.y-20},user_gallery_page.prototype.load_next_page=function(){var e=this;ajax_request.get("/nse/usercharacters",{start:this.limit*this._page,limit:this.limit,"no-datas":!1,user_id:auth_helper.user_infos.user.id},function(t){e._datas=t.result,e.add_grid(),e._page+=1},function(e){alert("erreur lors de la recherche")})},user_gallery_page.prototype.set_canvas=function(e,t){this._characters[e]=new character({touch_enabled:!1,canvas:"canvas_"+e,width:250,height:300,datas:t}),this._characters[e].init()},user_gallery_page.prototype.play=function(){},user_gallery_page.prototype.pause=function(){},user_gallery_page.prototype.update=function(){},user_gallery_page.prototype.refresh=function(e){},user_gallery_page.prototype.destroy=function(e){for(var t=this,s=0;s<this._characters.length;s++)this._characters[s].destroy(function(){s===t._characters.length-1&&(t._characters=[],e())})};