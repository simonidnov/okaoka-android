function PopUp(){this.init(),this._callBack=null,this._diaporama=null,this._id=0,this._container=null,this._close=null,this._datas=null}PopUp.prototype.init=function(){0===$(".ui_template").length&&$("body").append('<div class="ui_template" id="ui_templates"></div>'),0===$("#popup_template").length&&$("#ui_templates").load("js/popup/popup_templates.html",function(){})},PopUp.prototype.open_popup=function(e,t){if(this._id=$("[id^=popup_content]").length,"undefined"==typeof e||"undefined"==typeof t)return!1;this._callBack=t,this._datas=e;var s=this;if(0===$("#popup_template").length)return setTimeout(function(){s.open_popup(e,t)},500),!1;var i=_.template($("#popup_template").html());0===$("#popup_content_"+this._id).length&&$("body").append('<div class="popup_content" id="popup_content_'+this._id+'"></div>'),s._container=$("#popup_content_"+this._id),s._container.append(i(e)),TweenLite.set(s._container,{opacity:0}),TweenLite.to(s._container,.5,{opacity:1,onComplete:function(){TweenLite.set(s._container.find(".popup"),{css:{top:"50%"},opacity:0}),TweenLite.to(s._container.find(".popup"),.5,{css:{top:0,bottom:0},opacity:1,ease:Back.easeOut})}}),$.each(s._container.find(".popup .popup_button"),function(e,t){$(this).on("click",function(e){_UI.displayTouch($(this)),s.close_popup($(this).attr("data-button"))})}),0!==s._container.find(".popup_cross_close_button").length&&s._container.find(".popup_cross_close_button").on("click",function(){s.close_popup(1e3)}),"undefined"!=typeof e.picker&&s._container.find(".picker").on("click",function(){s._container.find(".picker").removeClass("selected"),$(this).addClass("selected")}),s._container.find(".message_scroller").height()>window.innerHeight/2&&(s._container.find(".message_scroller").css("position","absolute"),s._container.find("#popup_message_wrapper").css({height:window.innerHeight/2,overflow:"hidden",display:"block",position:"relative"}),this._popup_scroll=new IScroll("#popup_message_wrapper",{probeType:1,scrollbars:!1,interactiveScrollbars:!1,fadeScrollbars:!0,mouseWheel:!1,click:!0,tap:!0,keyBindings:!0,deceleration:.002})),"undefined"!=typeof e.diaporama&&(this._diaporama=new swipify(s._container.find(".popup_diaporama_slider"),".popup_diapo",function(e,t){},!1,!0,!1,{}),this._diaporama.init()),"undefined"!=typeof e.form&&e.form.length>0&&(s._form=new formular("popup_form",function(e){})),"undefined"!=typeof e.motion&&window.innerWidth<=380&&s._container.find(".illus.motion iframe").length>0&&s._container.find(".illus.motion iframe").css("left",$(".illus.motion").width()/2-160+"px")},PopUp.prototype.close_popup=function(e){var t=this,s=null;if(1===t._container.find("#popup_form").length&&(s=t._form.get_form_datas()),"undefined"!=typeof this._datas.picker){if(0===t._container.find(".picker.selected").length)return!1;null===s?s={picker:t._container.find(".picker.selected").attr("data-id")}:s.picker=t._container.find(".picker.selected").attr("data-id")}null!==t._diaporama&&t._diaporama.destroy(),TweenLite.to(t._container.find(".popup"),.5,{css:{top:"50%"},opacity:0,ease:Back.easeIn,onComplete:function(){t._container.find(".popup").remove(),TweenLite.to(t._container,.3,{opacity:0,onComplete:function(){t._callBack(e,s),t._container.remove()}})}})};