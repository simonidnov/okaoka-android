var ajax_request={_ajax:null,_base_url:"http://www.landscape-viewer.com/api/",_format:"json",_callBack:null,_loader:null,_device:null,_user:null,_family:null,_fail:null,_network_state:null,init:function(){this._loader=new css_loader($("body")),document.addEventListener("offline",this.offline,!1),document.addEventListener("online",this.online,!1)},offline:function(){toast.open(app.text_template("INTERNET_IS_LOST",{state:navigator.connection.type})),console.log("you are offline")},online:function(){toast.open(app.text_template("INTERNET_IS_CONNECTED",{state:navigator.connection.type})),console.log("you are online")},get:function(e,t,s,i){this.call(e,"GET",t,s,i)},put:function(e,t,s,i){this.call(e,"PUT",t,s,i)},post:function(e,t,s,i){this.call(e,"POST",t,s,i)},"delete":function(e,t,s,i){this.call(e,"delete",t,s,i)},call:function(e,t,s,i,n){if(!ajax_request.checkNetworkState())return!1;var a=this;this._loader.show(),this._callBack=i,this._fail=n;var r="";-1===e.indexOf("http://")&&(r=this._base_url),s=this.addParams(s),setTimeout(function(){$.ajax({url:r+e,crossDomain:!0,contentType:"application/x-www-form-urlencoded",async:!0,type:t,data:s,dataType:this._format,timeout:2e4}).done(a.success).fail(a.fail).always(a.always)},800)},checkNetworkState:function(){if("undefined"==typeof navigator.connection)return!0;var e=navigator.connection.type;if(e==Connection.NONE){var t=new PopUp;return t.open_popup({title:app.text("NO_NETWORK_TITLE"),message:app.text("NO_NETWORK_MESSAGE"),buttons:[{label:"ok"}]},function(e,s){delete t}),!1}return!0},addParams:function(e){return"undefined"==typeof device?(e.cordova="0.0.1",e.manufacturer="Simon",e.app_component=auth_helper.app_component,e.model="Simon",e.platform="Simon",e.uuid="Simon",e.version="0.0.1",e.locale="fr_fr"):(e.cordova=device.cordova,e.manufacturer=device.manufacturer,e.model=device.model,e.app_version=auth_helper.app_version,e.app_component=auth_helper.app_component,e.platform=device.platform,e.uuid=device.uuid,e.version=device.version,navigator.globalization.getPreferredLanguage(function(t){e.locale=device.language},function(){e.locale="undefined"})),e.user_infos=auth_helper.user_infos,e},always:function(e){"undefined"!=typeof e.responseJSON&&"undefined"!=typeof e.responseJSON.redirection,"undefined"!=typeof ajax_request._loader&&ajax_request._loader.hide()},success:function(e){if("undefined"!=typeof e.redirection,"undefined"!=typeof e.action)switch(e.action){case"autologin":"undefined"!=typeof e.user_infos&&"undefined"!=typeof e.password&&auth_helper.set_user()}if("undefined"!=typeof e.title&&"undefined"!=typeof e.message){var t=new PopUp;t.open_popup({title:e.title,message:e.message,buttons:[{label:"ok"}]},function(e,s){delete t})}ajax_request._callBack(e)},fail:function(e){if("undefined"!=typeof ajax_request._loader&&ajax_request._loader.hide(),"timeout"===e.statusText){var t=new PopUp;t.open_popup({title:app.text("WS_TIMEOUT_TITLE"),message:app.text("WS_TIMEOUT_MESSAGE"),buttons:[{label:app.text("WS_TIMEOUT_BUTTON")}]},function(e,s){delete t})}else try{if("undefined"!=typeof e.responseText){var s=JSON.parse(e.responseText);if(403===e.status){if("undefined"!=typeof s.title&&"undefined"!=typeof s.message){var t=new PopUp;t.open_popup({title:s.title,message:s.message,buttons:[{label:app.text("WS_STANDARD_ERROR_BUTTON")}]},function(e,s){delete t})}}else if("undefined"!=typeof s.title&&"undefined"!=typeof s.message){var t=new PopUp;t.open_popup({title:s.title,message:s.message,buttons:[{label:app.text("WS_STANDARD_ERROR_BUTTON")}]},function(e,s){delete t})}}else{var t=new PopUp;t.open_popup({title:app.text("WS_STANDARD_ERROR_TITLE"),message:app.text("WS_STANDARD_ERROR_MESSAGE"),buttons:[{color:colorer.pink,label:app.text("WS_STANDARD_ERROR_BUTTON")}]},function(e,s){delete t})}"undefined"!=typeof e.redirection&&navigation.router.navigate(i.redirection,{trigger:!0,replace:!0})}catch(i){ajax_request._fail(e)}},get_user_infos:function(){var e=null,t=null;if(""===window.localStorage.getItem("user_infos")||null===window.localStorage.getItem("user_infos"))return!1;if(e=JSON.parse(window.localStorage.getItem("user_infos")),""===window.localStorage.getItem("device_infos")||null===window.localStorage.getItem("device_infos"))return!1;t=JSON.parse(window.localStorage.getItem("device_infos"));var s={user_id:"",api_token:"",secret_key:"",device_id:""};return"undefined"==typeof e.id?!1:(s.user_id=e.id,"undefined"==typeof t.api_token?!1:(s.api_token=t.api_token,"undefined"==typeof t.secret_key?!1:(s.secret_key=t.secret_key,"undefined"==typeof t.id?!1:(s.device_id=t.id,s))))}},toast={init:function(){0===$("#app_toast").length&&($("body").append('<div id="app_toast"></div>'),$("#app_toast").on("click",function(){toast.close()}))},open:function(e){this.init(),$("#app_toast").html(e),$("#app_toast").addClass("opened"),setTimeout(function(){toast.close()},4500)},close:function(){$("#app_toast").removeClass("opened")}};