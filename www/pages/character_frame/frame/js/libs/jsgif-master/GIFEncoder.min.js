GIFEncoder=function(){function s(){this.bin=[]}for(var e=0,t={};256>e;e++)t[e]=String.fromCharCode(e);s.prototype.getData=function(){for(var e="",s=this.bin.length,i=0;s>i;i++)e+=t[this.bin[i]];return e},s.prototype.writeByte=function(e){this.bin.push(e)},s.prototype.writeUTFBytes=function(e){for(var t=e.length,s=0;t>s;s++)this.writeByte(e.charCodeAt(s))},s.prototype.writeBytes=function(e,t,s){for(var i=s||e.length,n=t||0;i>n;n++)this.writeByte(e[n])};var n,a,o,l,c,u,p,f,d,i={},r=null,h=-1,A=0,g=!1,_=[],m=7,Q=-1,v=!1,y=!0,w=!1,B=10,b="Generated by jsgif (https://github.com/antimatter15/jsgif/)",D=(i.setDelay=function(e){A=Math.round(e/10)},i.setDispose=function(e){e>=0&&(Q=e)},i.setRepeat=function(e){e>=0&&(h=e)},i.setTransparent=function(e){r=e},i.setComment=function(e){b=e},i.addFrame=function(e,t){if(null===e||!g||null===l)throw new Error("Please call start method before calling addFrame");var s=!0;try{t?c=e:(c=e.getImageData(0,0,e.canvas.width,e.canvas.height).data,w||j(e.canvas.width,e.canvas.height)),N(),O(),y&&(Y(),U(),h>=0&&q()),M(),""!==b&&G(),X(),y||U(),W(),y=!1}catch(i){s=!1}return s},i.finish=function(){if(!g)return!1;var e=!0;g=!1;try{l.writeByte(59)}catch(t){e=!1}return e},function(){o=0,c=null,u=null,p=null,d=null,v=!1,y=!0}),j=(i.setFrameRate=function(e){15!=e&&(A=Math.round(100/e))},i.setQuality=function(e){1>e&&(e=1),B=e},i.setSize=function(e,t){(!g||y)&&(n=e,a=t,1>n&&(n=320),1>a&&(a=240),w=!0)}),O=(i.start=function(){D();var e=!0;v=!1,l=new s;try{l.writeUTFBytes("GIF89a")}catch(t){e=!1}return g=e},i.cont=function(){D();var e=!0;return v=!1,l=new s,g=e},function(){var e=u.length,t=e/3;p=[];var s=new NeuQuant(u,e,B);d=s.process();for(var i=0,n=0;t>n;n++){var a=s.map(255&u[i++],255&u[i++],255&u[i++]);_[a]=!0,p[n]=a}u=null,f=8,m=7,null!==r&&(o=H(r))}),H=function(e){if(null===d)return-1;for(var t=(16711680&e)>>16,s=(65280&e)>>8,i=255&e,n=0,a=16777216,r=d.length,o=0;r>o;){var h=t-(255&d[o++]),A=s-(255&d[o++]),g=i-(255&d[o]),l=h*h+A*A+g*g,c=o/3;_[c]&&a>l&&(a=l,n=c),o++}return n},N=function(){var e=n,t=a;u=[];for(var s=c,i=0,r=0;t>r;r++)for(var o=0;e>o;o++){var h=r*e*4+4*o;u[i++]=s[h],u[i++]=s[h+1],u[i++]=s[h+2]}},M=function(){l.writeByte(33),l.writeByte(249),l.writeByte(4);var e,t;null===r?(e=0,t=0):(e=1,t=2),Q>=0&&(t=7&Q),t<<=2,l.writeByte(0|t|0|e),J(A),l.writeByte(o),l.writeByte(0)},G=function(){l.writeByte(33),l.writeByte(254),l.writeByte(b.length),l.writeUTFBytes(b),l.writeByte(0)},X=function(){l.writeByte(44),J(0),J(0),J(n),J(a),y?l.writeByte(0):l.writeByte(128|m)},Y=function(){J(n),J(a),l.writeByte(240|m),l.writeByte(0),l.writeByte(0)},q=function(){l.writeByte(33),l.writeByte(255),l.writeByte(11),l.writeUTFBytes("NETSCAPE2.0"),l.writeByte(3),l.writeByte(1),J(h),l.writeByte(0)},U=function(){l.writeBytes(d);for(var e=768-d.length,t=0;e>t;t++)l.writeByte(0)},J=function(e){l.writeByte(255&e),l.writeByte(e>>8&255)},W=function(){var e=new LZWEncoder(n,a,p,f);e.encode(l)};i.stream=function(){return l},i.setProperties=function(e,t){g=e,y=t};return i};