Class.create("Bitmap",{width:0,height:0,pixels:null,palette:null,drawCount:0,optPixels:null,__construct:function(e){this.width=e.width,this.height=e.height,this.palette=new Palette(e.colors,e.cycles),this.pixels=e.pixels},optimize:function(){for(var e=[],t=0;256>t;t++)e[t]=0;for(var s=this.palette.cycles,t=0,i=s.length;i>t;t++){var n=s[t];if(n.rate)for(idy=n.low;idy<=n.high;idy++)e[idy]=1}var A,g,a=this.optPixels=[],r=this.pixels,o=0,h=0,l=this.width,c=this.height;for(g=0;c>g;g++)for(A=0;l>A;A++)e[r[o]]&&(a[h++]=o),o++},render:function(e,t){var s=this.palette.getRawTransformedColors(),i=e.data,n=this.pixels;if(t&&this.drawCount&&this.optPixels)for(var r,o,h,a=this.optPixels,A=0,g=a.length;g>A;A++)o=a[A],h=s[n[o]],r=4*o,i[r+0]=h[0],i[r+1]=h[1],i[r+2]=h[2],i[r+3]=255;else{var l,c,h,r=0,o=0,u=this.width,p=this.height;for(c=0;p>c;c++)for(l=0;u>l;l++)h=s[n[o]],i[r+0]=h[0],i[r+1]=h[1],i[r+2]=h[2],i[r+3]=255,r+=4,o++}this.drawCount++}});