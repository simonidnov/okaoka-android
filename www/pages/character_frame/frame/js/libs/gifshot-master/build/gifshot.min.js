!function(e,t,s,i){var n,a,r,o,h,A,g,l,c,u,p,f,d,_,m,Q,v,y,w,B,b,I;n=function(){var i={URL:e.URL||e.webkitURL||e.mozURL||e.msURL,getUserMedia:function(){var e=s.getUserMedia||s.webkitGetUserMedia||s.mozGetUserMedia||s.msGetUserMedia;return e?e.bind(s):e}(),requestAnimFrame:e.requestAnimationFrame||e.webkitRequestAnimationFrame||e.mozRequestAnimationFrame||e.oRequestAnimationFrame||e.msRequestAnimationFrame,requestTimeout:function(e,t){function r(){var i=(new Date).getTime(),o=i-s;o>=t?e.call():n.value=a(r)}if(e=e||i.noop,t=t||0,!i.requestAnimFrame)return setTimeout(e,t);var s=(new Date).getTime(),n=new Object,a=i.requestAnimFrame;return n.value=a(r),n},Blob:e.Blob||e.BlobBuilder||e.WebKitBlobBuilder||e.MozBlobBuilder||e.MSBlobBuilder,btoa:function(){var t=e.btoa||function(e){for(var a,r,o,h,A,g,l,t="",s=0,i=e.length,n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";i>s;)a=e.charCodeAt(s++),r=e.charCodeAt(s++),o=e.charCodeAt(s++),h=a>>2,A=(3&a)<<4|r>>4,g=(15&r)<<2|o>>6,l=63&o,isNaN(r)?g=l=64:isNaN(o)&&(l=64),t=t+n.charAt(h)+n.charAt(A)+n.charAt(g)+n.charAt(l);return t};return t?t.bind(e):function(){}}(),isObject:function(e){return e&&"[object Object]"===Object.prototype.toString.call(e)},isEmptyObject:function(e){return i.isObject(e)&&!Object.keys(e).length},isArray:function(e){return e&&Array.isArray(e)},isFunction:function(e){return e&&"function"==typeof e},isElement:function(e){return e&&1===e.nodeType},isString:function(e){return"string"==typeof e||"[object String]"===Object.prototype.toString.call(e)},isSupported:{canvas:function(){var e=t.createElement("canvas");return e&&e.getContext&&e.getContext("2d")},webworkers:function(){return e.Worker},blob:function(){return i.Blob},Uint8Array:function(){return e.Uint8Array},Uint32Array:function(){return e.Uint32Array},videoCodecs:function(){var e=t.createElement("video"),s={mp4:!1,h264:!1,ogv:!1,ogg:!1,webm:!1};try{e&&e.canPlayType&&(s.mp4=""!==e.canPlayType('video/mp4; codecs="mp4v.20.8"'),s.h264=""!==(e.canPlayType('video/mp4; codecs="avc1.42E01E"')||e.canPlayType('video/mp4; codecs="avc1.42E01E, mp4a.40.2"')),s.ogv=""!==e.canPlayType('video/ogg; codecs="theora"'),s.ogg=""!==e.canPlayType('video/ogg; codecs="theora"'),s.webm=-1!==e.canPlayType('video/webm; codecs="vp8, vorbis"'))}catch(i){}return s}()},noop:function(){},each:function(e,t){var s,n;if(i.isArray(e))for(s=-1,n=e.length;++s<n&&t(s,e[s])!==!1;);else if(i.isObject(e))for(s in e)if(e.hasOwnProperty(s)&&t(s,e[s])===!1)break},mergeOptions:function n(e,t){if(i.isObject(e)&&i.isObject(t)&&Object.keys){var s={};return i.each(e,function(t,i){s[t]=e[t]}),i.each(t,function(a,r){var o=t[a];i.isObject(o)&&e[a]?s[a]=n(e[a],o):s[a]=o}),s}},setCSSAttr:function(e,t,s){i.isElement(e)&&(i.isString(t)&&i.isString(s)?e.style[t]=s:i.isObject(t)&&i.each(t,function(t,s){e.style[t]=s}))},removeElement:function(e){i.isElement(e)&&e.parentNode&&e.parentNode.removeChild(e)},createWebWorker:function(e){if(!i.isString(e))return{};try{var t=new i.Blob([e],{type:"text/javascript"}),s=i.URL.createObjectURL(t),n=new Worker(s);return{objectUrl:s,worker:n}}catch(a){return""+a}},getExtension:function(e){return e.substr(e.lastIndexOf(".")+1,e.length)},getFontSize:function(e){if(e=e||{},!t.body||e.resizeFont===!1)return e.fontSize;var s=e.text,i=e.gifWidth,n=parseInt(e.fontSize,10),a=parseInt(e.minFontSize,10),r=t.createElement("div"),o=t.createElement("span");for(r.setAttribute("width",i),r.appendChild(o),o.innerHTML=s,o.style.fontSize=n+"px",o.style.textIndent="-9999px",o.style.visibility="hidden",t.body.appendChild(o);o.offsetWidth>i&&n>=a;)o.style.fontSize=--n+"px";return t.body.removeChild(o),n+"px"},webWorkerError:!1};return i}(),a=function(e){var t={validate:function(s){s=e.isObject(s)?s:{};var i={};return e.each(t.validators,function(e,t){var n=t.errorCode;return s[n]||t.condition?void 0:(i=t,i.error=!0,!1)}),delete i.condition,i},isValid:function(e){var s=t.validate(e),i=s.error!==!0?!0:!1;return i},validators:[{condition:e.isFunction(e.getUserMedia),errorCode:"getUserMedia",errorMsg:"The getUserMedia API is not supported in your browser"},{condition:e.isSupported.canvas(),errorCode:"canvas",errorMsg:"Canvas elements are not supported in your browser"},{condition:e.isSupported.webworkers(),errorCode:"webworkers",errorMsg:"The Web Workers API is not supported in your browser"},{condition:e.isFunction(e.URL),errorCode:"window.URL",errorMsg:"The window.URL API is not supported in your browser"},{condition:e.isSupported.blob(),errorCode:"window.Blob",errorMsg:"The window.Blob File API is not supported in your browser"},{condition:e.isSupported.Uint8Array(),errorCode:"window.Uint8Array",errorMsg:"The window.Uint8Array function constructor is not supported in your browser"},{condition:e.isSupported.Uint32Array(),errorCode:"window.Uint32Array",errorMsg:"The window.Uint32Array function constructor is not supported in your browser"}],messages:{videoCodecs:{errorCode:"videocodec",errorMsg:"The video codec you are trying to use is not supported in your browser"}}};return t}(n),r={sampleInterval:10,numWorkers:2,gifWidth:200,gifHeight:200,interval:.1,numFrames:10,keepCameraOn:!1,images:[],video:null,webcamVideoElement:null,cameraStream:null,text:"",fontWeight:"normal",fontSize:"16px",minFontSize:"10px",resizeFont:!1,fontFamily:"sans-serif",fontColor:"#ffffff",textAlign:"center",textBaseline:"bottom",textXCoordinate:null,textYCoordinate:null,progressCallback:function(e){},completeCallback:function(){},saveRenderingContexts:!1,savedRenderingContexts:[],crossOrigin:"Anonymous"},o=function(){return a.isValid()},h=function(){return a.isValid()},A=function(){var e={getUserMedia:!0};return a.isValid(e)},g=function(e){var s=!1;if(n.isArray(e)&&e.length){if(n.each(e,function(e,t){n.isSupported.videoCodecs[t]&&(s=!0)}),!s)return!1}else if(n.isString(e)&&e.length&&!n.isSupported.videoCodecs[e])return!1;return a.isValid({getUserMedia:!0})},l=function(){function e(){function P(t,s,i){var n,a;for(C=t,x=s,S=i,F=new Array(e),n=0;e>n;n++)F[n]=new Array(4),a=F[n],a[0]=a[1]=a[2]=(n<<o+8)/e|0,L[n]=g/e|0,k[n]=0}function R(){for(var t=[],s=new Array(e),i=0;e>i;i++)s[F[i][3]]=i;for(var n=0,a=0;e>a;a++){var r=s[a];t[n++]=F[r][0],t[n++]=F[r][1],t[n++]=F[r][2]}return t}function O(){var t,s,i,n,a,o,h,A;for(h=0,A=0,t=0;e>t;t++){for(a=F[t],i=t,n=a[1],s=t+1;e>s;s++)o=F[s],o[1]<n&&(i=s,n=o[1]);if(o=F[i],t!=i&&(s=o[0],o[0]=a[0],a[0]=s,s=o[1],o[1]=a[1],a[1]=s,s=o[2],o[2]=a[2],a[2]=s,s=o[3],o[3]=a[3],a[3]=s),n!=h){for(D[h]=A+t>>1,s=h+1;n>s;s++)D[s]=t;h=n,A=t}}for(D[h]=A+r>>1,s=h+1;256>s;s++)D[s]=r}function H(){var e,r,A,g,l,c,u,p,f,d,m,y,b,E;for(a>x&&(S=1),B=30+(S-1)/3,y=C,b=0,E=x,m=x/(3*S),d=m/h|0,p=w,c=Q,u=c>>_,1>=u&&(u=0),e=0;u>e;e++)j[e]=p*((u*u-e*e)*I/(u*u));for(f=a>x?3:x%t!==0?3*t:x%s!==0?3*s:x%i!==0?3*i:3*n,e=0;m>e;)if(A=(255&y[b+0])<<o,g=(255&y[b+1])<<o,l=(255&y[b+2])<<o,r=q(A,g,l),Y(p,r,A,g,l),0!==u&&X(u,r,A,g,l),b+=f,b>=E&&(b-=x),e++,0===d&&(d=1),e%d===0)for(p-=p/B,c-=c/v,u=c>>_,1>=u&&(u=0),r=0;u>r;r++)j[r]=p*((u*u-r*r)*I/(u*u))}function N(t,s,i){var n,a,r,o,h,A,g;for(h=1e3,g=-1,n=D[s],a=n-1;e>n||a>=0;)e>n&&(A=F[n],r=A[1]-s,r>=h?n=e:(n++,0>r&&(r=-r),o=A[0]-t,0>o&&(o=-o),r+=o,h>r&&(o=A[2]-i,0>o&&(o=-o),r+=o,h>r&&(h=r,g=A[3])))),a>=0&&(A=F[a],r=s-A[1],r>=h?a=-1:(a--,0>r&&(r=-r),o=A[0]-t,0>o&&(o=-o),r+=o,h>r&&(o=A[2]-i,0>o&&(o=-o),r+=o,h>r&&(h=r,g=A[3]))));return g}function M(){return H(),G(),O(),R()}function G(){var t;for(t=0;e>t;t++)F[t][0]>>=o,F[t][1]>>=o,F[t][2]>>=o,F[t][3]=t}function X(t,s,i,n,a){var r,o,h,A,g,l,c;for(h=s-t,-1>h&&(h=-1),A=s+t,A>e&&(A=e),r=s+1,o=s-1,l=1;A>r||o>h;){if(g=j[l++],A>r){c=F[r++];try{c[0]-=g*(c[0]-i)/T|0,c[1]-=g*(c[1]-n)/T|0,c[2]-=g*(c[2]-a)/T|0}catch(u){}}if(o>h){c=F[o--];try{c[0]-=g*(c[0]-i)/T|0,c[1]-=g*(c[1]-n)/T|0,c[2]-=g*(c[2]-a)/T|0}catch(u){}}}}function Y(e,t,s,i,n){var a=F[t],r=e/w;a[0]-=r*(a[0]-s)|0,a[1]-=r*(a[1]-i)|0,a[2]-=r*(a[2]-n)|0}function q(t,s,i){var n,a,r,h,g,c,d,_,m,Q;for(_=~(1<<31),m=_,c=-1,d=c,n=0;e>n;n++)Q=F[n],a=Q[0]-t,0>a&&(a=-a),r=Q[1]-s,0>r&&(r=-r),a+=r,r=Q[2]-i,0>r&&(r=-r),a+=r,_>a&&(_=a,c=n),h=a-(k[n]>>A-o),m>h&&(m=h,d=n),g=L[n]>>u,L[n]-=g,k[n]+=g<<l;return L[c]+=p,k[c]-=f,d}var B,C,x,S,F,e=256,t=499,s=491,i=487,n=503,a=3*n,r=e-1,o=4,h=100,A=16,g=1<<A,l=10,u=10,p=g>>u,f=g<<l-u,d=e>>3,_=6,m=1<<_,Q=d*m,v=30,y=10,w=1<<y,b=8,I=1<<b,E=y+b,T=1<<E,D=[],k=[],L=[],j=[];P.apply(this,arguments);var U={};return U.map=N,U.process=M,U}return e}(),c=function(e){var t=function(){try{self.onmessage=function(e){var i,t=e.data||{};t.gifshot&&(i=s.run(t),postMessage(i))}}catch(t){}var s={dataToRGB:function(e,t,s){for(var i=0,n=t*s*4,a=[];n>i;)a.push(e[i++]),a.push(e[i++]),a.push(e[i++]),i++;return a},componentizedPaletteToArray:function(e){var s,i,n,a,t=[];for(s=0;s<e.length;s+=3)i=e[s],n=e[s+1],a=e[s+2],t.push(i<<16|n<<8|a);return t},processFrameWithQuantizer:function(t,s,i,n){var c,u,p,f,a=this.dataToRGB(t,s,i),r=new e(a,a.length,n),o=r.process(),h=new Uint32Array(this.componentizedPaletteToArray(o)),A=s*i,g=new Uint8Array(A),l=0;for(c=0;A>c;c++)u=a[l++],p=a[l++],f=a[l++],g[c]=r.map(u,p,f);return{pixels:g,palette:h}},run:function(e){var t=e.width,s=e.height,i=e.data,a=(e.palette,e.sampleInterval);return this.processFrameWithQuantizer(i,t,s,a)}};return s};return t}(l),u=function(e,t,s,n){function h(e){var t=e.length;if(2>t||t>256||t&t-1)throw"Invalid code/color length, must be power of 2 and 2 .. 256.";return t}function c(e,t,s,n){function u(s){for(;l>=s;)e[t++]=255&c,c>>=8,l-=8,t===a+256&&(e[a]=255,a=t++)}function p(e){c|=e<<l,l+=g,u(8)}e[t++]=s;var a=t++,r=1<<s,o=r-1,h=r+1,A=h+1,g=s+1,l=0,c=0,f=n[0]&o,d={};p(r);for(var _=1,m=n.length;m>_;++_){var Q=n[_]&o,v=f<<8|Q,y=d[v];if(y===i){for(c|=f<<l,l+=g;l>=8;)e[t++]=255&c,c>>=8,l-=8,t===a+256&&(e[a]=255,a=t++);4096===A?(p(r),A=h+1,g=s+1,d={}):(A>=1<<g&&++g,d[v]=A++),f=Q}else f=y}return p(f),p(h),u(1),a+1===t?e[a]=0:(e[a]=t-a-1,e[t++]=0),t}var a=0;n=n===i?{}:n;var r=n.loop===i?null:n.loop,o=n.palette===i?null:n.palette;if(0>=t||0>=s||t>65535||s>65535)throw"Width/Height invalid.";e[a++]=71,e[a++]=73,e[a++]=70,e[a++]=56,e[a++]=57,e[a++]=97;var A=0,g=0;if(e[a++]=255&t,e[a++]=t>>8&255,e[a++]=255&s,e[a++]=s>>8&255,e[a++]=(null!==o?128:0)|A,e[a++]=g,e[a++]=0,null!==r){if(0>r||r>65535)throw"Loop count invalid.";e[a++]=33,e[a++]=255,e[a++]=11,e[a++]=78,e[a++]=69,e[a++]=84,e[a++]=83,e[a++]=67,e[a++]=65,e[a++]=80,e[a++]=69,e[a++]=50,e[a++]=46,e[a++]=48,e[a++]=3,e[a++]=1,e[a++]=255&r,e[a++]=r>>8&255,e[a++]=0}var l=!1;this.addFrame=function(t,s,n,r,A,g){if(l===!0&&(--a,l=!1),g=g===i?{}:g,0>t||0>s||t>65535||s>65535)throw"x/y invalid.";if(0>=n||0>=r||n>65535||r>65535)throw"Width/Height invalid.";if(A.length<n*r)throw"Not enough pixels for the frame size.";var u=!0,p=g.palette;if((p===i||null===p)&&(u=!1,p=o),p===i||null===p)throw"Must supply either a local or global palette.";for(var f=h(p),d=0;f>>=1;)++d;f=1<<d;var _=g.delay===i?0:g.delay,m=g.disposal===i?0:g.disposal;if(0>m||m>3)throw"Disposal out of range.";var Q=!1,v=0;if(g.transparent!==i&&null!==g.transparent&&(Q=!0,v=g.transparent,0>v||v>=f))throw"Transparent color index.";if((0!==m||Q||0!==_)&&(e[a++]=33,e[a++]=249,e[a++]=4,e[a++]=m<<2|(Q===!0?1:0),e[a++]=255&_,e[a++]=_>>8&255,e[a++]=v,e[a++]=0),e[a++]=44,e[a++]=255&t,e[a++]=t>>8&255,e[a++]=255&s,e[a++]=s>>8&255,e[a++]=255&n,e[a++]=n>>8&255,e[a++]=255&r,e[a++]=r>>8&255,e[a++]=u===!0?128|d-1:0,u===!0)for(var y=0,w=p.length;w>y;++y){var B=p[y];e[a++]=B>>16&255,e[a++]=B>>8&255,e[a++]=255&B}a=c(e,a,2>d?2:d,A)},this.end=function(){return l===!1&&(e[a++]=59,l=!0),a}},p=function(e,s,i,n){var a=function(t){this.canvas=null,this.ctx=null,this.repeat=0,this.frames=[],this.numRenderedFrames=0,this.onRenderCompleteCallback=e.noop,this.onRenderProgressCallback=e.noop,this.workers=[],this.availableWorkers=[],this.generatingGIF=!1,this.options=t,this.initializeWebWorkers(t)};return a.prototype={workerMethods:s(),initializeWebWorkers:function(n){var r,o,h,A,a=i.toString()+"("+s.toString()+"());",g=-1,l="";for(A=n.numWorkers;++g<A;)r=e.createWebWorker(a),e.isObject(r)?(o=r.objectUrl,h=r.worker,this.workers.push({worker:h,objectUrl:o}),this.availableWorkers.push(h)):(l=r,e.webWorkerError=!!r);this.workerError=l,this.canvas=t.createElement("canvas"),this.canvas.width=n.gifWidth,this.canvas.height=n.gifHeight,this.ctx=this.canvas.getContext("2d"),this.frames=[]},getWorker:function(){return this.availableWorkers.pop()},freeWorker:function(e){this.availableWorkers.push(e)},byteMap:function(){for(var e=[],t=0;256>t;t++)e[t]=String.fromCharCode(t);return e}(),bufferToString:function(e){for(var t=e.length,s="",i=-1;++i<t;)s+=this.byteMap[e[i]];return s},onFrameFinished:function(t){var s=this,i=s.frames,n=s.options;hasExistingImages=!!(n.images||[]).length,allDone=i.every(function(e){return!e.beingProcessed&&e.done}),s.numRenderedFrames++,hasExistingImages&&t(s.numRenderedFrames/i.length),s.onRenderProgressCallback(.75*s.numRenderedFrames/i.length),allDone?s.generatingGIF||s.generateGIF(i,s.onRenderCompleteCallback):e.requestTimeout(function(){s.processNextFrame()},1)},processFrame:function(e){var r,o,t=this,s=this.options,i=s.progressCallback,n=s.sampleInterval,a=this.frames,h=function(e){var s=e.data;delete r.data,r.pixels=Array.prototype.slice.call(s.pixels),r.palette=Array.prototype.slice.call(s.palette),r.done=!0,r.beingProcessed=!1,t.freeWorker(o),t.onFrameFinished(i)};return r=a[e],r.beingProcessed||r.done?void this.onFrameFinished():(r.sampleInterval=n,r.beingProcessed=!0,r.gifshot=!0,o=this.getWorker(),void(o?(o.onmessage=h,o.postMessage(r)):h({data:t.workerMethods.run(r)})))},startRendering:function(e){this.onRenderCompleteCallback=e;for(var t=0;t<this.options.numWorkers&&t<this.frames.length;t++)this.processFrame(t)},processNextFrame:function(){for(var e=-1,t=0;t<this.frames.length;t++){var s=this.frames[t];if(!s.done&&!s.beingProcessed){e=t;break}}e>=0&&this.processFrame(e)},generateGIF:function(t,s){var f,d,i=[],a={loop:this.repeat},r=this.options,o=r.interval,h=r.images,A=!!h.length,g=r.gifHeight,l=r.gifWidth,c=new n(i,l,g,a),u=this.onRenderProgressCallback,p=A?100*o:0;this.generatingGIF=!0,e.each(t,function(e,s){var i=s.palette;u(.75+.25*s.position*1/t.length),c.addFrame(0,0,l,g,s.pixels,{palette:i,delay:p})}),c.end(),u(1),this.frames=[],this.generatingGIF=!1,e.isFunction(s)&&(f=this.bufferToString(i),d="data:image/gif;base64,"+e.btoa(f),s(d))},setRepeat:function(e){this.repeat=e},addFrame:function(t,s){s=e.isObject(s)?s:{};var v,i=this,n=i.ctx,a=i.options,r=a.gifWidth,o=a.gifHeight,g=(s.gifHeight,s.gifWidth,s.text),l=s.fontWeight,c=e.getFontSize(s),u=s.fontFamily,p=s.fontColor,f=s.textAlign,d=s.textBaseline,_=s.textXCoordinate?s.textXCoordinate:"left"===f?1:"right"===f?r:r/2,m=s.textYCoordinate?s.textYCoordinate:"top"===d?1:"center"===d?o/2:o,Q=l+" "+c+" "+u;try{n.drawImage(t,0,0,r,o),g&&(n.font=Q,n.fillStyle=p,n.textAlign=f,n.textBaseline=d,n.fillText(g,_,m)),v=n.getImageData(0,0,r,o),i.addFrameImageData(v)}catch(y){return""+y}},addFrameImageData:function(e){var t=this.frames,s=e.data;this.frames.push({data:s,width:e.width,height:e.height,palette:null,dithering:null,done:!1,beingProcessed:!1,position:t.length})},onRenderProgress:function(e){this.onRenderProgressCallback=e},isRendering:function(){return this.generatingGIF},getBase64GIF:function(t){var s=this,i=function(i){s.destroyWorkers(),e.requestTimeout(function(){t(i)},0)};s.startRendering(i)},destroyWorkers:function(){if(!this.workerError){var t=this.workers;e.each(t,function(t,s){var i=s.worker,n=s.objectUrl;i.terminate(),e.URL.revokeObjectURL(n)})}}},a}(n,c,l,u),f=function(e,t){e.getBase64GIF(function(e){t({error:!1,errorCode:"",errorMsg:"",image:e})})},d=function(e){function _(){n.each(l,function(e,t){t&&d.addFrame(t,h)}),f(d,o)}var u,d,s=e.images,r=e.imagesLength,o=e.callback,h=e.options,A={getUserMedia:!0,"window.URL":!0},g=a.validate(A),l=[],c=0;return g.error?o(g):(d=new p(h),void n.each(s,function(e,s){n.isElement(s)?(h.crossOrigin&&(s.crossOrigin=h.crossOrigin),l[e]=s,c+=1,c===r&&_()):n.isString(s)&&(u=t.createElement("img"),h.crossOrigin&&(u.crossOrigin=h.crossOrigin),u.onerror=function(t){l.length>e&&(l[e]=i)}(function(t){t.onload=function(){l[e]=t,c+=1,c===r&&_(),n.removeElement(t)}}(u)),u.src=s,n.setCSSAttr(u,{position:"fixed",opacity:"0"}),t.body.appendChild(u))}))},_={getGIF:function(e,s){s=n.isFunction(s)?s:n.noop;var a,i=t.createElement("canvas"),r=e.images,o=!!r.length,h=e.videoElement,A=e.keepCameraOn,g=e.webcamVideoElement,l=e.cameraStream,c=+e.gifWidth,u=+e.gifHeight,f=e.videoWidth,d=e.videoHeight,Q=(+e.sampleInterval,+e.numWorkers,e.crop),v=+e.interval,y=o?0:1e3*v,w=e.progressCallback,B=e.savedRenderingContexts,b=e.saveRenderingContexts,I=[],E=B.length?B.length:e.numFrames,T=E,C=new p(e),x=e.text,S=e.fontWeight,F=n.getFontSize(e),D=e.fontFamily,k=e.fontColor,L=e.textAlign,j=e.textBaseline,P=e.textXCoordinate?e.textXCoordinate:"left"===L?1:"right"===L?c:c/2,R=e.textYCoordinate?e.textYCoordinate:"top"===j?1:"center"===j?u/2:u,O=S+" "+F+" "+D,H=Q?Math.floor(Q.scaledWidth/2):0,N=Q?f-Q.scaledWidth:0,M=Q?Math.floor(Q.scaledHeight/2):0,G=Q?d-Q.scaledHeight:0,X=function Y(){function t(){try{N>f&&(N=f),G>d&&(G=d),0>H&&(H=0),0>M&&(M=0),a.drawImage(h,H,M,N,G,0,0,c,u),i()}catch(e){if("NS_ERROR_NOT_AVAILABLE"!==e.name)throw e;n.requestTimeout(t,100)}}function i(){T=e;var r,o,p,f,i=E-T;b&&I.push(a.getImageData(0,0,c,u)),x&&(a.font=O,a.fillStyle=k,a.textAlign=L,a.textBaseline=j,a.fillText(x,P,R)),r=a.getImageData(0,0,c,u),o=r.data,p=o[0]+o[1]+o[2]+o[3],f=0===p,f?1===i&&1===E&&t():C.addFrameImageData(r),w(i/E),e>0&&n.requestTimeout(Y,y),T||C.getBase64GIF(function(e){s({error:!1,errorCode:"",errorMsg:"",image:e,cameraStream:l,videoElement:h,webcamVideoElement:g,savedRenderingContexts:I,keepCameraOn:A})})}var e=T-1;B.length?(a.putImageData(B[E-T],0,0),i()):t()};E=null!=E?E:10,v=null!=v?v:.1,i.width=c,i.height=u,a=i.getContext("2d"),function q(){return B.length||0!==h.currentTime?void X():void n.requestTimeout(q,100)}()},getCropDimensions:function(e){var t=e.videoWidth,s=e.videoHeight,i=e.gifWidth,n=e.gifHeight,a={width:0,height:0,scaledWidth:0,scaledHeight:0};return t>s?(a.width=Math.round(t*(n/s))-i,a.scaledWidth=Math.round(a.width*(s/n))):(a.height=Math.round(s*(i/t))-n,a.scaledHeight=Math.round(a.height*(t/i))),a}},m={loadedData:!1,defaultVideoDimensions:{width:640,height:480},findVideoSize:function C(e){C.attempts=C.attempts||0;var t=this,s=e.videoElement,i=e.cameraStream,a=e.completedCallback;s&&(s.videoWidth>0&&s.videoHeight>0?(s.removeEventListener("loadeddata",t.findVideoSize),a({videoElement:s,cameraStream:i,videoWidth:s.videoWidth,videoHeight:s.videoHeight})):C.attempts<10?(C.attempts+=1,n.requestTimeout(function(){t.findVideoSize(e)},200)):a({videoElement:s,cameraStream:i,videoWidth:t.defaultVideoDimensions.width,videoHeight:t.defaultVideoDimensions.height}))},onStreamingTimeout:function(e){n.isFunction(e)&&e({error:!0,errorCode:"getUserMedia",errorMsg:"There was an issue with the getUserMedia API - Timed out while trying to start streaming",image:null,cameraStream:{}})},stream:function(e){var t=this,s=n.isArray(e.existingVideo)?e.existingVideo[0]:e.existingVideo,i=e.videoElement,a=e.cameraStream,r=e.streamedCallback,o=e.completedCallback;n.isFunction(r)&&r(),s?n.isString(s)&&(i.src=s,i.innerHTML='<source src="'+s+'" type="video/'+n.getExtension(s)+'" />'):i.mozSrcObject?i.mozSrcObject=a:n.URL&&(i.src=n.URL.createObjectURL(a)),i.play(),n.requestTimeout(function h(){h.count=h.count||0,t.loadedData===!0?(t.findVideoSize({videoElement:i,cameraStream:a,completedCallback:o}),t.loadedData=!1):(h.count+=1,h.count>10?t.findVideoSize({videoElement:i,cameraStream:a,completedCallback:o}):h())},100)},startStreaming:function(e){var s=this,i=n.isFunction(e.error)?e.error:n.noop,a=n.isFunction(e.streamed)?e.streamed:n.noop,r=n.isFunction(e.completed)?e.completed:n.noop,o=e.existingVideo,h=e.webcamVideoElement,A=n.isElement(o)?o:h?h:t.createElement("video"),g=e.lastCameraStream,l=e.crossOrigin,c=e.options;l&&(A.crossOrigin=c.crossOrigin),A.autoplay=!0,A.loop=!0,A.muted=!0,A.addEventListener("loadeddata",function(e){s.loadedData=!0}),o?s.stream({videoElement:A,existingVideo:o,completedCallback:r}):g?s.stream({videoElement:A,cameraStream:g,streamedCallback:a,completedCallback:r}):n.getUserMedia({video:!0},function(e){s.stream({videoElement:A,cameraStream:e,streamedCallback:a,completedCallback:r})},i)},startVideoStreaming:function(e,t){t=t||{};var a,s=this,r=t.timeout!==i?t.timeout:0,o=t.callback,h=t.webcamVideoElement;r>0&&(a=n.requestTimeout(function(){s.onStreamingTimeout(o)},1e4)),this.startStreaming({error:function(){o({error:!0,errorCode:"getUserMedia",errorMsg:"There was an issue with the getUserMedia API - the user probably denied permission",image:null,cameraStream:{}})},streamed:function(){clearTimeout(a)},completed:function(t){var s=t.cameraStream,i=t.videoElement,n=t.videoWidth,a=t.videoHeight;e({cameraStream:s,videoElement:i,videoWidth:n,videoHeight:a})},lastCameraStream:t.lastCameraStream,webcamVideoElement:h,crossOrigin:t.crossOrigin,options:t})},stopVideoStreaming:function(e){e=n.isObject(e)?e:{};var t=e.cameraStream,s=e.videoElement,i=e.keepCameraOn,a=e.webcamVideoElement;!i&&t&&n.isFunction(t.stop)&&t.stop(),n.isElement(s)&&!a&&(s.pause(),n.isFunction(n.URL.revokeObjectURL)&&!n.webWorkerError&&s.src&&n.URL.revokeObjectURL(s.src),n.removeElement(s))}},Q=function(e){e=n.isObject(e)?e:{};var s=(n.isObject(e.options)?e.options:{},e.cameraStream),i=e.videoElement,a=e.webcamVideoElement,r=e.keepCameraOn;m.stopVideoStreaming({cameraStream:s,videoElement:i,keepCameraOn:r,webcamVideoElement:a})},v=function(e,s){var i=e.options||{},a=i.images,r=i.video,h=(+i.numFrames,e.cameraStream),A=e.videoElement,g=e.videoWidth,l=e.videoHeight,c=+i.gifWidth,u=+i.gifHeight,p=_.getCropDimensions({videoWidth:g,videoHeight:l,gifHeight:u,gifWidth:c}),f=s;i.crop=p,i.videoElement=A,i.videoWidth=g,i.videoHeight=l,i.cameraStream=h,n.isElement(A)&&(A.width=c+p.width,A.height=u+p.height,i.webcamVideoElement||(n.setCSSAttr(A,{position:"fixed",opacity:"0"}),t.body.appendChild(A)),A.play(),_.getGIF(i,function(e){a&&a.length||r&&r.length||Q(e),f(e)}))},y=function(e){var A,g,t=e.existingVideo,s=e.callback,i=e.options,r={getUserMedia:!0,"window.URL":!0},o=a.validate(r);if(o.error)return s(o);if(n.isElement(t)&&t.src){if(g=t.src,A=n.getExtension(g),!n.isSupported.videoCodecs[A])return s(a.messages.videoCodecs)}else n.isArray(t)&&n.each(t,function(e,s){return A=s.substr(s.lastIndexOf(".")+1,s.length),n.isSupported.videoCodecs[A]?(t=s,!1):void 0});m.startStreaming({completed:function(e){e.options=i||{},v(e,s)},existingVideo:t,crossOrigin:i.crossOrigin,options:i})},w=function(e){var t=e.lastCameraStream,s=e.callback,i=e.webcamVideoElement,n=e.options;return h()?n.savedRenderingContexts.length?void _.getWebcamGIF(n,function(e){s(e)}):void m.startVideoStreaming(function(e){e.options=n||{},v(e,s)},{lastCameraStream:t,callback:s,webcamVideoElement:i,crossOrigin:n.crossOrigin}):s(a.validate())},B=function(e,t){if(t=n.isFunction(e)?e:t,e=n.isObject(e)?e:{},n.isFunction(t)){var s=n.mergeOptions(r,e)||{},i=e.cameraStream,a=s.images,o=a?a.length:0,h=s.video,A=s.webcamVideoElement;s=n.mergeOptions(s,{gifWidth:Math.floor(s.gifWidth),gifHeight:Math.floor(s.gifHeight)}),o?d({images:a,imagesLength:o,callback:t,options:s}):h?y({existingVideo:h,callback:t,options:s}):w({lastCameraStream:i,callback:t,webcamVideoElement:A,options:s})}},b=function(e,t){if(t=n.isFunction(e)?e:t,e=n.isObject(e)?e:{},n.isFunction(t)){var s=n.mergeOptions(r,e),i=n.mergeOptions(s,{interval:.1,numFrames:1,gifWidth:Math.floor(s.gifWidth),gifHeight:Math.floor(s.gifHeight)});B(i,t)}},I=function(e,t,s,i,n,a,r,o,h,A){var g={utils:e,error:t,defaultOptions:s,createGIF:o,takeSnapShot:h,stopVideoStreaming:A,isSupported:i,isWebCamGIFSupported:n,isExistingVideoGIFSupported:r,isExistingImagesGIFSupported:a,VERSION:"0.3.2"};return g}(n,a,r,o,h,A,g,B,b,Q),function(t){"function"==typeof define&&define.amd?define([],function(){return t}):"undefined"!=typeof exports?module.exports=t:e.gifshot=t}(I)}("undefined"!=typeof window?window:{},"undefined"!=typeof document?document:{createElement:function(){}},"undefined"!=typeof window?window.navigator:{});