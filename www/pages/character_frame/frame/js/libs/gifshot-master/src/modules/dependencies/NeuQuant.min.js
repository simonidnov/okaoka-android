define(function(){function e(){function P(t,s,i){var n,a;for(C=t,x=s,S=i,F=new Array(e),n=0;e>n;n++)F[n]=new Array(4),a=F[n],a[0]=a[1]=a[2]=(n<<o+8)/e|0,L[n]=g/e|0,k[n]=0}function R(){for(var t=[],s=new Array(e),i=0;e>i;i++)s[F[i][3]]=i;for(var n=0,a=0;e>a;a++){var r=s[a];t[n++]=F[r][0],t[n++]=F[r][1],t[n++]=F[r][2]}return t}function O(){var t,s,i,n,a,o,h,A;for(h=0,A=0,t=0;e>t;t++){for(a=F[t],i=t,n=a[1],s=t+1;e>s;s++)o=F[s],o[1]<n&&(i=s,n=o[1]);if(o=F[i],t!=i&&(s=o[0],o[0]=a[0],a[0]=s,s=o[1],o[1]=a[1],a[1]=s,s=o[2],o[2]=a[2],a[2]=s,s=o[3],o[3]=a[3],a[3]=s),n!=h){for(D[h]=A+t>>1,s=h+1;n>s;s++)D[s]=t;h=n,A=t}}for(D[h]=A+r>>1,s=h+1;256>s;s++)D[s]=r}function H(){var e,r,A,g,l,c,u,p,f,d,m,y,b,E;for(a>x&&(S=1),B=30+(S-1)/3,y=C,b=0,E=x,m=x/(3*S),d=m/h|0,p=w,c=Q,u=c>>_,1>=u&&(u=0),e=0;u>e;e++)j[e]=p*((u*u-e*e)*I/(u*u));for(f=a>x?3:x%t!==0?3*t:x%s!==0?3*s:x%i!==0?3*i:3*n,e=0;m>e;)if(A=(255&y[b+0])<<o,g=(255&y[b+1])<<o,l=(255&y[b+2])<<o,r=q(A,g,l),Y(p,r,A,g,l),0!==u&&X(u,r,A,g,l),b+=f,b>=E&&(b-=x),e++,0===d&&(d=1),e%d===0)for(p-=p/B,c-=c/v,u=c>>_,1>=u&&(u=0),r=0;u>r;r++)j[r]=p*((u*u-r*r)*I/(u*u))}function N(t,s,i){var n,a,r,o,h,A,g;for(h=1e3,g=-1,n=D[s],a=n-1;e>n||a>=0;)e>n&&(A=F[n],r=A[1]-s,r>=h?n=e:(n++,0>r&&(r=-r),o=A[0]-t,0>o&&(o=-o),r+=o,h>r&&(o=A[2]-i,0>o&&(o=-o),r+=o,h>r&&(h=r,g=A[3])))),a>=0&&(A=F[a],r=s-A[1],r>=h?a=-1:(a--,0>r&&(r=-r),o=A[0]-t,0>o&&(o=-o),r+=o,h>r&&(o=A[2]-i,0>o&&(o=-o),r+=o,h>r&&(h=r,g=A[3]))));return g}function M(){return H(),G(),O(),R()}function G(){var t;for(t=0;e>t;t++)F[t][0]>>=o,F[t][1]>>=o,F[t][2]>>=o,F[t][3]=t}function X(t,s,i,n,a){var r,o,h,A,g,l,c;for(h=s-t,-1>h&&(h=-1),A=s+t,A>e&&(A=e),r=s+1,o=s-1,l=1;A>r||o>h;){if(g=j[l++],A>r){c=F[r++];try{c[0]-=g*(c[0]-i)/T|0,c[1]-=g*(c[1]-n)/T|0,c[2]-=g*(c[2]-a)/T|0}catch(u){}}if(o>h){c=F[o--];try{c[0]-=g*(c[0]-i)/T|0,c[1]-=g*(c[1]-n)/T|0,c[2]-=g*(c[2]-a)/T|0}catch(u){}}}}function Y(e,t,s,i,n){var a=F[t],r=e/w;a[0]-=r*(a[0]-s)|0,a[1]-=r*(a[1]-i)|0,a[2]-=r*(a[2]-n)|0}function q(t,s,i){var n,a,r,h,g,c,d,_,m,Q;for(_=~(1<<31),m=_,c=-1,d=c,n=0;e>n;n++)Q=F[n],a=Q[0]-t,0>a&&(a=-a),r=Q[1]-s,0>r&&(r=-r),a+=r,r=Q[2]-i,0>r&&(r=-r),a+=r,_>a&&(_=a,c=n),h=a-(k[n]>>A-o),m>h&&(m=h,d=n),g=L[n]>>u,L[n]-=g,k[n]+=g<<l;return L[c]+=p,k[c]-=f,d}var B,C,x,S,F,e=256,t=499,s=491,i=487,n=503,a=3*n,r=e-1,o=4,h=100,A=16,g=1<<A,l=10,u=10,p=g>>u,f=g<<l-u,d=e>>3,_=6,m=1<<_,Q=d*m,v=30,y=10,w=1<<y,b=8,I=1<<b,E=y+b,T=1<<E,D=[],k=[],L=[],j=[];P.apply(this,arguments);var U={};return U.map=N,U.process=M,U}return e});