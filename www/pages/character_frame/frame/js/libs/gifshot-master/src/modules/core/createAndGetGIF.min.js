define(["core/utils","core/screenShot","API/stopVideoStreaming"],function(e,t,s){return function(i,n){var a=i.options||{},r=a.images,o=a.video,A=(+a.numFrames,i.cameraStream),g=i.videoElement,l=i.videoWidth,c=i.videoHeight,u=+a.gifWidth,p=+a.gifHeight,f=t.getCropDimensions({videoWidth:l,videoHeight:c,gifHeight:p,gifWidth:u}),d=n;a.crop=f,a.videoElement=g,a.videoWidth=l,a.videoHeight=c,a.cameraStream=A,e.isElement(g)&&(g.width=u+f.width,g.height=p+f.height,a.webcamVideoElement||(e.setCSSAttr(g,{position:"fixed",opacity:"0"}),document.body.appendChild(g)),g.play(),t.getGIF(a,function(e){r&&r.length||o&&o.length||s(e),d(e)}))}});