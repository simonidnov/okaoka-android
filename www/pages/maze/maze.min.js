var _okg=null;function maze(){this._tile_size=25;this._time_lap=60000;this.maze_level=[];this.playlist_uri="/playlist/";this.playlist=null;this._current_maze=0;this.init();this.game_infos={great:0,wrong:0};_okg=this}maze.prototype.init=function(){};maze.prototype.pause=function(){};maze.prototype.play=function(){};maze.prototype.draw_level=function(){this.maze_level=this.generateSquareMaze(21);var b=null;new createjs.Shape();for(var d=0;d<this.maze_level.length;d++){for(var a=0;a<this.maze_level[d].length;a++){var c=new createjs.Shape();if(this.maze_level[d][a]){c.graphics.beginFill("rgba(0,0,0,.3)");c.graphics.drawRect(0,0,this._tile_size,this._tile_size);c.x=this._tile_size*d;c.y=this._tile_size*a;this.maze_container.addChild(c)}else{if(b===null){var b=new createjs.Shape();b.graphics.beginFill("#FFF000");b.graphics.drawRect(0,0,this._tile_size,this._tile_size);b.x=this._tile_size*d;b.y=this._tile_size*a;this.maze_container.addChild(b)}var e={line:d,column:a}}}if(d===this.maze_level.length-1){var f=new createjs.Shape();f.graphics.beginFill("#FFF000");f.graphics.drawRect(0,0,this._tile_size,this._tile_size);f.x=this._tile_size*e.line;f.y=this._tile_size*e.column;this.maze_container.addChild(f)}}};maze.prototype.create_interface=function(){$("#maze_canvas").css({width:window.innerWidth,height:window.innerHeight}).attr({width:window.innerWidth,height:window.innerHeight});this.stage=new createjs.Stage("maze_canvas");this.stage.autoClear=true;this.stage.update();this.maze_container=this.stage.addChild(new createjs.Container());this.build_chronos_line();this.create_taskbar();createjs.Touch.enable(this.stage);createjs.Ticker.addEventListener("tick",this.tick);createjs.Ticker.setFPS(60);utilities.show_popup({color:navigation._current_interface_color,motion:"maze_tuto_popup",buttons:["play"]},function(a){_okg.count_start_chronos(function(){_okg.start_date=new Date().getTime();_okg.okaokasprite.gotoAndPlay("run");_okg.started=true;_okg.draw_level()})})};maze.prototype.tick=function(){if(_okg.started){_okg.update_chronos()}_okg.stage.update()};maze.prototype.destroy=function(a){$(".okaoka_maze").html("");a()};maze.prototype.generateSquareMaze=function(e){function a(g,f,h){g[f][h]=false;while(true){directions=[];if(f>1&&g[f-2][h]==true){directions.push([-1,0])}if(f<g.dimension-2&&g[f+2][h]==true){directions.push([1,0])}if(h>1&&g[f][h-2]==true){directions.push([0,-1])}if(h<g.dimension-2&&g[f][h+2]==true){directions.push([0,1])}if(directions.length==0){return g}dir=directions[Math.floor(Math.random()*directions.length)];g[f+dir[0]][h+dir[1]]=false;g=a(g,f+dir[0]*2,h+dir[1]*2)}}var d=new Array(e);d.dimension=e;for(var c=0;c<e;c++){d[c]=new Array(e);for(var b=0;b<e;b++){d[c][b]=true}}d=a(d,1,1);return d};maze.prototype.update_chronos=function(){var b=new Date().getTime();var a=b-this.start_date;var c=(this._time_lap-a);this.chronostext.text=Math.ceil(c/1000);this.greattext.text=this.game_infos.great;this.wrongtext.text=this.game_infos.wrong;var d=100-((c*100)/this._time_lap);this.chronos_line_progress.scaleX=d/100;this.okaokasprite.x=(window.innerWidth)*(d/100)-50;if(c<=0){console.log("le jeu est fini chronos");this.started=false;this.okaokasprite.gotoAndStop("stand");this.end_game()}};maze.prototype.create_taskbar=function(){this.score_infos=this.stage.addChild(new createjs.Container());this.score_infos_ground=new createjs.Shape();this.score_infos.addChild(this.score_infos_ground);this.greatsprite=new createjs.Bitmap("pages/simplediscs/images/great.png");this.wrongsprite=new createjs.Bitmap("pages/simplediscs/images/wrong.png");this.chronosprite=new createjs.Bitmap("pages/simplediscs/images/chronos.png");this.greattext=new createjs.Text();this.greattext.font="100 35px Roboto";this.greattext.color="#FFFFFF";this.greattext.text="0";this.wrongtext=new createjs.Text();this.wrongtext.font="100 35px Roboto";this.wrongtext.color="#FFFFFF";this.wrongtext.text="0";this.chronostext=new createjs.Text();this.chronostext.font="100 35px Roboto";this.chronostext.color="#FFFFFF";this.chronostext.text="60";this.greatsprite.regX=this.greatsprite.regY=this.wrongsprite.regX=this.wrongsprite.regY=this.chronosprite.regX=this.chronosprite.regY=20;this.greattext.textAlign="center";this.wrongtext.textAlign="center";this.chronostext.textAlign="center";this.greatsprite.y=this.wrongsprite.y=this.chronosprite.y=20;this.chronosprite.x=20;this.chronostext.x=20;this.chronostext.y=50;this.greatsprite.x=110;this.greattext.x=110;this.greattext.y=50;this.wrongsprite.x=200;this.wrongtext.x=200;this.wrongtext.y=50;var b={images:["./pages/dots/images/five_hits_sprite.png"],frames:{width:100,height:100},animations:{hit:[0,15,true],stop:16}};var a=new createjs.SpriteSheet(b);b=null;delete b;this.fivehits=new createjs.Sprite(a,"stop");this.fivehits.regX=this.fivehits.regY=25;this.fivehits.x=-3;this.fivehits.y=45;this.score_infos.addChild(this.fivehits);this.score_infos.addChild(this.greatsprite);this.score_infos.addChild(this.wrongsprite);this.score_infos.addChild(this.chronosprite);this.score_infos.addChild(this.greattext);this.score_infos.addChild(this.wrongtext);this.score_infos.addChild(this.chronostext);this.score_infos.x=(window.innerWidth/2)-(this.score_infos.getBounds().width/2);this.score_infos.y=20};maze.prototype.destroy_circles=function(){for(var a=0;a<this.stage.getNumChildren();a++){if(this.stage.getChildAt(a).name!==null){if(this.stage.getChildAt(a).name.indexOf("circle")!==-1){TweenMax.to(this.stage.getChildAt(a),0.2,{scaleX:0,scaleY:0,onComplete:function(){_okg.stage.removeChild($(this))}})}}}};maze.prototype.end_game=function(){this.destroy_circles();TweenMax.to(_okg.score_infos,0.5,{y:window.innerHeight/2-(_okg.score_infos.getBounds().height/2),x:(window.innerWidth/2)-(_okg.score_infos.getBounds().width/2),ease:Power4.easeInOut,delay:0.5,onComplete:function(){_okg.destroy_circles();utilities.create_over_motion({size:{width:400,height:200},position:{x:((window.innerWidth/2)-200),y:((window.innerHeight/2)-265)},motion:"winning_dance_top_motion"},function(){});createjs.Ticker.setFPS(30);_okg.total_score_text=new createjs.Text();_okg.total_score_text.font="700 100px Roboto";_okg.total_score_text.color="#FFFFFF";_okg.total_score_text.text="00000";_okg.total_score_text.textAlign="center";_okg.total_score_text.x=window.innerWidth/2;_okg.total_score_text.y=_okg.score_infos.y+_okg.score_infos.getBounds().height;_okg.stage.addChild(_okg.total_score_text);var b=(_okg.game_infos.great-_okg.game_infos.wrong)*_okg.level;if(b<0){b=0}var a={total:0};audio_manager.play_sound("total_count",0,function(c){});TweenMax.to(a,2.5,{total:b,delay:0.6,onUpdate:function(){var f="";var c=Math.ceil(a.total);if(c.toString().length<5){var e=5-c.toString().length;for(var d=0;d<e;d++){f+="0"}}f+=c.toString();_okg.total_score_text.text=f},ease:Power4.easeOut,onComplete:function(){_okg.replay_button=new createjs.Bitmap("./images/assets/btn_replay.png");_okg.replay_button.x=window.innerWidth/2+70;_okg.replay_button.y=_okg.total_score_text.y+_okg.total_score_text.getBounds().height+70;_okg.replay_button.regX=_okg.replay_button.regY=50;_okg.replay_button.scaleX=_okg.replay_button.scaleY=0;_okg.stats_button=new createjs.Bitmap("./images/assets/btn_podium.png");_okg.stats_button.x=window.innerWidth/2-70;_okg.stats_button.y=_okg.total_score_text.y+_okg.total_score_text.getBounds().height+70;_okg.stats_button.regX=_okg.stats_button.regY=50;_okg.stats_button.scaleX=_okg.stats_button.scaleY=0;var c=new createjs.Graphics();c.beginFill(navigation._current_interface_color);c.drawCircle(50,50,50);c.endFill();_okg.replay_button.hitArea=new createjs.Shape(c);_okg.stats_button.hitArea=new createjs.Shape(c);utilities.save_score_game("number",b);_okg.replay_button.addEventListener("click",function(d){window.location.href="#page/"+navigation._current_page_name+"/intro/false/date/"+new Date().getTime()});_okg.stats_button.addEventListener("click",function(d){utilities.show_score_game("number",b)});TweenMax.to(_okg.replay_button,0.5,{scaleX:1,scaleY:1});TweenMax.to(_okg.stats_button,0.5,{scaleX:1,scaleY:1,delay:0.2});_okg.stage.addChild(_okg.replay_button);_okg.stage.addChild(_okg.stats_button)}})}})};maze.prototype.count_start_chronos=function(a){this.countGround=new createjs.Shape();this.countGround.graphics.beginFill(navigation._current_interface_color);this.countGround.graphics.drawCircle(0,0,70);this.countGround.scaleX=this.countGround.scaleY=0;this.countGround.x=window.innerWidth/2;this.countGround.y=window.innerHeight/2;TweenMax.to(this.countGround,0.5,{scaleX:1,scaleY:1});this.stage.addChild(this.countGround);this.countMotion=new lib.count_3();this.countMotion.regX=275;this.countMotion.regY=200;this.countMotion.x=window.innerWidth/2;this.countMotion.y=window.innerHeight/2;this.stage.addChild(this.countMotion);utilities.countCallBack=function(){TweenMax.to(_okg.countGround,0.5,{scaleX:0,scaleY:0});_okg.stage.removeChild(_okg.countMotion);_okg.stage.removeChild(_okg.countGround);a()}};maze.prototype.build_chronos_line=function(){this.okaokarun=new Image();this.okaokarun.src="pages/simplediscs/images/simple_run.png";this.chronos_line=this.stage.addChild(new createjs.Container());this.chronos_line.regY=25;this.chronos_line.y=window.innerHeight;this.chronos_line_ground=new createjs.Shape();this.chronos_line_ground.graphics.beginFill("rgba(0,0,0,.3)");this.chronos_line_ground.graphics.drawRect(0,0,window.innerWidth,25);this.chronos_line.addChild(this.chronos_line_ground);this.chronos_line_progress=new createjs.Shape();this.chronos_line_progress.graphics.beginFill("#FFFFFF");this.chronos_line_progress.graphics.drawRect(0,0,window.innerWidth,25);this.chronos_line_progress.scaleX=0;this.chronos_line.addChild(this.chronos_line_progress);var b={images:[this.okaokarun],frames:{width:80,height:80},animations:{stand:{frames:[0]},run:{frames:[0,0,1,1,2,2,3,3,4,4,5,5,6,6],frequency:50},great:{frames:[7,7,8,8,9,9,10,10,11,11,12,12,13,13,14,14,15,15,16],next:"run"},wrong:{frames:[17,17,18,18,19,19,20,20,21,21,22,22,23,23,24],next:"wrongslide"},wrongslide:{frames:[21,21,22,22,23,23,21,21,22,22,23,23,21,21,22,22,23,23,21,21,22,22,23,23],next:"run"}},framerate:5};var a=new createjs.SpriteSheet(b);this.okaokasprite=new createjs.Sprite(a,"run");this.okaokasprite.scaleX=this.okaokasprite.scaleY=0.7;this.okaokasprite.y=-55;this.okaokasprite.gotoAndStop("stand");this.chronos_line.addChild(this.okaokasprite)};