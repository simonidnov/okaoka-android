var _okg=null;function maze(){this._direction={angle:0,distance:0,position:{x:0,y:0}};this.brick=null;this.element=[];this.first_brick=null;this.last_brick=null;this._tile_size=50;this._init_pos={x:0,y:0};this._time_lap=60000;this.maze_level=[];this.playlist_uri="/playlist/";this.playlist=null;this._current_maze=0;this._joy=null;this.init();this.maze_size=7;this.level=0;this.is_playing=false;this.gameInfos={great:0,wrong:0,start:0,delay:60000};_okg=this}maze.prototype.init=function(){console.log("init")};maze.prototype.pause=function(){};maze.prototype.play=function(){};maze.prototype.hit=function(a){console.log(a)};maze.prototype.draw_level=function(){_okg.first_brick=null;this.maze_level=this.generateSquareMaze(_okg.maze_size);var c=null;new createjs.Shape();_okg.game.input.onDown.add(_okg.hit,this);_okg.brick=_okg.game.add.physicsGroup(Phaser.Physics.ARCADE);_okg.element=_okg.game.add.physicsGroup(Phaser.Physics.ARCADE);TweenMax.set(_okg.brick,{alpha:0});TweenMax.set(_okg.element,{alpha:0});for(var d=0;d<this.maze_level.length;d++){for(var a=0;a<this.maze_level[d].length;a++){if(this.maze_level[d][a]){var e=_okg.brick.create(this._init_pos.x+(this._tile_size*d),this._init_pos.y+(this._tile_size*a),"wall")}else{if(_okg.first_brick===null){var g={line:d,column:a};_okg.first_brick=""}var f={line:d,column:a};var b=Math.random();if(b<0.1){_okg.element.create(this._init_pos.x+(this._tile_size*d),this._init_pos.y+(this._tile_size*a),"circle")}else{if(b<0.2){_okg.element.create(this._init_pos.x+(this._tile_size*d),this._init_pos.y+(this._tile_size*a),"square")}else{if(b<0.3){_okg.element.create(this._init_pos.x+(this._tile_size*d),this._init_pos.y+(this._tile_size*a),"triangle")}}}}}if(d===this.maze_level.length-1){_okg.last_brick=_okg.game.add.sprite(this._init_pos.x+(this._tile_size*f.line),this._init_pos.y+(this._tile_size*f.column),"end");_okg.game.physics.arcade.enable(_okg.last_brick);_okg.last_brick.body.velocity.set(0,0);_okg.last_brick.body.bounce.set(1);_okg.last_brick.body.immovable=true;_okg.last_brick.body.collideWorldBounds=false;_okg.last_brick.body.allowGravity=false;TweenMax.set(_okg.last_brick,{alpha:0});_okg.first_brick=_okg.game.add.sprite(this._init_pos.x+(this._tile_size*g.line),this._init_pos.y+(this._tile_size*g.column),"hero");TweenMax.set(_okg.first_brick,{alpha:0});_okg.game.physics.arcade.enable(_okg.first_brick);_okg.first_brick.body.velocity.set(0,0);_okg.first_brick.body.bounce.set(1);_okg.first_brick.body.enable=true;_okg.first_brick.body.collideWorldBounds=false;_okg.first_brick.body.allowGravity=true;_okg.first_brick.body.immovable=false;_okg.first_brick.body.bounce=0;setTimeout(function(){if(_okg.brick.getBounds().width>window.innerWidth&&_okg.brick.getBounds().width>window.innerHeight){_okg.game.camera.follow(_okg.first_brick)}else{if(_okg.brick.getBounds().width>window.innerWidth||_okg.brick.getBounds().width>window.innerHeight){if(_okg.brick.getBounds().width>window.innerWidth){_okg.first_brick.y=_okg.first_brick.x+window.innerHeight/2-(_okg.brick.getBounds().height/2);_okg.last_brick.y=_okg.last_brick.x+window.innerHeight/2-(_okg.brick.getBounds().height/2);_okg.game.camera.follow(_okg.first_brick,Phaser.Camera.FOLLOW_PLATFORMER);_okg.brick.y=window.innerHeight/2-(_okg.brick.getBounds().height/2)}else{_okg.first_brick.x=_okg.first_brick.x+window.innerWidth/2-(_okg.brick.getBounds().width/2);_okg.last_brick.x=_okg.last_brick.x+window.innerWidth/2-(_okg.brick.getBounds().width/2);_okg.game.camera.follow(_okg.first_brick,Phaser.Camera.FOLLOW_TOPDOWN);_okg.brick.x=window.innerWidth/2-(_okg.brick.getBounds().width/2)}}else{_okg.first_brick.y=_okg.first_brick.x+window.innerHeight/2-(_okg.brick.getBounds().height/2);_okg.first_brick.x=_okg.first_brick.x+window.innerWidth/2-(_okg.brick.getBounds().width/2);_okg.last_brick.y=_okg.last_brick.x+window.innerHeight/2-(_okg.brick.getBounds().height/2);_okg.last_brick.x=_okg.last_brick.x+window.innerWidth/2-(_okg.brick.getBounds().width/2);_okg.brick.y=window.innerHeight/2-(_okg.brick.getBounds().height/2);_okg.brick.x=window.innerWidth/2-(_okg.brick.getBounds().width/2)}}TweenMax.to(_okg.element,0.5,{alpha:1});TweenMax.to(_okg.brick,0.5,{alpha:1});TweenMax.to(_okg.first_brick,0.5,{alpha:1});TweenMax.to(_okg.last_brick,0.5,{alpha:1});_okg.element.x=_okg.brick.x+25;_okg.element.y=_okg.brick.y+25;_okg.is_playing=true},500)}}_okg.element.setAll("body.collideWorldBounds",false);_okg.element.setAll("body.allowGravity",false);_okg.element.setAll("body.enable",true);_okg.element.setAll("body.immovable",true);_okg.element.setAll("scale.x",".5");_okg.element.setAll("scale.y",".5");_okg.element.setAll("anchor.x",0.5);_okg.element.setAll("anchor.y",0.5);_okg.brick.setAll("body.collideWorldBounds",false);_okg.brick.setAll("body.allowGravity",false);_okg.brick.setAll("body.enable",true);_okg.brick.setAll("body.immovable",true)};maze.prototype.create_interface=function(){$("#maze_canvas").css({width:window.innerWidth,height:window.innerHeight}).attr({width:window.innerWidth,height:window.innerHeight});this.game=new Phaser.Game(window.innerWidth,window.innerHeight,Phaser.CANVAS,"maze_canvas",{preload:this.preload,create:this.create,update:this.update,render:this.render});this._task_bar=new css_task_bar({target:"task_bar",inputs:{chronos:{icon:"pages/simplediscs/images/chronos.png",default_value:"0"},level:{icon:"pages/simplediscs/images/great.png",default_value:"0"},circle:{icon:"pages/run/maps_new/elements/run_decors_element_circle.png",default_value:"0"},square:{icon:"pages/run/maps_new/elements/run_decors_element_square.png",default_value:"0"},triangle:{icon:"pages/run/maps_new/elements/run_decors_element_triangle.png",default_value:"0"}}})};maze.prototype.preload=function(){_okg.game.load.image("wall","pages/maze/images/assets/wall.png");_okg.game.load.image("end","pages/maze/images/assets/end.png");_okg.game.load.image("hero","pages/maze/images/assets/hero.png");_okg.game.load.image("circle","pages/run/maps_new/elements/run_decors_element_circle.png");_okg.game.load.image("square","pages/run/maps_new/elements/run_decors_element_square.png");_okg.game.load.image("triangle","pages/run/maps_new/elements/run_decors_element_triangle.png")};maze.prototype.create=function(){_okg.game.world.setBounds(0,0,2400,2400);_okg.game.stage.backgroundColor=navigation._current_interface_color;_okg.game.physics.startSystem(Phaser.Physics.ARCADE);_okg.game.physics.arcade.gravity.y=0;_okg.gameInfos.start=new Date().getTime();_okg.draw_level();_okg.cursors=_okg.game.input.keyboard.createCursorKeys();_okg._joy=new joystick("",function(a){_okg._direction=a});_okg._joy._joystick.x=window.innerWidth/2;_okg._joy._joystick.y=window.innerHeight-180};maze.prototype.update=function(){if(_okg.first_brick!==null&&_okg.first_brick!==""&&_okg.is_playing){_okg.game.physics.arcade.collide(_okg.first_brick,_okg.brick);if(_okg._direction){_okg.first_brick.body.velocity.x=_okg._direction.position.x*2;_okg.first_brick.body.velocity.y=_okg._direction.position.y*2}if(!_okg._joy._is_down&&_okg.game.input.worldX!=0){_okg._joy._joystick.x=window.innerWidth/2;_okg._joy._joystick.y=window.innerHeight-180}_okg.game.physics.arcade.collide(_okg.last_brick,_okg.first_brick,_okg.end_collision,null,this);_okg.game.physics.arcade.collide(_okg.element,_okg.first_brick,_okg.element_collision,null,this)}else{_okg.first_brick.body.velocity.x=0;_okg.first_brick.body.velocity.y=0}};maze.prototype.element_collision=function(b,a){switch(a.key){case"circle":$("#input_circle .value").html(parseInt($("#input_circle .value").html())+1);break;case"triangle":$("#input_triangle .value").html(parseInt($("#input_triangle .value").html())+1);break;case"square":$("#input_square .value").html(parseInt($("#input_square .value").html())+1);break}if(typeof _okg._maze_element_sound==="undefined"){audio_manager.play_sound("maze_piece",0,function(c){_okg._maze_element_sound=c})}else{_okg._maze_element_sound.play()}_okg.gameInfos.start+=500;a.kill()};maze.prototype.end_collision=function(){_okg.is_playing=false;var a={x:1,y:1,rotation:0,alpha:1};_okg.first_brick.anchor.setTo(0.5,0.5);TweenMax.to(a,1.5,{x:10,y:10,rotation:36,alpha:0,onUpdate:function(){_okg.first_brick.scale.x=a.x;_okg.first_brick.scale.y=a.y;_okg.first_brick.rotation=a.rotation;_okg.first_brick.alpha=a.alpha},onComplete:function(){_okg.last_brick.kill();_okg.first_brick.kill();_okg.element.destroy();_okg.brick.destroy();_okg.maze_size+=2;_okg.level++;$("#input_level .value").html(_okg.level);setTimeout(function(){_okg.gameInfos.start+=3000;_okg.draw_level()},1500)}});TweenMax.to(_okg.last_brick,1,{alpha:0});TweenMax.to(_okg.element,1,{alpha:0});TweenMax.to(_okg.brick,1,{alpha:0});if(typeof _okg._maze_win_sound==="undefined"){audio_manager.play_sound("maze_win",0,function(b){_okg._maze_win_sound=b})}else{_okg._maze_win_sound.play()}};maze.prototype.render=function(){if(_okg.is_playing){var b=new Date().getTime();var a=b-_okg.gameInfos.start;var c=(_okg.gameInfos.delay-a);$("#input_chronos .value").html(Math.ceil(c/1000));if(Math.ceil(c/1000)<=0){_okg.is_playing=false;_okg.end_game()}}else{}};maze.prototype.end_game=function(){TweenMax.to(_okg.first_brick,1,{alpha:0});TweenMax.to(_okg.last_brick,1,{alpha:0});TweenMax.to(_okg.element,1,{alpha:0});TweenMax.to(_okg.brick,1,{alpha:0,onComplete:function(){_okg.last_brick.kill();_okg.first_brick.kill();_okg.element.destroy();_okg.brick.destroy();_okg._joy.destroy()}});var b=(parseInt($("#input_triangle .value").html())+parseInt($("#input_square .value").html())+parseInt($("#input_circle .value").html()))*parseInt($("#input_level .value").html());var a="winning_dance_top_motion";this._task_bar.end_game(a,b,"maze")};maze.prototype.destroy=function(a){_okg.game.destroy();$("#task_bar").remove();$(".okaoka_maze").html("");a()};maze.prototype.generateSquareMaze=function(e){function a(g,f,h){g[f][h]=false;while(true){directions=[];if(f>1&&g[f-2][h]==true){directions.push([-1,0])}if(f<g.dimension-2&&g[f+2][h]==true){directions.push([1,0])}if(h>1&&g[f][h-2]==true){directions.push([0,-1])}if(h<g.dimension-2&&g[f][h+2]==true){directions.push([0,1])}if(directions.length==0){return g}dir=directions[Math.floor(Math.random()*directions.length)];g[f+dir[0]][h+dir[1]]=false;g=a(g,f+dir[0]*2,h+dir[1]*2)}}var d=new Array(e);d.dimension=e;for(var c=0;c<e;c++){d[c]=new Array(e);for(var b=0;b<e;b++){d[c][b]=true}}d=a(d,1,1);return d};