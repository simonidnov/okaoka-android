function joystick(d,c){this._target=d;this._callBack=c;this._joystick=_okg.game.add.group();this._joystick.x=300;this._joystick.y=300;this._back=null;this._draggable=null;this._line=null;this.draw_controller();this._is_down=false}joystick.prototype.init=function(){},joystick.prototype.draw_controller=function(){var d=new Phaser.Rectangle(-100,-100,200,200);_okg.game.debug.geom(d,"#cfffff");var c=_okg.game.add.graphics(d.x,d.y);this._draggable=_okg.game.add.sprite(0,0);this._line=_okg.game.add.graphics(0,0);this._joystick.add(this._line);var e=_okg.game.add.graphics(0,0);e.lineStyle(0);e.beginFill(16777215,0.1);e.drawCircle(0,0,100);e.beginFill(16777215,1);e.drawCircle(0,0,10);e.endFill();this._draggable.addChild(e);this._draggable.anchor.set(0.5);this._joystick.add(this._draggable);this._draggable.inputEnabled=true;this._draggable.input.enableDrag(true);this._draggable.events.onDragStart.add(this.drag_start);this._draggable.events.onDragUpdate.add(this.drag_update);this._draggable.events.onDragStop.add(this.drag_stop)};joystick.prototype.drag_start=function(){TweenMax.killAll()};joystick.prototype.drag_update=function(e,i,h,g,f){var c,d;d={x:e.position.x,y:e.position.y};c={x:0,y:0};_okg._joy._line.clear();_okg._joy._callBack(_okg._joy.distance(d,c));_okg._joy._is_down=true;_okg._joy._line.beginFill(16777215,1);_okg._joy._line.drawCircle(0,0,10);_okg._joy._line.endFill();_okg._joy._line.lineStyle(10,"0xFFFFFF",1);_okg._joy._line.moveTo(d.x,d.y);_okg._joy._line.lineTo(c.x,c.y)};joystick.prototype.distance=function(e,d){var c=Math.atan2(e.x-d.x,e.y-d.y);var f=c*(180/Math.PI);return{angle:f,distance:Math.sqrt((e.x-=d.x)*e.x+(e.y-=d.y)*e.y),position:e}};joystick.prototype.drag_stop=function(){_okg._joy._line.clear();_okg._joy._is_down=false;TweenMax.to(_okg._joy._draggable,0.7,{x:0,y:0,onUpdate:function(){a={x:_okg._joy._draggable.position.x,y:_okg._joy._draggable.position.y};b={x:0,y:0};_okg._joy._callBack(_okg._joy.distance(a,b))},onComplete:function(){a={x:0,y:0};b={x:0,y:0};_okg._joy._callBack(_okg._joy.distance(a,b))}})};joystick.prototype.destroy=function(){this._joystick.destroy()};