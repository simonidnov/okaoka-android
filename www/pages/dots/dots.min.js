delete _okg;var _okg=null;function dots(){this._levels=null;this._navigation={container:null,buttons:null,line:null};this.okaokarun=new Image();this.okaokarun.src="pages/simplediscs/images/simple_run.png";this.angle=0;this.particles_container;this.particles=[];this._nav_is_open=true;this.dots=[];this.grid_size={c:3,l:3};this.position={x:0,y:0};this._grid_size=100;this._dot_size=35;this._is_down=false;this._current_dot=null;this._lines=null;this._line=null;this._hits=0;this._total_hits=1;this._objectives={};this._completed_objectives={};this._is_shape=false;this._selected_dots=[];this._full_selected_dots=[];this.total_dots=0;this.gameInfo={start_date:0,started:false};this._objectives_container=null;this._objectives_texts={};this._objectives_dots=null;this._objectives_hits={};this.colors={yellow:colors.yellow}}dots.prototype.init=function(){};dots.prototype.create_interface=function(){_okg=this;_okg.load_level(1)};dots.prototype.create_objectives=function(){_okg._objectives_container=_okg.stage.addChild(new createjs.Container());if(_okg._total_hits!==-1){_okg._objectives_hits.icon=new createjs.Bitmap("./pages/dots/assets/hit_icon_small.png");_okg._objectives_hits.icon.x=70;_okg._objectives_container.addChild(_okg._objectives_hits.icon);_okg._objectives_hits.text=new createjs.Text();_okg._objectives_hits.text.font="100 35px Roboto";_okg._objectives_hits.text.color="#FFFFFF";_okg._objectives_hits.text.text=_okg._total_hits;_okg._objectives_hits.text.x=90;_okg._objectives_hits.text.y=35;_okg._objectives_hits.text.width=100;_okg._objectives_hits.text.textAlign="center";_okg._objectives_container.addChild(_okg._objectives_hits.text)}if(_okg._time_lap!==-1){_okg._objectives_hits.icon=new createjs.Bitmap("./pages/dots/assets/chronos_icon_small.png");_okg._objectives_hits.icon.x=0;_okg._objectives_container.addChild(_okg._objectives_hits.icon);_okg._objectives_hits.text=new createjs.Text();_okg._objectives_hits.text.font="100 35px Roboto";_okg._objectives_hits.text.color="#FFFFFF";_okg._objectives_hits.text.text=_okg._time_lap/1000;_okg._objectives_hits.text.x=25;_okg._objectives_hits.text.y=50;_okg._objectives_hits.text.width=100;_okg._objectives_hits.text.textAlign="center";_okg._objectives_container.addChild(_okg._objectives_hits.text);_okg.build_chronos_line()}$.each(_.keys(_okg._objectives),function(c,d){_okg._objectives_texts[d]={dot:null,text:null,percent:null};_okg._objectives_texts[d].dot=new createjs.Shape();_okg._objectives_texts[d].dot.graphics.beginFill(colors[d]);_okg.drawShape(_okg._objectives_texts[d].dot,d);_okg._objectives_texts[d].dot.y=25;_okg._objectives_texts[d].dot.x=100+(80*(c));_okg._objectives_container.addChild(_okg._objectives_texts[d].dot);_okg._objectives_texts[d].percent=new createjs.Shape();_okg._objectives_texts[d].percent.graphics.setStrokeStyle(3);_okg._objectives_texts[d].percent.graphics.beginStroke(colors[d]);_okg._objectives_texts[d].percent.graphics.arc(0,0,18,0,0);_okg._objectives_texts[d].percent.y=25;_okg._objectives_texts[d].percent.x=100+(80*(c));_okg._objectives_container.addChild(_okg._objectives_texts[d].percent);_okg._objectives_texts[d].check=new createjs.Bitmap("./pages/dots/assets/check_small.png");_okg._objectives_texts[d].check.y=10;_okg._objectives_texts[d].check.x=100+(80*(c))-15;_okg._objectives_texts[d].check.scaleX=0;_okg._objectives_texts[d].check.scaleY=0;_okg._objectives_container.addChild(_okg._objectives_texts[d].check);_okg._objectives_texts[d].text=new createjs.Text();_okg._objectives_texts[d].text.font="100 35px Roboto";_okg._objectives_texts[d].text.color="#FFFFFF";if(_okg._objectives[d]===-1){_okg._objectives_texts[d].text.text="0"}else{_okg._objectives_texts[d].text.text="0/"+_okg._objectives[d]}_okg._objectives_texts[d].text.x=100+(80*(c));_okg._objectives_texts[d].text.y=50;_okg._objectives_texts[d].text.width=100;_okg._objectives_texts[d].text.textAlign="center";_okg._objectives_container.addChild(_okg._objectives_texts[d].text)});var b={images:["./pages/dots/images/five_hits_sprite.png"],frames:{width:100,height:100},animations:{hit:[0,15,true],stop:16}};var a=new createjs.SpriteSheet(b);_okg.fivehits=new createjs.Sprite(a,"stop");_okg.fivehits.regX=_okg.fivehits.regY=25;_okg.fivehits.x=0;_okg.fivehits.y=45;_okg._objectives_container.addChild(_okg.fivehits)};dots.prototype.build_chronos_line=function(){_okg.chronos_line=_okg.stage.addChild(new createjs.Container());_okg.chronos_line.regY=25;_okg.chronos_line.y=window.innerHeight;_okg.chronos_line_ground=new createjs.Shape();_okg.chronos_line_ground.graphics.beginFill("rgba(0,0,0,.3)");_okg.chronos_line_ground.graphics.drawRect(0,0,window.innerWidth,25);_okg.chronos_line.addChild(_okg.chronos_line_ground);_okg.chronos_line_progress=new createjs.Shape();_okg.chronos_line_progress.graphics.beginFill("#FFFFFF");_okg.chronos_line_progress.graphics.drawRect(0,0,window.innerWidth,25);_okg.chronos_line_progress.scaleX=0;_okg.chronos_line.addChild(_okg.chronos_line_progress);var b={images:[_okg.okaokarun],frames:{width:80,height:80},animations:{stand:{frames:[0]},run:{frames:[0,0,1,1,2,2,3,3,4,4,5,5,6,6],frequency:50},great:{frames:[7,7,8,8,9,9,10,10,11,11,12,12,13,13,14,14,15,15,16],next:"run"},wrong:{frames:[17,17,18,18,19,19,20,20,21,21,22,22,23,23,24],next:"wrongslide"},wrongslide:{frames:[21,21,22,22,23,23,21,21,22,22,23,23,21,21,22,22,23,23,21,21,22,22,23,23],next:"run"}},framerate:5};var a=new createjs.SpriteSheet(b);_okg.okaokasprite=new createjs.Sprite(a,"run");_okg.okaokasprite.scaleX=_okg.okaokasprite.scaleY=0.7;_okg.okaokasprite.y=-55;_okg.okaokasprite.gotoAndStop("stand");_okg.chronos_line.addChild(_okg.okaokasprite)};dots.prototype.init_stage=function(){$("#dots_canvas").css({width:window.innerWidth,height:window.innerHeight});$("#dots_canvas").attr({width:window.innerWidth,height:window.innerHeight});_okg.stage=new createjs.Stage("dots_canvas");_okg.stage.autoClear=true;_okg.stage.update();createjs.Touch.enable(_okg.stage);createjs.Ticker.addEventListener("tick",_okg.tick)};dots.prototype.stage_down=function(a){navigation.set_update_events();_okg._is_shape=false;_okg._selected_dots=[];_okg._full_selected_dots=[];_okg.position={x:a.stageX,y:a.stageY};_okg._is_down=true};dots.prototype.stage_up=function(b){_okg._is_down=false;if(_okg.gameInfo.started){if(_okg._is_shape){var a=_.findWhere(_okg.dots,{id:_okg._selected_dots[0]}).color;_okg.destroy_all_color(_.findWhere(_okg.dots,{id:_okg._selected_dots[0]}).color);switch(a){case ("purple"):_okg.shape_break=new createjs.Bitmap("./pages/dots/images/circle_shape.png");_okg.stage.addChild(_okg.shape_break);break;case ("green"):_okg.shape_break=new createjs.Bitmap("./pages/dots/images/rect_shape.png");_okg.stage.addChild(_okg.shape_break);break;case ("pink"):_okg.shape_break=new createjs.Bitmap("./pages/dots/images/triangle_shape.png");_okg.stage.addChild(_okg.shape_break);break;default:break}_okg.shape_break.regX=_okg.shape_break.regY=150;_okg.shape_break.x=window.innerWidth/2;_okg.shape_break.y=window.innerHeight/2;_okg.shape_break.scaleX=_okg.shape_break.scaleY=0.2;_okg.shape_break.alpha=1;TweenMax.to(_okg.shape_break,1,{scaleX:2,scaleY:2,alpha:0,onComplete:function(){_okg.stage.removeChild(_okg.shape_break)}})}else{_okg.check_selected_dots()}}};dots.prototype.create_grid=function(){_okg.stage.addEventListener("stagemousedown",_okg.stage_down);_okg.stage.addEventListener("stagemouseup",_okg.stage_up);_okg.create_objectives();_okg._line=new createjs.Shape();_okg.stage.addChild(_okg._line);_okg.grid=_okg.stage.addChild(new createjs.Container());_okg._line.x=(window.innerWidth/2)-((_okg._grid_size*_okg.grid_size.c)/2)-(_okg._grid_size/2);_okg.grid.y=_okg._line.y=(window.innerHeight/2)-((_okg._grid_size*_okg.grid_size.l)/2)-(_okg._grid_size/2);_okg._objectives_container.y=(window.innerHeight/2)-((_okg._grid_size*_okg.grid_size.l)/2)-(_okg._grid_size/2)-60;var c=1;var a=1;for(var b=0;b<(_okg.grid_size.c*_okg.grid_size.l);b++){var e=this.dots.length;var d=Math.round(Math.random()*_.keys(_okg.colors).length-1);if(d<0){d=0}var f=_.keys(_okg.colors)[d];this.dots[e]=new createjs.Shape();this.dots[e].graphics.beginFill(colors[f]);_okg.drawShape(this.dots[e],f);this.dots[e].x=_okg._grid_size*(c);this.dots[e].y=_okg._grid_size*(a);this.dots[e].color=f;this.dots[e].id=_okg.total_dots;this.dots[e].selected=false;this.dots[e].column=c;this.dots[e].line=a;this.dots[e].grid_position={column:c,line:a};this.dots[e].setBounds(_okg._grid_size*(c),_okg._grid_size*(a),_okg._grid_size,_okg._grid_size);c++;_okg.total_dots++;if(c===_okg.grid_size.c+1){a++;c=1}_okg.grid.addChild(this.dots[e])}_okg.grid.x=(window.innerWidth/2)-((_okg._grid_size*_okg.grid_size.c)/2)-(_okg._grid_size/2);_okg._objectives_container.x=(window.innerWidth/2)-(_okg._objectives_container.getBounds().width/2);utilities.show_popup({color:navigation._current_interface_color,motion:"dots_tuto_popup",buttons:["play"]},function(g){setTimeout(function(){_okg.countGround=new createjs.Shape();_okg.countGround.graphics.beginFill(navigation._current_interface_color);_okg.countGround.graphics.drawCircle(0,0,70);_okg.countGround.scaleX=_okg.countGround.scaleY=0;_okg.countGround.x=window.innerWidth/2;_okg.countGround.y=window.innerHeight/2;TweenMax.to(_okg.countGround,0.5,{scaleX:1,scaleY:1});_okg.stage.addChild(_okg.countGround);_okg.countMotion=new lib.count_3();_okg.countMotion.regX=275;_okg.countMotion.regY=200;_okg.countMotion.x=window.innerWidth/2;_okg.countMotion.y=window.innerHeight/2;_okg.stage.addChild(_okg.countMotion);utilities.countCallBack=function(){TweenMax.to(_okg.countGround,0.5,{scaleX:0,scaleY:0});_okg.stage.removeChild(_okg.countMotion);_okg.stage.removeChild(_okg.countGround);_okg.gameInfo.start_date=new Date().getTime();_okg.okaokasprite.gotoAndPlay("run");_okg.gameInfo.started=true}},800)})};dots.prototype.hit_dot=function(a){};dots.prototype.tick=function(){if(_okg._is_down){var f=_okg.grid.getNumChildren();for(var h=0;h<f;h++){var e=_okg.grid.getChildAt(h);var p=e.globalToLocal(_okg.stage.mouseX,_okg.stage.mouseY);if(_okg.stage.mouseInBounds&&e.hitTest(p.x,p.y)){if(_okg._selected_dots.length===0){if(typeof _okg._dots_select_0==="undefined"){audio_manager.play_sound("dots_select_0",0,function(i){_okg._dots_select_0=i})}else{_okg._dots_select_0.play()}_okg._selected_dots.push(e.id);e.selected=true;TweenMax.to(e,0.5,{scaleX:1.2,scaleY:1.2})}else{if(!e.selected){var m=_.findWhere(_okg.dots,{id:_okg._selected_dots[_okg._selected_dots.length-1]});if(e.color===m.color){var g={x:m.x,y:m.y};var k={x:e.x,y:e.y};var b=Math.sqrt((g.x-k.x)*(g.x-k.x)+(g.y-k.y)*(g.y-k.y));if(b<=_okg._grid_size){e.selected=true;_okg._selected_dots.push(e.id);var j=_okg._selected_dots.length;if(j>=10){j=10}if(typeof _okg["_dots_select_"+j]==="undefined"){audio_manager.play_sound("dots_select_"+j,0,function(i){_okg["_dots_select_"+j]=i})}else{_okg["_dots_select_"+j].play()}TweenMax.to(e,0.5,{scaleX:1.2,scaleY:1.2})}delete g;delete k;delete b}}else{var m=_.findWhere(_okg.dots,{id:_okg._selected_dots[_okg._selected_dots.length-1]});var g={x:m.x,y:m.y};var k={x:e.x,y:e.y};var b=Math.sqrt((g.x-k.x)*(g.x-k.x)+(g.y-k.y)*(g.y-k.y));if(e.id===_okg._selected_dots[_okg._selected_dots.length-2]){var n=_.findWhere(_okg.dots,{id:_okg._selected_dots[_okg._selected_dots.length-1]});n.selected=false;TweenMax.to(n,0.5,{scaleX:1,scaleY:1});_okg._selected_dots.pop();if(_okg._is_shape){var n=_.findWhere(_okg.dots,{id:_okg._selected_dots[_okg._selected_dots.length-1]});n.selected=false;TweenMax.to(n,0.5,{scaleX:1,scaleY:1});_okg._is_shape=false;_okg._selected_dots.pop()}}if(e.id!==_okg._selected_dots[_okg._selected_dots.length-1]){if(_okg._selected_dots.length>=4&&_okg.is_a_shape(e.id)&&b<=_okg._grid_size){audio_manager.play_sound("dots_select_shape",0,function(i){_okg.dots_select_shape=i});_okg._is_shape=true;_okg._selected_dots.push(e.id)}}}}}e=null;p=null}f=null;delete f;_okg.redraw_line_selection()}if(_okg.gameInfo.started){if(_okg._time_lap!==-1){var c=new Date().getTime();var o=c-_okg.gameInfo.start_date;var d=(_okg._time_lap-o);_okg._objectives_hits.text.text=Math.ceil(d/1000);var a=100-((d*100)/_okg._time_lap);_okg.chronos_line_progress.scaleX=a/100;_okg.okaokasprite.x=(window.innerWidth)*(a/100)-50;if(Math.ceil(d/1000)===5){_okg.fivehits.gotoAndPlay("hit");if(typeof _okg.five_last_sound==="undefined"){audio_manager.play_sound("chronos_five_seconds",0,function(i){_okg.five_last_sound=i})}}if(d<=0){audio_manager.play_sound("chronos_end",0,function(i){});_okg.gameInfo.started=false;_okg.okaokasprite.gotoAndStop("stand");_okg.fivehits.gotoAndStop("stop");_okg.end_game()}}}_okg.update_particles();_okg.stage.update()};dots.prototype.end_game=function(){audio_manager.play_sound("dots_end_game",0,function(d){});_okg.gameInfo.started=false;_okg.okaokasprite.gotoAndStop("stop");_okg._line.graphics.clear();TweenMax.to(_okg.chronos_line,0.5,{y:window.innerHeight+100,ease:Power4.easeIn});for(var b=0;b<_okg.grid.getNumChildren();b++){var a=-(_okg.grid.x)+Math.random()*window.innerWidth;var c=_okg.grid.getChildAt(b).y;TweenMax.to(_okg.grid.getChildAt(b),0.5,{y:c+window.innerHeight,delay:0.02*(_okg.grid.getNumChildren()-b),ease:Power4.easeIn})}TweenMax.to(_okg._objectives_container,0.5,{y:window.innerHeight/2-(_okg._objectives_container.getBounds().height/2),x:(window.innerWidth/2)-(_okg._objectives_container.getBounds().width/2),delay:(0.02*_okg.dots.length),ease:Power4.easeIn,onComplete:function(){_okg.stage.removeChild(_okg.grid);utilities.create_over_motion({size:{width:400,height:200},position:{x:((window.innerWidth/2)-200),y:((window.innerHeight/2)-265)},motion:"winning_dance_top_motion"},function(){});createjs.Ticker.setFPS(30);_okg.total_score_text=new createjs.Text();_okg.total_score_text.font="700 100px Roboto";_okg.total_score_text.color="#FFFFFF";_okg.total_score_text.text="00000";_okg.total_score_text.textAlign="center";_okg.total_score_text.x=window.innerWidth/2;_okg.total_score_text.y=_okg._objectives_container.y+_okg._objectives_container.getBounds().height;_okg.stage.addChild(_okg.total_score_text);var f=0;$.each(_.keys(_okg._completed_objectives),function(j,h){f+=parseInt(_okg._completed_objectives[h].count)});var g=f*_okg._hits;var e=f+g;var d={total:0};audio_manager.play_sound("total_count",0,function(h){});TweenMax.to(d,2.5,{total:e,delay:0.6,onUpdate:function(){var l="";var h=Math.ceil(d.total);if(h.toString().length<5){var k=5-h.toString().length;for(var j=0;j<k;j++){l+="0"}}l+=h.toString();_okg.total_score_text.text=l},ease:Power4.easeOut,onComplete:function(){_okg.replay_button=new createjs.Bitmap("./images/assets/btn_replay.png");_okg.replay_button.x=window.innerWidth/2+70;_okg.replay_button.y=_okg.total_score_text.y+_okg.total_score_text.getBounds().height+70;_okg.replay_button.regX=_okg.replay_button.regY=50;_okg.replay_button.scaleX=_okg.replay_button.scaleY=0;_okg.stats_button=new createjs.Bitmap("./images/assets/btn_podium.png");_okg.stats_button.x=window.innerWidth/2-70;_okg.stats_button.y=_okg.total_score_text.y+_okg.total_score_text.getBounds().height+70;_okg.stats_button.regX=_okg.stats_button.regY=50;_okg.stats_button.scaleX=_okg.stats_button.scaleY=0;if(typeof _node==="undefined"){_node=new node_utilities()}var h=new createjs.Graphics();h.beginFill(navigation._current_interface_color);h.drawCircle(50,50,50);h.endFill();_okg.replay_button.hitArea=new createjs.Shape(h);_okg.stats_button.hitArea=new createjs.Shape(h);utilities.save_score_game("dots",e);_okg.replay_button.addEventListener("click",function(i){window.location.href="#page/"+navigation._current_page_name+"/intro/false/date/"+new Date().getTime()});_okg.stats_button.addEventListener("click",function(i){utilities.show_score_game("dots",e)});TweenMax.to(_okg.replay_button,0.5,{scaleX:1,scaleY:1});TweenMax.to(_okg.stats_button,0.5,{scaleX:1,scaleY:1,delay:0.2});_okg.stage.addChild(_okg.replay_button);_okg.stage.addChild(_okg.stats_button);f=g=e=d=h=null}})}})};dots.prototype.is_a_shape=function(b){for(var a=0;a<_okg._selected_dots.length-3;a++){if(_okg._selected_dots[a]===b){return true}}return false};dots.prototype.destroy_all_color=function(b){_okg._full_selected_dots=[];var a=_okg.grid.getNumChildren();for(var c=a-1;c>=0;c--){var d=_okg.grid.getChildAt(c);if(d.color===b){_okg._full_selected_dots.push(d.id);TweenMax.to(d,0.5,{scaleX:1.2,scaleY:1.2})}d=null}a=null;_okg.check_selected_dots()};dots.prototype.check_selected_dots=function(){if(_okg._selected_dots.length>1){_okg._hits++;var d=_okg._selected_dots;if(_okg._full_selected_dots.length>_okg._selected_dots.length){d=_okg._full_selected_dots}var e=_.findWhere(_okg.dots,{id:d[0]});if(typeof e!=="undefined"){if(typeof _okg._completed_objectives[e.color]!=="undefined"){_okg._completed_objectives[e.color].count+=parseInt(d.length);_okg._completed_objectives[e.color].percent=(_okg._completed_objectives[e.color].count*100)/_okg._objectives[e.color]}else{_okg._completed_objectives[e.color]={percent:0,count:0};_okg._completed_objectives[e.color].count=d.length}TweenMax.set($("#colorer"),{backgroundColor:_okg.colors[e.color]});var b={size:_okg._dot_size};TweenMax.to(b,0.3,{size:1,onUpdate:function(){_okg.redraw_line_selection(b.size,$("#colorer").css("background-color"))},onComplete:function(){TweenMax.to($("#colorer"),0.3,{backgroundColor:"#FFFFFF",onUpdate:function(){for(var g=0;g<d.length;g++){var f=_.findWhere(_okg.dots,{id:d[g]});if(typeof f!=="undefined"){_okg.set_dot_color(f,$("#colorer").css("background-color"),e.color);_okg.redraw_line_selection(b.size,$("#colorer").css("background-color"))}}},onComplete:function(){if(typeof _okg._dots_break==="undefined"){audio_manager.play_sound("dots_break",0,function(h){_okg._dots_break=h})}else{_okg._dots_break.play()}_okg._line.graphics.clear();for(var g=0;g<d.length;g++){var f=_.findWhere(_okg.dots,{id:d[g]});if(typeof f!=="undefined"){_okg.grid.removeChild(f);_okg.dots=_.reject(_okg.dots,{id:d[g]})}}_okg.replace_dots(0)}})}})}}else{for(var c=0;c<_okg._selected_dots.length;c++){var a=_.findWhere(_okg.dots,{id:_okg._selected_dots[c]});TweenMax.to(a,0.5,{scaleX:1,scaleY:1});a.selected=false}}_okg._line.graphics.clear()};dots.prototype.replace_dots=function(b){var a=_okg.grid.getNumChildren();for(var c=a-1;c>=0;c--){var e=_okg.grid.getChildAt(c);if(e.line<_okg.grid_size.l){var d=_.findWhere(_okg.dots,{line:e.line+1,column:e.column});if(typeof d==="undefined"){e.line+=1;e.setBounds(_okg._grid_size*e.column,_okg._grid_size*e.line,_okg._grid_size,_okg._grid_size)}}}if(b<_okg.grid_size.l){_okg.replace_dots(b+1)}else{for(var c=a-1;c>=0;c--){var e=_okg.grid.getChildAt(c);TweenMax.to(e,0.5,{y:e.line*_okg._grid_size,ease:Bounce.easeOut})}setTimeout(function(){_okg.check_game_state(function(f){switch(f.label){case"continu":_okg.complete_grid();break;case"win":_okg.destroy_grid();_okg.open_nav();break;case"lose":_okg.destroy_grid();_okg.open_nav();break}})},500)}};dots.prototype.check_game_state=function(d){var b={label:"continu",objectifs:false,hits:true,time:true};if(_okg._total_hits!==-1){var c={total:_.keys(_okg._objectives).length,completed:0};_okg._objectives_hits.text.text=_okg._total_hits-_okg._hits;$.each(_.keys(_okg._objectives),function(f,g){if(_okg._completed_objectives[g].count>=_okg._objectives[g]){_okg._objectives_texts[g].percent.graphics.clear();_okg._objectives_texts[g].percent.graphics.setStrokeStyle(3);_okg._objectives_texts[g].percent.graphics.beginStroke(colors[g]);_okg._objectives_texts[g].percent.graphics.arc(0,0,16,0,6);_okg._objectives_texts[g].text.text=_okg._objectives[g];TweenMax.to(_okg._objectives_texts[g].dot,0.2,{scaleX:2,scaleY:2,ease:Back.easeOut});TweenMax.to(_okg._objectives_texts[g].check,0.2,{scaleX:1,scaleY:1,delay:0.1,ease:Back.easeOut});c.completed++}else{_okg._objectives_texts[g].percent.graphics.clear();_okg._objectives_texts[g].percent.graphics.setStrokeStyle(3);_okg._objectives_texts[g].percent.graphics.beginStroke(colors[g]);var h=(6*_okg._completed_objectives[g].percent)/100;_okg._objectives_texts[g].percent.graphics.arc(0,0,16,0,h);_okg._objectives_texts[g].text.text=_okg._completed_objectives[g].count+"/"+_okg._objectives[g]}});if(c.total===c.completed){b.label="win";b.objectifs=true}if(_okg._total_hits-_okg._hits<=5&&_okg._total_hits-_okg._hits>0){_okg.fivehits.gotoAndPlay("hit");audio_manager.play_sound("chronos_five_seconds",0,function(f){})}else{_okg.fivehits.gotoAndStop("stop")}if(_okg._total_hits-_okg._hits<=0){if(b.objectifs===false){b.label="lose"}b.hits=false}}if(_okg.gameInfo.started){if(_okg._time_lap!==-1){$.each(_.keys(_okg._objectives),function(f,g){_okg._objectives_texts[g].text.text=_okg._completed_objectives[g].count});var a=new Date().getTime()-_okg.gameInfo.start_date;var e=Math.ceil((_okg._time_lap-a)/1000);if(e<10){_okg.fivehits.gotoAndPlay("hit")}}}d(b)};dots.prototype.complete_grid=function(){var d=1;var a=1;var c=0;for(var b=0;b<(_okg.grid_size.c*_okg.grid_size.l);b++){if(typeof _.findWhere(_okg.dots,{column:d,line:a})==="undefined"){var f=this.dots.length;var e=Math.ceil(Math.random()*_.keys(_okg.colors).length-1);if(e<0){e=0}var g=_.keys(_okg.colors)[e];this.dots[f]=new createjs.Shape();this.dots[f].graphics.beginFill(colors[g]);_okg.drawShape(this.dots[f],g);this.dots[f].x=_okg._grid_size*(d);this.dots[f].y=_okg._grid_size*(a);this.dots[f].color=g;this.dots[f].id=_okg.total_dots;this.dots[f].selected=false;this.dots[f].column=d;this.dots[f].line=a;this.dots[f].grid_position={column:d,line:a};this.dots[f].setBounds(_okg._grid_size*(d),_okg._grid_size*(a),_okg._grid_size,_okg._grid_size);_okg.grid.addChild(this.dots[f]);TweenMax.set(this.dots[f],{scaleX:0,scaleY:0});TweenMax.to(this.dots[f],0.4,{scaleX:1,scaleY:1,delay:c*0.02,ease:Back.easeOut});c++}d++;_okg.total_dots++;if(d===_okg.grid_size.c+1){a++;d=1}}};dots.prototype.redraw_line_selection=function(c,a){if(!c){c=_okg._dot_size*1.2}if(!_okg.gameInfo.started){return false}if(!a){var d=_.findWhere(_okg.dots,{id:_okg._selected_dots[0]});if(typeof d!=="undefined"){a=_okg.colors[_.findWhere(_okg.dots,{id:_okg._selected_dots[0]}).color]}else{a="#FFFFFF"}}else{if(a.indexOf("#")===-1){a=rgb2hex(a)}}if(_okg._selected_dots.length>0){_okg._line.graphics.clear();_okg._line.graphics.setStrokeStyle(c,"round","round");_okg._line.graphics.beginStroke(a);_okg._line.graphics.moveTo(_.findWhere(_okg.dots,{id:_okg._selected_dots[0]}).x,_.findWhere(_okg.dots,{id:_okg._selected_dots[0]}).y);for(var b=1;b<_okg._selected_dots.length;b++){_okg._line.graphics.lineTo(_.findWhere(_okg.dots,{id:_okg._selected_dots[b]}).x,_.findWhere(_okg.dots,{id:_okg._selected_dots[b]}).y)}if(_okg._is_down){_okg._line.graphics.lineTo(_okg.stage.mouseX-_okg._line.x,_okg.stage.mouseY-_okg._line.y)}}};dots.prototype.set_dot_color=function(c,a,b){c.graphics.clear();c.graphics.beginFill(a);_okg.drawShape(c,b,a)};dots.prototype.load_level=function(a){_okg.init_stage();if(_okg.grid){TweenMax.to(_okg._line,0.5,{scaleX:0,scaleY:0});TweenMax.to(_okg.grid,0.5,{scaleX:0,scaleY:0});_okg.stage.removeChild(_okg._line);_okg.stage.removeChild(_okg.grid)}$.ajax({dataType:"json",url:"./pages/dots/levels/level_"+a+".json",data:{},success:function(b){_okg._levels=b;_okg.build_decors();_okg.create_particles();_okg.select_level(0)}})};dots.prototype.select_level=function(b){var a=_okg._levels[b];_okg._grid_size=a._grid_size;_okg.colors={};$.each(a.colors,function(d,c){_okg.colors[a.colors[d]]=colors[a.colors[d]]});_okg._dot_size=a.dot_size;_okg.grid_size=a.grid_size;_okg._total_hits=a.hits;_okg._time_lap=a.time;_okg._hits=0;_okg._objectives=a.objectives;_okg._completed_objectives={};$.each(_.keys(a.objectives),function(d,c){_okg._completed_objectives[c]={count:0,percent:0}});TweenMax.to($(".app_content"),0.5,{backgroundColor:colors[a.color]});TweenMax.to($("#backbutton"),0.5,{backgroundColor:colors[a.color]});_okg.create_objectives_popup();_okg.create_grid()};dots.prototype.create_objectives_popup=function(){};dots.prototype.destroy_grid=function(){TweenMax.to(_okg._objectives_container,1,{x:window.innerWidth,ease:Power4.easeInOut});TweenMax.to(_okg.grid,1,{x:window.innerWidth,ease:Power4.easeInOut,onComplete:function(){var a=_okg.grid.getNumChildren();for(var b=0;b<a;b++){_okg.dots=_.reject(_okg.dots,{id:_okg.grid.getChildAt(b).id})}_okg.stage.removeChild(_okg.grid);_okg.stage.removeChild(_okg._objectives_container)}})};dots.prototype.open_nav=function(){_okg._nav_is_open=true;_okg.stage.removeEventListener("stagemousedown");_okg.stage.removeEventListener("stagemouseup");var b=new createjs.Point();var a={x:0,y:0};_okg.stage.addEventListener("pressup",function(c){if(_okg._nav_is_open){_okg.replace_decors();if(_okg._navigation.container.y>(_okg._navigation.container.getBounds().height-(window.innerHeight/2))){TweenMax.to(_okg._navigation.container,1,{y:(_okg._navigation.container.getBounds().height-(window.innerHeight/2)),ease:Power4.easeInOut,onUpdate:function(){_okg.replace_decors()}})}if(_okg._navigation.container.y<-(_okg._navigation.container.getBounds().height+_okg._navigation.container.getBounds().y-(window.innerHeight/2))){TweenMax.to(_okg._navigation.container,1,{y:-(_okg._navigation.container.getBounds().height+_okg._navigation.container.getBounds().y-(window.innerHeight/2)),ease:Power4.easeInOut,onUpdate:function(){_okg.replace_decors()}})}}});_okg.stage.addEventListener("mousedown",function(c){if(_okg._nav_is_open){a={x:c.stageX,y:c.stageY,default_pos:_okg._navigation.container.y}}});_okg.stage.addEventListener("pressmove",function(c){if(_okg._nav_is_open){_okg._navigation.container.y=a.default_pos+(c.stageY-a.y)/1.2;_okg.replace_decors()}});TweenMax.to(_okg._navigation.container,1,{x:0,ease:Power4.easeInOut})};dots.prototype.close_nav=function(){_okg._nav_is_open=false;_okg.stage.removeEventListener("pressup");_okg.stage.removeEventListener("mousedown");_okg.stage.removeEventListener("pressmove");TweenMax.to(_okg._navigation.container,1,{x:-window.innerWidth,ease:Power4.easeInOut})};dots.prototype.build_decors=function(){_okg.decors={container:null,bottom_left:null,bottom_right:null,bottom_center:null,watter:null,elements:{}};_okg.decors.container=_okg.stage.addChild(new createjs.Container());_okg.decors.bottom_left=new createjs.Bitmap("./pages/dots/images/decors/bottom_left.png");_okg.decors.container.addChild(_okg.decors.bottom_left);_okg.decors.bottom_right=new createjs.Bitmap("./pages/dots/images/decors/bottom_right.png");_okg.decors.container.addChild(_okg.decors.bottom_right);_okg.decors.bottom_center=new createjs.Bitmap("./pages/dots/images/decors/bottom_center.png");_okg.decors.container.addChild(_okg.decors.bottom_center);_okg.decors.bottom_left.scaleX=_okg.decors.bottom_left.scaleY=_okg.decors.bottom_right.scaleX=_okg.decors.bottom_right.scaleY=_okg.decors.bottom_center.scaleX=_okg.decors.bottom_center.scaleY=0;setTimeout(function(){_okg.decors.bottom_left.regY=_okg.decors.bottom_left.getBounds().height;_okg.decors.bottom_left.y=window.innerHeight+300;_okg.decors.bottom_left.regX=0;_okg.decors.bottom_right.regX=_okg.decors.bottom_right.getBounds().width;_okg.decors.bottom_right.regY=_okg.decors.bottom_right.getBounds().height;_okg.decors.bottom_right.x=window.innerWidth;_okg.decors.bottom_right.y=window.innerHeight+300;_okg.decors.bottom_center.regX=_okg.decors.bottom_center.getBounds().width/2;_okg.decors.bottom_center.regY=_okg.decors.bottom_center.getBounds().height;_okg.decors.bottom_center.x=window.innerWidth/2;_okg.decors.bottom_center.y=window.innerHeight+300;var a={scale:0};TweenMax.to(a,1,{scale:1,onUpdate:function(){_okg.decors.bottom_left.scaleX=_okg.decors.bottom_left.scaleY=_okg.decors.bottom_right.scaleX=_okg.decors.bottom_right.scaleY=_okg.decors.bottom_center.scaleX=_okg.decors.bottom_center.scaleY=a.scale},delay:1});_okg.replace_decors()},500)};dots.prototype.create_particles=function(){_okg.particles_container=_okg.stage.addChild(new createjs.Container());for(var a=0;a<25;a++){_okg.particles[a]=new createjs.Shape();_okg.particles[a].graphics.beginFill("#FFFFFF").drawCircle(0,0,Math.round(Math.random()*5)+1);_okg.particles[a].x=Math.random()*window.innerWidth;_okg.particles[a].y=Math.random()*window.innerHeight;_okg.particles[a].alpha=0.1+Math.random()*1;_okg.particles_container.addChild(_okg.particles[a])}};dots.prototype.redraw_particles=function(){};dots.prototype.update_particles=function(){var a=window.innerWidth;var c=window.innerWidth;_okg.angle+=0.01;for(var b=0;b<_okg.particles.length;b++){var d=_okg.particles[b];d.y+=Math.cos(_okg.angle)+1;d.x+=Math.sin(_okg.angle)*2;if(d.x>a+5||d.x<-5||d.y>c){if(b%3>0){_okg.particles[b].x=Math.random()*a;_okg.particles[b].y=-10}else{if(Math.sin(_okg.angle)>0){_okg.particles[b].x=-5;_okg.particles[b].y=Math.random()*c}else{_okg.particles[b].x=a+5;_okg.particles[b].y=Math.random()*c}}}}};dots.prototype.replace_decors=function(){};dots.prototype.build_navigation=function(){_okg.hit_zone=new createjs.Shape();_okg.hit_zone.graphics.beginFill(colors.yellow).drawRect(0,0,window.innerWidth,window.innerHeight);_okg.stage.addChild(_okg.hit_zone);_okg.hit_zone.alpha=0.01;_okg._navigation={container:null,buttons:{},line:null};_okg._navigation.container=_okg.stage.addChild(new createjs.Container());_okg._navigation.line=new createjs.Shape();_okg._navigation.line.graphics.setStrokeStyle(40,"round","round");_okg._navigation.line.graphics.beginStroke("#FFF");_okg._navigation.line.graphics.moveTo(window.innerWidth/2,(window.innerHeight-125));_okg._navigation.line.graphics.lineTo(window.innerWidth/2,(window.innerHeight-50)-(125*_.keys(_okg._levels).length));_okg._navigation.container.addChild(_okg._navigation.line);_okg.stage.enableMouseOver(20);_okg.stage.mouseMoveOutside=true;$.each(_.keys(_okg._levels),function(b,a){_okg._navigation.buttons[a]={container:null,dot:null,text:null,percent:null};_okg._navigation.buttons[a].container=_okg._navigation.container.addChild(new createjs.Container());_okg._navigation.buttons[a].container.y=(window.innerHeight-125)-(150*b);_okg._navigation.buttons[a].container.x=window.innerWidth/2;_okg._navigation.buttons[a].container.id=a;_okg._navigation.buttons[a].container.scaleX=0;_okg._navigation.buttons[a].container.scaleY=0;_okg._navigation.buttons[a].dot=new createjs.Shape();_okg._navigation.buttons[a].dot.graphics.setStrokeStyle(20);_okg._navigation.buttons[a].dot.graphics.beginStroke("#FFF");_okg._navigation.buttons[a].dot.graphics.beginFill(colors[_okg._levels[a].color]).drawCircle(0,0,50);_okg._navigation.buttons[a].dot.y=30;_okg._navigation.buttons[a].dot.id=a;_okg._navigation.buttons[a].text=new createjs.Text();_okg._navigation.buttons[a].text.font="700 50px Roboto";_okg._navigation.buttons[a].text.color="#FFFFFF";_okg._navigation.buttons[a].text.text=a;_okg._navigation.buttons[a].text.width=100;_okg._navigation.buttons[a].text.textAlign="center";_okg._navigation.buttons[a].container.addChild(_okg._navigation.buttons[a].dot);_okg._navigation.buttons[a].container.addChild(_okg._navigation.buttons[a].text);_okg._navigation.buttons[a].container.addEventListener("mousedown",function(c){TweenMax.to(_okg._navigation.buttons[c.currentTarget.id].dot,0.3,{scaleX:1.3,scaleY:1.3,ease:Back.easeOut})});_okg._navigation.buttons[a].container.addEventListener("mouseover",function(c){TweenMax.to(_okg._navigation.buttons[c.currentTarget.id].dot,0.3,{scaleX:1.3,scaleY:1.3,ease:Back.easeOut})});_okg._navigation.buttons[a].container.addEventListener("mouseup",function(d){for(var c=0;c<_.keys(_okg._navigation.buttons).length;c++){TweenMax.to(_okg._navigation.buttons[_.keys(_okg._navigation.buttons)[c]],0.3,{scaleX:1,scaleY:1})}});_okg._navigation.buttons[a].container.addEventListener("mouseout",function(c){TweenMax.to(_okg._navigation.buttons[c.currentTarget.id].dot,0.3,{scaleX:1,scaleY:1})});_okg._navigation.buttons[a].container.addEventListener("click",function(c){_okg.close_nav();_okg.select_level(c.currentTarget.id)});TweenMax.to(_okg._navigation.buttons[a].container,0.6,{scaleX:1,scaleY:1,ease:Back.easeOut,delay:(0.1*b)})});_okg._navigation.container.y=-(_okg._navigation.container.getBounds().height+_okg._navigation.container.getBounds().y-(window.innerHeight/2));_okg.open_nav()};dots.prototype.intro_hand=function(){var a=new createjs.Bitmap("./pages/dots/images/decors/hand.png");a.x=window.innerWidth;a.y=window.innerHeight;_okg.stage.addChild(a);TweenMax.to(a,1,{y:window.innerHeight/2,x:window.innerWidth/2+200,onComplete:function(){TweenMax.to(a,1,{y:window.innerHeight/2+250,x:window.innerWidth/2+200,onUpdate:function(){_okg._navigation.container.y=(a.y-window.innerHeight/2)-(_okg._navigation.container.getBounds().height+_okg._navigation.container.getBounds().y-(window.innerHeight/2));_okg.replace_decors()},onComplete:function(){TweenMax.to(a,1,{y:window.innerHeight/2-250,x:window.innerWidth/2+200,onUpdate:function(){_okg._navigation.container.y=(a.y-window.innerHeight/2)-(_okg._navigation.container.getBounds().height+_okg._navigation.container.getBounds().y-(window.innerHeight/2));_okg.replace_decors()},onComplete:function(){TweenMax.to(a,1,{y:window.innerHeight/2,x:window.innerWidth/2+200,onUpdate:function(){_okg._navigation.container.y=(a.y-window.innerHeight/2)-(_okg._navigation.container.getBounds().height+_okg._navigation.container.getBounds().y-(window.innerHeight/2));_okg.replace_decors()},onComplete:function(){TweenMax.to(a,1,{y:window.innerHeight,x:window.innerWidth,ease:Back.easeIn,onComplete:function(){_okg.stage.removeChild(a)}})}})}})}})}})};dots.prototype.drawShape=function(c,a,b){c.graphics.setStrokeStyle(4,"round","round");if(typeof b!=="undefined"){c.graphics.beginStroke(b)}else{c.graphics.beginStroke(colors[a])}switch(a){case ("purple"):c.graphics.drawCircle(0,0,_okg._dot_size);break;case ("green"):c.graphics.drawRect(-(_okg._dot_size-5),-(_okg._dot_size-5),((_okg._dot_size-5)*2),((_okg._dot_size-5)*2));c.rotation=45;break;case ("pink"):c.graphics.moveTo(0,-_okg._dot_size);c.graphics.lineTo(_okg._dot_size+3,_okg._dot_size);c.graphics.lineTo(-_okg._dot_size-3,_okg._dot_size);c.graphics.lineTo(0,-_okg._dot_size);break;default:c.graphics.drawCircle(0,0,_okg._dot_size);break}c.graphics.beginStroke("");c.graphics.beginFill("rgba(255,255,255,0.01)");c.graphics.drawRect(-40,-40,80,80)};dots.prototype.pause=function(){createjs.Ticker.removeEventListener("tick",_okg.tick)};dots.prototype.play=function(){createjs.Ticker.addEventListener("tick",_okg.tick)};dots.prototype.destroy=function(a){createjs.Ticker.removeEventListener("tick",_okg.tick);a()};Array.prototype.clean=function(b){for(var a=0;a<this.length;a++){if(this[a]==b){this.splice(a,1);a--}}return this};